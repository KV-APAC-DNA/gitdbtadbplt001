{% macro wk_rankdt_fun() %}
    {% set month = 1 %}
    {% set target_year = run_query("select target_year from jp_dcl_edw.kr_comm_point_para").columns[0].values[0] %}
    {% set term_end_month = run_query("select substring(term_end,5,2) from jp_dcl_edw.kr_comm_point_para").columns[0].values[0] %}
    
    {% set current_year = run_query("select extract(year from CONVERT_TIMEZONE('UTC','Asia/Tokyo',SYSDATE)) as year").columns[0].values[0] %}

    {% if current_year > target_year %}
        {% set end_month = 12 %}
    {% else %}
        {% set end_month = term_end_month %}
    {% endif %}

    {% while month <= end_month %}
         {% set query %}
         insert into jp_dcl_edw.wk_rankdt_tmp
       --select   (select cast(extract(year from sysdate) as varchar) + lpad(month,2,'00')) ,0;
		 select cast(target_year as varchar) || lpad(month,2,'00'), 0 from jp_dcl_edw.kr_comm_point_para; 

        {% endset %}

        {% do run_query(query) %}
        {% set month = month + 1 %}
    {% endwhile %}

{% endmacro %}