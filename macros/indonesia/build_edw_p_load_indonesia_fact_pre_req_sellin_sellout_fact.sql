{% macro build_edw_p_load_indonesia_fact_pre_req_sellin_sellout_fact() %}
    {{ log("===============================================================================================") }}
    {{ log("Step1: Trying to fetch the distributor_cd,source_system, effective_from,effective_to from ITG table: idnitg_integration.itg_mds_id_dist_reporting_control_sellout_sales ") }}
    {{ log("===============================================================================================") }}
    {% set get_rows_query %}
        select UPPER(TRIM(distributor_cd)),UPPER(TRIM(source_system)), effective_from,effective_to 
        from {{ ref('idnitg_integration__itg_mds_id_dist_reporting_control_sellout_sales') }} order by distributor_cd,effective_from;
    {% endset %}
    {{ log("Try to execute the query to fetch the distributor_cd,source_system, effective_from,effective_to ") }}
    {{ log("===============================================================================================") }}
        {% set get_rows_query_result = run_query(get_rows_query) %}
        {% if execute %}
                {% set results_list = get_rows_query_result.rows %}
            {% else %}
                {% set results_list = [] %}
            {% endif %}
    {{ log("Truncate table before load ") }}
    {{ log("===============================================================================================") }}
        {% set trunc_tbl_exec %}
        truncate table {% if target.name=='prod' %}
                    idnwks_integration.wks_itg_all_distributor_sellin_sellout_fact
                {% else %}
                    {{schema}}.idnwks_integration__wks_itg_all_distributor_sellin_sellout_fact
                {% endif %}
        {% endset %}
        {% do run_query(trunc_tbl_exec) %}
    {{ log("Try to execute the query to run loop ") }}
    {{ log("===============================================================================================") }}
        {% for i in results_list %}
            {% set sql_stmnt_loop %}
            CREATE OR REPLACE TEMPORARY TABLE WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT
            AS
            SELECT DISTINCT DISTRIBUTOR_CD,
                   SOURCE_SYSTEM,
                   EFFECTIVE_FROM,
                   EFFECTIVE_TO
            FROM {{ ref('idnitg_integration__itg_mds_id_dist_reporting_control_sellout_sales') }}
            WHERE UPPER(TRIM(DISTRIBUTOR_CD)) = UPPER(TRIM('{{ i[0] }}'))
            AND   UPPER(TRIM(SOURCE_SYSTEM)) = UPPER(TRIM('{{ i[1] }}'))
            AND   EFFECTIVE_FROM = '{{ i[2] }}'
            AND   EFFECTIVE_TO = '{{ i[3] }}';
            {% if i[1] == 'SQL' %}
                INSERT INTO {% if target.name=='prod' %}
                    idnwks_integration.wks_itg_all_distributor_sellin_sellout_fact
                {% else %}
                    {{schema}}.idnwks_integration__wks_itg_all_distributor_sellin_sellout_fact
                {% endif %}
                (
                    IDENTIFIER,
                    TRANS_KEY,
                    BILL_DOC,
                    BILL_DT,
                    JJ_MNTH_ID,
                    JJ_WK,
                    DSTRBTR_GRP_CD,
                    DSTRBTR_ID,
                    JJ_SAP_DSTRBTR_ID,
                    DSTRBTR_CUST_ID,
                    DSTRBTR_PROD_ID,
                    JJ_SAP_PROD_ID,
                    DSTRBTN_CHNL,
                    GRP_OUTLET,
                    DSTRBTR_SLSMN_ID,
                    SELLIN_QTY,
                    SELLOUT_QTY,
                    SELLIN_VAL,
                    GROSS_SELLIN_VAL,
                    GROSS_SELLOUT_VAL,
                    SELLOUT_VAL,
                    TRD_DSCNT,
                    DSTRBTR_NET_VAL,
                    RTRN_QTY,
                    RTRN_VAL
                    )
                    SELECT 'SELLOUT' AS IDENTIFIER,
                        T1.TRANS_KEY,
                        T1.BILL_DOC,
                        T1.BILL_DT,
                        T1.JJ_MNTH_ID,
                        T1.JJ_WK,
                        T1.DSTRBTR_GRP_CD,
                        T1.DSTRBTR_ID,
                        T1.JJ_SAP_DSTRBTR_ID,
                        T1.DSTRBTR_CUST_ID,
                        T1.DSTRBTR_PROD_ID,
                        T1.JJ_SAP_PROD_ID,
                        T1.DSTRBTN_CHNL,
                        T1.GRP_OUTLET,
                        T1.DSTRBTR_SLSMN_ID,
                        0 AS SELLIN_QTY,
                        T1.SLS_QTY AS SELLOUT_QTY,
                        0 AS SELLIN_VAL,
                        0 AS GROSS_SELLIN_VAL,
                        T1.GRS_VAL AS GROSS_SELLOUT_VAL,
                        T1.JJ_NET_VAL AS SELLOUT_VAL,
                        T1.TRD_DSCNT,
                        T1.DSTRBTR_NET_VAL,
                        T1.RTRN_QTY,
                        T1.RTRN_VAL
                    FROM {{ ref('idnitg_integration__itg_all_distributor_sellout_sales_fact') }} T1,
                        WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                        {{ source('idnedw_integration','edw_time_dim') }} T2
                    WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                    AND   UPPER(TRIM(T1.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                    AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                    AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                    UNION ALL
                    SELECT IDENTIFIER,
                        TRANS_KEY,
                        BILL_DOC,
                        BILL_DT,
                        CAST(JJ_MNTH_ID AS VARCHAR) AS JJ_MNTH_ID,
                        CASt(JJ_WK AS VARCHAR) AS JJ_WK,
                        DSTRBTR_GRP_CD,
                        DSTRBTR_ID,
                        JJ_SAP_DSTRBTR_ID,
                        DSTRBTR_CUST_ID,
                        DSTRBTR_PROD_ID,
                        JJ_SAP_PROD_ID,
                        DSTRBTN_CHNL,
                        GRP_OUTLET,
                        DSTRBTR_SLSMN_ID,
                        SELLIN_QTY,
                        SELLOUT_QTY,
                        SELLIN_VAL,
                        GROSS_SELLIN_VAL,
                        GROSS_SELLOUT_VAL,
                        SELLOUT_VAL,
                        TRD_DSCNT,
                        DSTRBTR_NET_VAL,
                        RTRN_QTY,
                        RTRN_VAL
                    FROM (SELECT 'SELLIN' AS IDENTIFIER,
                                (T1.JJ_SAP_DSTRBTR_ID||T1.JJ_SAP_PROD_ID||T1.BILL_DOC||TO_DATE(T1.BILL_DT)) AS TRANS_KEY,
                                UPPER(TRIM(BILL_DOC)) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                T1.JJ_SAP_DSTRBTR_ID AS DSTRBTR_ID,
                                T1.JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                T1.JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.NET_VAL AS SELLIN_VAL,
                                T1.NET_VAL AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('idnitg_integration__itg_all_distributor_sellin_sales_fact') }} T1,
                            {{ source('idnedw_integration','edw_time_dim') }} T2,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(TRIM(T1.JJ_SAP_DSTRBTR_ID)) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+) 
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(TRIM(T1.BILL_TYPE_ID)) IN ('F2','RE')
                        UNION ALL
                        SELECT 'SELLIN' AS IDENTIFIER,
                                ((DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) ) ||LTRIM(T1.MATERIAL,0) ||T1.BILL_NUM||T1.BILL_DT) AS TRANS_KEY,
                                UPPER(TRIM(LTRIM(T1.BILL_NUM,0))) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS DSTRBTR_ID,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                LTRIM(T1.MATERIAL,0) AS JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.BILL_QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.REBATE_BAS AS SELLIN_VAL,
                                T1.SUBTOTAL_1 AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('aspedw_integration__edw_billing_fact') }} T1,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            {{ source('idnedw_integration','edw_time_dim') }} T2
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(DECODE(LTRIM(T1.SOLD_TO,0),'120166','115330','120167','115327','120168','115329','120169','115328','120170','116193','120165','116193','120171','116194','120173','116206','120174','116207','120172','116195','123537','119756','123685','123877','123686','123878','123687','123879','123688','123880','126000','125881','126001','125821','126003','125822','126002','125823','131389','119756','121413','122155','130200','130122','130196','130118','130197','125687','130199','129735','130198','125686','130961','130962','130774','123877','131653','109676','133685','133699','131587','131588','134432','134433','134679','134433','131595','131594','135355','135362',LTRIM(T1.SOLD_TO,0))) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+)   
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(T1.LOC_CURRCY) = 'IDR'
                        AND   UPPER(T1.BILL_TYPE) IN ('ZF2I','ZL2I','ZC2I','ZG2I','S1','S2')
                        AND   UPPER(T1.MATERIAL) != 'REBATE'
                        AND   LTRIM(T1.SOLD_TO,0) != '590092');
            {% elif i[1] == 'MBOX' %}
                INSERT INTO {% if target.name=='prod' %}
                    idnwks_integration.wks_itg_all_distributor_sellin_sellout_fact
                {% else %}
                    {{schema}}.idnwks_integration__wks_itg_all_distributor_sellin_sellout_fact
                {% endif %}
                (
                    IDENTIFIER,
                    TRANS_KEY,
                    BILL_DOC,
                    BILL_DT,
                    JJ_MNTH_ID,
                    JJ_WK,
                    DSTRBTR_GRP_CD,
                    DSTRBTR_ID,
                    JJ_SAP_DSTRBTR_ID,
                    DSTRBTR_CUST_ID,
                    DSTRBTR_PROD_ID,
                    JJ_SAP_PROD_ID,
                    DSTRBTN_CHNL,
                    GRP_OUTLET,
                    DSTRBTR_SLSMN_ID,
                    SELLIN_QTY,
                    SELLOUT_QTY,
                    SELLIN_VAL,
                    GROSS_SELLIN_VAL,
                    GROSS_SELLOUT_VAL,
                    SELLOUT_VAL,
                    TRD_DSCNT,
                    DSTRBTR_NET_VAL,
                    RTRN_QTY,
                    RTRN_VAL
                    )
                    SELECT 'SELLOUT' AS IDENTIFIER,
                        T1.TRANS_KEY,
                        T1.BILL_DOC,
                        T1.BILL_DT,
                        T1.JJ_MNTH_ID,
                        T1.JJ_WK,
                        T1.DSTRBTR_GRP_CD,
                        T1.DSTRBTR_ID,
                        T1.JJ_SAP_DSTRBTR_ID,
                        T1.DSTRBTR_CUST_ID,
                        T1.DSTRBTR_PROD_ID,
                        T1.JJ_SAP_PROD_ID,
                        T1.DSTRBTN_CHNL,
                        T1.GRP_OUTLET,
                        T1.DSTRBTR_SLSMN_ID,
                        0 AS SELLIN_QTY,
                        T1.SLS_QTY AS SELLOUT_QTY,
                        0 AS SELLIN_VAL,
                        0 AS GROSS_SELLIN_VAL,
                        T1.GRS_VAL AS GROSS_SELLOUT_VAL,
                        T1.JJ_NET_VAL AS SELLOUT_VAL,
                        T1.TRD_DSCNT,
                        T1.DSTRBTR_NET_VAL,
                        T1.RTRN_QTY,
                        T1.RTRN_VAL
                    FROM {{ ref('idnitg_integration__itg_all_non_ivy_distributor_sellout_sales_fact') }} T1,
                        WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                        {{ source('idnedw_integration','edw_time_dim') }} T2
                    WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                    AND   UPPER(TRIM(T1.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                    AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                    AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                    UNION ALL
                    SELECT IDENTIFIER,
                        TRANS_KEY,
                        BILL_DOC,
                        BILL_DT,
                        CAST(JJ_MNTH_ID AS VARCHAR) AS JJ_MNTH_ID,
                        CASt(JJ_WK AS VARCHAR) AS JJ_WK,
                        DSTRBTR_GRP_CD,
                        DSTRBTR_ID,
                        JJ_SAP_DSTRBTR_ID,
                        DSTRBTR_CUST_ID,
                        DSTRBTR_PROD_ID,
                        JJ_SAP_PROD_ID,
                        DSTRBTN_CHNL,
                        GRP_OUTLET,
                        DSTRBTR_SLSMN_ID,
                        SELLIN_QTY,
                        SELLOUT_QTY,
                        SELLIN_VAL,
                        GROSS_SELLIN_VAL,
                        GROSS_SELLOUT_VAL,
                        SELLOUT_VAL,
                        TRD_DSCNT,
                        DSTRBTR_NET_VAL,
                        RTRN_QTY,
                        RTRN_VAL
                    FROM (SELECT 'SELLIN' AS IDENTIFIER,
                                (T1.JJ_SAP_DSTRBTR_ID||T1.JJ_SAP_PROD_ID||T1.BILL_DOC||TO_DATE(T1.BILL_DT)) AS TRANS_KEY,
                                UPPER(TRIM(BILL_DOC)) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                T1.JJ_SAP_DSTRBTR_ID AS DSTRBTR_ID,
                                T1.JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                T1.JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.NET_VAL AS SELLIN_VAL,
                                T1.NET_VAL AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('idnitg_integration__itg_all_distributor_sellin_sales_fact') }} T1,
                            {{ source('idnedw_integration','edw_time_dim') }} T2,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(TRIM(T1.JJ_SAP_DSTRBTR_ID)) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+)  
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(TRIM(T1.BILL_TYPE_ID)) IN ('F2','RE')
                        UNION ALL
                        SELECT 'SELLIN' AS IDENTIFIER,
                                ((DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) ) ||LTRIM(T1.MATERIAL,0) ||T1.BILL_NUM||T1.BILL_DT) AS TRANS_KEY,
                                UPPER(TRIM(LTRIM(T1.BILL_NUM,0))) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS DSTRBTR_ID,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                LTRIM(T1.MATERIAL,0) AS JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.BILL_QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.REBATE_BAS AS SELLIN_VAL,
                                T1.SUBTOTAL_1 AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('aspedw_integration__edw_billing_fact') }} T1,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            {{ source('idnedw_integration','edw_time_dim') }} T2
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(DECODE(LTRIM(T1.SOLD_TO,0),'120166','115330','120167','115327','120168','115329','120169','115328','120170','116193','120165','116193','120171','116194','120173','116206','120174','116207','120172','116195','123537','119756','123685','123877','123686','123878','123687','123879','123688','123880','126000','125881','126001','125821','126003','125822','126002','125823','131389','119756','121413','122155','130200','130122','130196','130118','130197','125687','130199','129735','130198','125686','130961','130962','130774','123877','131653','109676','133685','133699','131587','131588','134432','134433','134679','134433','131595','131594','135355','135362',LTRIM(T1.SOLD_TO,0))) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+)   
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(T1.LOC_CURRCY) = 'IDR'
                        AND   UPPER(T1.BILL_TYPE) IN ('ZF2I','ZL2I','ZC2I','ZG2I','S1','S2')
                        AND   UPPER(T1.MATERIAL) != 'REBATE'
                        AND   LTRIM(T1.SOLD_TO,0) != '590092');
            {% elif i[1] == 'DMS' %}
                INSERT INTO {% if target.name=='prod' %}
                    idnwks_integration.wks_itg_all_distributor_sellin_sellout_fact
                {% else %}
                    {{schema}}.idnwks_integration__wks_itg_all_distributor_sellin_sellout_fact
                {% endif %}
                (
                    IDENTIFIER,
                    TRANS_KEY,
                    BILL_DOC,
                    BILL_DT,
                    JJ_MNTH_ID,
                    JJ_WK,
                    DSTRBTR_GRP_CD,
                    DSTRBTR_ID,
                    JJ_SAP_DSTRBTR_ID,
                    DSTRBTR_CUST_ID,
                    DSTRBTR_PROD_ID,
                    JJ_SAP_PROD_ID,
                    DSTRBTN_CHNL,
                    GRP_OUTLET,
                    DSTRBTR_SLSMN_ID,
                    SELLIN_QTY,
                    SELLOUT_QTY,
                    SELLIN_VAL,
                    GROSS_SELLIN_VAL,
                    GROSS_SELLOUT_VAL,
                    SELLOUT_VAL,
                    TRD_DSCNT,
                    DSTRBTR_NET_VAL,
                    RTRN_QTY,
                    RTRN_VAL
                    )
                    SELECT 'SELLOUT' AS IDENTIFIER,
                        T1.TRANS_KEY,
                        T1.BILL_DOC,
                        T1.BILL_DT,
                        T1.JJ_MNTH_ID,
                        T1.JJ_WK,
                        T1.DSTRBTR_GRP_CD,
                        T1.DSTRBTR_ID,
                        T1.JJ_SAP_DSTRBTR_ID,
                        T1.DSTRBTR_CUST_ID,
                        T1.DSTRBTR_PROD_ID,
                        T1.JJ_SAP_PROD_ID,
                        T1.DSTRBTN_CHNL,
                        T1.GRP_OUTLET,
                        T1.DSTRBTR_SLSMN_ID,
                        0 AS SELLIN_QTY,
                        CASE
                            WHEN T1.GRS_VAL < 0 AND T1.SLS_QTY > 0 THEN (-1*T1.SLS_QTY)
                            ELSE T1.SLS_QTY
                        END AS SELLOUT_QTY,
                        0 AS SELLIN_VAL,
                        0 AS GROSS_SELLIN_VAL,
                        T1.GRS_VAL AS GROSS_SELLOUT_VAL,
                        T1.JJ_NET_VAL AS SELLOUT_VAL,
                        T1.TRD_DSCNT,
                        T1.DSTRBTR_NET_VAL,
                        CASE
                            WHEN T1.GRS_VAL < 0 AND T1.SLS_QTY > 0 THEN T1.SLS_QTY
                            ELSE T1.RTRN_QTY
                        END AS RTRN_QTY,
                        CASE
                            WHEN T1.GRS_VAL < 0 AND T1.SLS_QTY > 0 THEN (-1*T1.JJ_NET_VAL)
                            ELSE T1.RTRN_VAL
                        END AS RTRN_VAL
                    FROM {{ ref('idnitg_integration__itg_all_ivy_distributor_sellout_sales_fact') }} T1,
                        WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                        {{ source('idnedw_integration','edw_time_dim') }} T2
                    WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                    AND   UPPER(TRIM(T1.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                    AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                    AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                    UNION ALL
                    SELECT IDENTIFIER,
                        TRANS_KEY,
                        BILL_DOC,
                        BILL_DT,
                        CAST(JJ_MNTH_ID AS VARCHAR) AS JJ_MNTH_ID,
                        CASt(JJ_WK AS VARCHAR) AS JJ_WK,
                        DSTRBTR_GRP_CD,
                        DSTRBTR_ID,
                        JJ_SAP_DSTRBTR_ID,
                        DSTRBTR_CUST_ID,
                        DSTRBTR_PROD_ID,
                        JJ_SAP_PROD_ID,
                        DSTRBTN_CHNL,
                        GRP_OUTLET,
                        DSTRBTR_SLSMN_ID,
                        SELLIN_QTY,
                        SELLOUT_QTY,
                        SELLIN_VAL,
                        GROSS_SELLIN_VAL,
                        GROSS_SELLOUT_VAL,
                        SELLOUT_VAL,
                        TRD_DSCNT,
                        DSTRBTR_NET_VAL,
                        RTRN_QTY,
                        RTRN_VAL
                    FROM (SELECT 'SELLIN' AS IDENTIFIER,
                                (T1.JJ_SAP_DSTRBTR_ID||T1.JJ_SAP_PROD_ID||T1.BILL_DOC||TO_DATE(T1.BILL_DT)) AS TRANS_KEY,
                                UPPER(TRIM(BILL_DOC)) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                T1.JJ_SAP_DSTRBTR_ID AS DSTRBTR_ID,
                                T1.JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                T1.JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.NET_VAL AS SELLIN_VAL,
                                T1.NET_VAL AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('idnitg_integration__itg_all_distributor_sellin_sales_fact') }} T1,
                            {{ source('idnedw_integration','edw_time_dim') }} T2,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(TRIM(T1.JJ_SAP_DSTRBTR_ID)) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+) 
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(TRIM(T1.BILL_TYPE_ID)) IN ('F2','RE')
                        UNION ALL
                        SELECT 'SELLIN' AS IDENTIFIER,
                                ((DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) ) ||LTRIM(T1.MATERIAL,0) ||T1.BILL_NUM||T1.BILL_DT) AS TRANS_KEY,
                                UPPER(TRIM(LTRIM(T1.BILL_NUM,0))) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS DSTRBTR_ID,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                LTRIM(T1.MATERIAL,0) AS JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.BILL_QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.REBATE_BAS AS SELLIN_VAL,
                                T1.SUBTOTAL_1 AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('aspedw_integration__edw_billing_fact') }} T1,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            {{ source('idnedw_integration','edw_time_dim') }} T2
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(DECODE(LTRIM(T1.SOLD_TO,0),'120166','115330','120167','115327','120168','115329','120169','115328','120170','116193','120165','116193','120171','116194','120173','116206','120174','116207','120172','116195','123537','119756','123685','123877','123686','123878','123687','123879','123688','123880','126000','125881','126001','125821','126003','125822','126002','125823','131389','119756','121413','122155','130200','130122','130196','130118','130197','125687','130199','129735','130198','125686','130961','130962','130774','123877','131653','109676','133685','133699','131587','131588','134432','134433','134679','134433','131595','131594','135355','135362',LTRIM(T1.SOLD_TO,0))) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+) 
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(T1.LOC_CURRCY) = 'IDR'
                        AND   UPPER(T1.BILL_TYPE) IN ('ZF2I','ZL2I','ZC2I','ZG2I','S1','S2')
                        AND   UPPER(T1.MATERIAL) != 'REBATE'
                        AND   LTRIM(T1.SOLD_TO,0) != '590092');
            {% elif i[1] == 'SAP' %}
                INSERT INTO {% if target.name=='prod' %}
                    idnwks_integration.wks_itg_all_distributor_sellin_sellout_fact
                {% else %}
                    {{schema}}.idnwks_integration__wks_itg_all_distributor_sellin_sellout_fact
                {% endif %}
                (
                    IDENTIFIER,
                    TRANS_KEY,
                    BILL_DOC,
                    BILL_DT,
                    JJ_MNTH_ID,
                    JJ_WK,
                    DSTRBTR_GRP_CD,
                    DSTRBTR_ID,
                    JJ_SAP_DSTRBTR_ID,
                    DSTRBTR_CUST_ID,
                    DSTRBTR_PROD_ID,
                    JJ_SAP_PROD_ID,
                    DSTRBTN_CHNL,
                    GRP_OUTLET,
                    DSTRBTR_SLSMN_ID,
                    SELLIN_QTY,
                    SELLOUT_QTY,
                    SELLIN_VAL,
                    GROSS_SELLIN_VAL,
                    GROSS_SELLOUT_VAL,
                    SELLOUT_VAL,
                    TRD_DSCNT,
                    DSTRBTR_NET_VAL,
                    RTRN_QTY,
                    RTRN_VAL
                    )
                    SELECT IDENTIFIER,
                        TRANS_KEY,
                        BILL_DOC,
                        BILL_DT,
                        CAST(JJ_MNTH_ID AS VARCHAR) AS JJ_MNTH_ID,
                        CAST(JJ_WK AS VARCHAR) AS JJ_WK,
                        DSTRBTR_GRP_CD,
                        DSTRBTR_ID,
                        JJ_SAP_DSTRBTR_ID,
                        DSTRBTR_CUST_ID,
                        DSTRBTR_PROD_ID,
                        JJ_SAP_PROD_ID,
                        DSTRBTN_CHNL,
                        GRP_OUTLET,
                        DSTRBTR_SLSMN_ID,
                        SELLIN_QTY,
                        SELLOUT_QTY,
                        SELLIN_VAL,
                        GROSS_SELLIN_VAL,
                        GROSS_SELLOUT_VAL,
                        SELLOUT_VAL,
                        TRD_DSCNT,
                        DSTRBTR_NET_VAL,
                        RTRN_QTY,
                        RTRN_VAL
                    FROM (SELECT 'SELLOUT_NKA_ECOM' AS IDENTIFIER,
                                (T1.JJ_SAP_DSTRBTR_ID||T1.JJ_SAP_PROD_ID||T1.BILL_DOC||TO_DATE(T1.BILL_DT)) AS TRANS_KEY,
                                UPPER(TRIM(BILL_DOC)) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                T1.JJ_SAP_DSTRBTR_ID AS DSTRBTR_ID,
                                T1.JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                T1.JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                0 AS SELLIN_QTY,
                                T1.QTY AS SELLOUT_QTY,
                                0 AS SELLIN_VAL,
                                0 AS GROSS_SELLIN_VAL,
                                T1.NET_VAL AS GROSS_SELLOUT_VAL,
                                T1.NET_VAL AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('idnitg_integration__itg_all_distributor_sellin_sales_fact') }} T1,
                            {{ source('idnedw_integration','edw_time_dim') }} T2,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(TRIM(T1.JJ_SAP_DSTRBTR_ID)) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+)  
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(TRIM(T1.BILL_TYPE_ID)) IN ('F2','RE')
                        AND   UPPER(TRIM(EDD.REGION)) IN ('NATIONAL ACCOUNT','E-COMMERCE','TMP')
                        UNION ALL
                        SELECT 'SELLOUT_NKA_ECOM' AS IDENTIFIER,
                                ((DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) ) ||LTRIM(T1.MATERIAL,0) ||T1.BILL_NUM||T1.BILL_DT) AS TRANS_KEY,
                                UPPER(TRIM(LTRIM(T1.BILL_NUM,0))) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS DSTRBTR_ID,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                LTRIM(T1.MATERIAL,0) AS JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                0 AS SELLIN_QTY,
                                T1.BILL_QTY AS SELLOUT_QTY,
                                0 AS SELLIN_VAL,
                                0 AS GROSS_SELLIN_VAL,
                                T1.SUBTOTAL_1 AS GROSS_SELLOUT_VAL,
                                T1.REBATE_BAS AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('aspedw_integration__edw_billing_fact') }} T1,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            {{ source('idnedw_integration','edw_time_dim') }} T2
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(DECODE(LTRIM(T1.SOLD_TO,0),'120166','115330','120167','115327','120168','115329','120169','115328','120170','116193','120165','116193','120171','116194','120173','116206','120174','116207','120172','116195','123537','119756','123685','123877','123686','123878','123687','123879','123688','123880','126000','125881','126001','125821','126003','125822','126002','125823','131389','119756','121413','122155','130200','130122','130196','130118','130197','125687','130199','129735','130198','125686','130961','130962','130774','123877','131653','109676','133685','133699','131587','131588','134432','134433','134679','134433','131595','131594','135355','135362',LTRIM(T1.SOLD_TO,0))) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+)  
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(TRIM(EDD.REGION)) IN ('NATIONAL ACCOUNT','E-COMMERCE','TMP')
                        AND   UPPER(T1.LOC_CURRCY) = 'IDR'
                        AND   UPPER(T1.BILL_TYPE) IN ('ZF2I','ZL2I','ZC2I','ZG2I','S1','S2')
                        AND   UPPER(T1.MATERIAL) != 'REBATE'
                        AND   LTRIM(T1.SOLD_TO,0) != '590092')
                    UNION ALL
                    SELECT IDENTIFIER,
                        TRANS_KEY,
                        BILL_DOC,
                        BILL_DT,
                        CAST(JJ_MNTH_ID AS VARCHAR) AS JJ_MNTH_ID,
                        CASt(JJ_WK AS VARCHAR) AS JJ_WK,
                        DSTRBTR_GRP_CD,
                        DSTRBTR_ID,
                        JJ_SAP_DSTRBTR_ID,
                        DSTRBTR_CUST_ID,
                        DSTRBTR_PROD_ID,
                        JJ_SAP_PROD_ID,
                        DSTRBTN_CHNL,
                        GRP_OUTLET,
                        DSTRBTR_SLSMN_ID,
                        SELLIN_QTY,
                        SELLOUT_QTY,
                        SELLIN_VAL,
                        GROSS_SELLIN_VAL,
                        GROSS_SELLOUT_VAL,
                        SELLOUT_VAL,
                        TRD_DSCNT,
                        DSTRBTR_NET_VAL,
                        RTRN_QTY,
                        RTRN_VAL
                    FROM (SELECT 'SELLIN' AS IDENTIFIER,
                                (T1.JJ_SAP_DSTRBTR_ID||T1.JJ_SAP_PROD_ID||T1.BILL_DOC||TO_DATE(T1.BILL_DT)) AS TRANS_KEY,
                                UPPER(TRIM(BILL_DOC)) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                T1.JJ_SAP_DSTRBTR_ID AS DSTRBTR_ID,
                                T1.JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                T1.JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.NET_VAL AS SELLIN_VAL,
                                T1.NET_VAL AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('idnitg_integration__itg_all_distributor_sellin_sales_fact') }} T1,
                            {{ source('idnedw_integration','edw_time_dim') }} T2,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(TRIM(T1.JJ_SAP_DSTRBTR_ID)) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+)  
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(TRIM(T1.BILL_TYPE_ID)) IN ('F2','RE')
                        UNION ALL
                        SELECT 'SELLIN' AS IDENTIFIER,
                                ((DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) ) ||LTRIM(T1.MATERIAL,0) ||T1.BILL_NUM||T1.BILL_DT) AS TRANS_KEY,
                                UPPER(TRIM(LTRIM(T1.BILL_NUM,0))) AS BILL_DOC,
                                T1.BILL_DT,
                                T2.JJ_MNTH_ID,
                                T2.JJ_WK,
                                EDD.DSTRBTR_GRP_CD,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS DSTRBTR_ID,
                                DECODE(LTRIM(T1.SOLD_TO,0),
                                    '120166','115330',
                                    '120167','115327',
                                    '120168','115329',
                                    '120169','115328',
                                    '120170','116193',
                                    '120165','116193',
                                    '120171','116194',
                                    '120173','116206',
                                    '120174','116207',
                                    '120172','116195',
                                    '123537','119756',
                                    '123685','123877',
                                    '123686','123878',
                                    '123687','123879',
                                    '123688','123880',
                                    '126000','125881',
                                    '126001','125821',
                                    '126003','125822',
                                    '126002','125823',
                                    '131389','119756',
                                    '121413','122155',
                                    '130200','130122',
                                    '130196','130118',
                                    '130197','125687',
                                    '130199','129735',
                                    '130198','125686',
                                    '130961','130962',
                                    '130774','123877',
                                    '131653','109676',
                                    '133685','133699',
                                    '131587','131588',
                                    '134432','134433',
                                    '134679','134433',
                                    '131595','131594',
                                    '135355','135362',
                                    LTRIM(T1.SOLD_TO,0)
                                ) AS JJ_SAP_DSTRBTR_ID,
                                'N/A' AS DSTRBTR_CUST_ID,
                                'N/A' AS DSTRBTR_PROD_ID,
                                LTRIM(T1.MATERIAL,0) AS JJ_SAP_PROD_ID,
                                '0' AS DSTRBTN_CHNL,
                                '0' AS GRP_OUTLET,
                                'Noname' AS DSTRBTR_SLSMN_ID,
                                T1.BILL_QTY AS SELLIN_QTY,
                                0 AS SELLOUT_QTY,
                                T1.REBATE_BAS AS SELLIN_VAL,
                                T1.SUBTOTAL_1 AS GROSS_SELLIN_VAL,
                                0 AS GROSS_SELLOUT_VAL,
                                0 AS SELLOUT_VAL,
                                0 AS TRD_DSCNT,
                                0 AS DSTRBTR_NET_VAL,
                                0 AS RTRN_QTY,
                                0 AS RTRN_VAL
                        FROM {{ ref('aspedw_integration__edw_billing_fact') }} T1,
                            WKS_MDS_ID_DIST_REPORTING_CONTROL_SELLIN_SELLOUT_FACT DIST_CNT,
                            {{ ref('idnedw_integration__edw_distributor_dim') }} EDD,
                            {{ source('idnedw_integration','edw_time_dim') }} T2
                        WHERE TO_DATE(T1.BILL_DT) = TO_DATE(T2.CAL_DATE)
                        AND   UPPER(DECODE(LTRIM(T1.SOLD_TO,0),'120166','115330','120167','115327','120168','115329','120169','115328','120170','116193','120165','116193','120171','116194','120173','116206','120174','116207','120172','116195','123537','119756','123685','123877','123686','123878','123687','123879','123688','123880','126000','125881','126001','125821','126003','125822','126002','125823','131389','119756','121413','122155','130200','130122','130196','130118','130197','125687','130199','129735','130198','125686','130961','130962','130774','123877','131653','109676','133685','133699','131587','131588','134432','134433','134679','134433','131595','131594','135355','135362',LTRIM(T1.SOLD_TO,0))) = UPPER(TRIM(EDD.JJ_SAP_DSTRBTR_ID))
                        and T2.jj_mnth_id between EDD.effective_from(+) and EDD.effective_to(+) 
                        AND   UPPER(TRIM(EDD.DSTRBTR_GRP_CD)) = UPPER(TRIM(DIST_CNT.DISTRIBUTOR_CD))
                        AND   T2.JJ_MNTH_ID >= DIST_CNT.EFFECTIVE_FROM
                        AND   T2.JJ_MNTH_ID <= DIST_CNT.EFFECTIVE_TO
                        AND   UPPER(T1.LOC_CURRCY) = 'IDR'
                        AND   UPPER(T1.BILL_TYPE) IN ('ZF2I','ZL2I','ZC2I','ZG2I','S1','S2')
                        AND   UPPER(T1.MATERIAL) != 'REBATE'
                        AND   LTRIM(T1.SOLD_TO,0) != '590092');
            {% endif %}
            {% endset %}
            {{ log("Execute WKS_ITG_ALL_DISTRIBUTOR_SELLIN_SELLOUT_FACT table load") }}
            {% do run_query(sql_stmnt_loop) %}
        {% endfor %}
        
{% endmacro %}