--Import CTE
with source as (
    select * from {{ ref('aspwks_integration__wks_sap_mara_extract') }}
),

--Logical CTE

--Final CTE
trans as (
    select
        matnr as matl_num, 
        try_to_date(ersda, 'yyyymmdd') as crt_on, 
        ernam as crt_by_nm, 
        try_to_date(laeda, 'yyyymmdd') as chg_dttm, 
        aenam as chg_by_nm, 
        vpsta as maint_sts_cmplt_matl, 
        pstat as maint_sts, 
        lvorm as fl_matl_del_clnt_lvl, 
        mtart as matl_type_cd, 
        mbrsh as indstr_sectr, 
        matkl as matl_grp_cd, 
        bismt as old_matl_num, 
        meins as base_uom_cd, 
        bstme as prch_uom_cd, 
        zeinr as doc_num, 
        zeiar as doc_type, 
        zeivr as doc_vers, 
        zeifo as pg_fmt__doc, 
        aeszn as doc_chg_num, 
        blatt as pg_num_doc, 
        try_cast(blanz as int) as num_sht, 
        ferth as prdtn_memo_txt, 
        formt as pg_fmt_prdtn_memo, 
        groes as size_dims_txt, 
        wrkst as bsc_matl, 
        normt as indstr_std_desc, 
        labor as mercia_plan, 
        ekwsl as prchsng_val_key, 
        brgew as grs_wt_meas, 
        ntgew as net_wt_meas, 
        gewei as wt_uom_cd, 
        volum as vol_meas, 
        voleh as vol_uom_cd, 
        behvo as cntnr_rqr, 
        raube as strg_cond, 
        tempb as temp_cond_ind, 
        disst as low_lvl_cd, 
        tragr as trspn_grp, 
        stoff as haz_matl_num, 
        spart as div, 
        kunnr as cmpt, 
        eannr as ean_obsol, 
        wesch as gr_prtd_qty, 
        bwvor as prcmt_rule, 
        bwscl as src_supl, 
        saiso as seasn_cat, 
        etiar as lbl_type_cd, 
        etifo as lbl_form, 
        entar as deact, 
        ean11 as prmry_upc_cd, 
        numtp as ean_cat, 
        laeng as lgth_meas, 
        breit as wdth_meas, 
        hoehe as hght_meas, 
        meabm as dim_uom_cd, 
        prdha as prod_hier_cd, 
        aeklk as stk_tfr_chg_cost, 
        cadkz as cad_ind, 
        qmpur as qm_prcmt_act, 
        ergew as allw_pkgng_wt, 
        ergei as wt_unit, 
        ervol as allw_pkgng_vol, 
        ervoe as vol_unit, 
        gewto as exces_wt_tlrnc, 
        volto as exces_vol_tlrnc, 
        vabme as var_prch_ord_unit, 
        kzrev as rvsn_lvl_asgn_matl, 
        kzkfg as configurable_matl_ind, 
        xchpf as btch_mgmt_reqt_ind, 
        vhart as pkgng_matl_type_cd, 
        fuelg as max_lvl_vol, 
        try_cast(stfak as int) as stack_fact, 
        magrv as pkgng_matl_grp, 
        begru as auth_grp, 
        try_to_date(datab, 'yyyymmdd') as vld_from_dt, 
        try_to_date(liqdt, 'yyyymmdd') as del_dt, 
        saisj as seasn_yr, 
        plgtp as prc_bnd_cat, 
        mlgut as bill_of_matl, 
        extwg as extrnl_matl_grp_txt, 
        satnr as cross_plnt_cnfg_matl, 
        attyp as matl_cat, 
        kzkup as matl_coprod_ind, 
        kznfm as fllp_matl_ind, 
        pmata as prc_ref_matl, 
        mstae as cros_plnt_matl_sts, 
        mstav as cros_dstn_chn_matl_sts, 
        try_to_date(mstde, 'yyyymmdd') as cros_plnt_matl_sts_vld_dt, 
        try_to_date(mstdv, 'yyyymmdd') as chn_matl_vld_from_dt, 
        taklv as tax_clsn_matl, 
        rbnrm as catlg_prfl, 
        mhdrz as min_rmn_shlf_lif, 
        mhdhb as tot_shlf_lif, 
        mhdlp as strg_pct, 
        inhme as cntnt_uom_cd, 
        inhal as net_cntnt_meas, 
        vpreh as cmpr_prc_unit, 
        etiag as isr_matl_grp, 
        inhbr as grs_cntnt_meas, 
        cmeth as qty_conv_meth, 
        try_cast(cuobf as int) as intrnl_obj_num, 
        kzumw as envmt_rlvnt, 
        kosch as prod_allc_dtrmn_proc, 
        trim(sprof) as prc_prfl_vrnt, 
        trim(nrfhg) as matl_qual_disc, 
        null as mfr_part_num,
        trim(mfrnr) as mfr_num, 
        trim(bmatn) as intrnl_inv_mgmt, 
        mprof as mfr_part_prfl, 
        kzwsm as meas_usg_unit, 
        saity as rollout_seasn, 
        profl as dngrs_goods_ind_prof, 
        ihivi as hi_viscous_ind, 
        iloos as in_bulk_lqd_ind, 
        serlv as lvl_explc_ser_num, 
        kzgvh as pkgng_matl_clse_pkgng, 
        xgchp as appr_btch_rec_ind, 
        kzeff as ovrd_chg_num, 
        try_cast(compl as int) as matl_cmplt_lvl, 
        iprkz as per_ind_shlf_lif_expn_dt, 
        rdmhd as rd_rule_sled, 
        przus as prod_cmpos_prtd_pkgng, 
        mtpos_mara as genl_item_cat_grp, 
        bflme as gn_matl_logl_vrnt, 
        zz_mvgr1 as prod_base, 
        zz_mvgr2 as vrnt, 
        zz_mvgr3 as put_up, 
        zz_mvgr4 as mega_brnd_cd, 
        zz_mvgr5 as brnd_cd, 
        zz_technology as tech, 
        zz_color as color, 
        zz_stack_factor as seasonality, 
        zz_mfgsource as mfg_src_cd, 
        trim(mfrpn) as mfr_part_num_new, 
        zz_fornum as formulation_num, 
        zz_fran as pka_franchise_cd, 
        ztranfran_zfrandesc as pka_franchise_desc, 
        zz_brand as pka_brand_cd, 
        ztranbrand_zbrandesc as pka_brand_desc, 
        zz_sbrand as pka_sub_brand_cd, 
        ztransbrand_zsbrandesc as pka_sub_brand_desc, 
        zz_variant as pka_variant_cd, 
        ztranvariant_zvardesc as pka_variant_desc, 
        zz_svariant as pka_sub_variant_cd, 
        ztransvariant_zsvardesc as pka_sub_variant_desc, 
        zz_flav as pka_flavor_cd, 
        ztranflav_zflavdesc as pka_flavor_desc, 
        zz_ingr as pka_ingredient_cd, 
        ztraningr_zingrdesc as pka_ingredient_desc, 
        zz_appl as pka_application_cd, 
        ztranappl_zappldesc as pka_application_desc, 
        zz_leng as pka_length_cd, 
        ztranleng_zlengdesc as pka_length_desc, 
        zz_shape as pka_shape_cd, 
        ztranshape_zzshapedesc as pka_shape_desc, 
        zz_spf as pka_spf_cd, 
        ztranspf_zzspfdesc as pka_spf_desc, 
        zz_cover as pka_cover_cd, 
        ztrancover_zcoverdesc as pka_cover_desc, 
        zz_form as pka_form_cd, 
        ztranform_zzformdesc as pka_form_desc, 
        zz_size as pka_size_cd, 
        ztransize_zsizedesc as pka_size_desc, 
        zz_char as pka_character_cd, 
        ztranchar_zchardesc as pka_character_desc, 
        zz_pack as pka_package_cd, 
        ztranpack_zpackdesc as pka_package_desc, 
        zz_attrib13 as pka_attribute_13_cd, 
        ztranattrib13_zattrib13desc as pka_attribute_13_desc, 
        zz_attrib14 as pka_attribute_14_cd, 
        ztranattrib14_zattrib14desc as pka_attribute_14_desc, 
        zz_sku as pka_sku_identification_cd, 
        ztransku_zskudesc as pka_sku_identification_desc, 
        zz_relabel as pka_one_time_relabeling_cd, 
        ztranrelabel_zrelabeldesc as pka_one_time_relabeling_desc, 
        zz_prodkey as pka_product_key, 
        zz_proddesc1 as pka_product_key_description, 
        zz_proddesc2 as pka_product_key_description_2, 
        zz_rootcode as pka_root_code, 
        zz_rootdesc1 as pka_root_code_desc_1, 
        zz_rootdesc2 as pka_root_code_desc_2, 
        current_timestamp()::timestamp_ntz(9)as crt_dttm, 
        current_timestamp()::timestamp_ntz(9)as updt_dttm
    from source
),
final as
(
    select
        matl_num::varchar(40) as matl_num,
        crt_on::date as crt_on,
        crt_by_nm::varchar(12) as crt_by_nm,
        chg_dttm::date as chg_dttm,
        chg_by_nm::varchar(12) as chg_by_nm,
        maint_sts_cmplt_matl::varchar(15) as maint_sts_cmplt_matl,
        maint_sts::varchar(15) as maint_sts,
        fl_matl_del_clnt_lvl::varchar(10) as fl_matl_del_clnt_lvl,
        matl_type_cd::varchar(10) as matl_type_cd,
        indstr_sectr::varchar(10) as indstr_sectr,
        matl_grp_cd::varchar(20) as matl_grp_cd,
        old_matl_num::varchar(40) as old_matl_num,
        base_uom_cd::varchar(10) as base_uom_cd,
        prch_uom_cd::varchar(10) as prch_uom_cd,
        doc_num::varchar(22) as doc_num,
        doc_type::varchar(10) as doc_type,
        doc_vers::varchar(10) as doc_vers,
        pg_fmt__doc::varchar(10) as pg_fmt__doc,
        doc_chg_num::varchar(20) as doc_chg_num,
        pg_num_doc::varchar(10) as pg_num_doc,
        num_sht::number(18,0) as num_sht,
        prdtn_memo_txt::varchar(40) as prdtn_memo_txt,
        pg_fmt_prdtn_memo::varchar(10) as pg_fmt_prdtn_memo,
        size_dims_txt::varchar(32) as size_dims_txt,
        bsc_matl::varchar(100) as bsc_matl,
        indstr_std_desc::varchar(40) as indstr_std_desc,
        mercia_plan::varchar(10) as mercia_plan,
        prchsng_val_key::varchar(10) as prchsng_val_key,
        grs_wt_meas::number(13,3) as grs_wt_meas,
        net_wt_meas::number(13,3) as net_wt_meas,
        wt_uom_cd::varchar(10) as wt_uom_cd,
        vol_meas::number(13,3) as vol_meas,
        vol_uom_cd::varchar(10) as vol_uom_cd,
        cntnr_rqr::varchar(10) as cntnr_rqr,
        strg_cond::varchar(10) as strg_cond,
        temp_cond_ind::varchar(10) as temp_cond_ind,
        low_lvl_cd::varchar(10) as low_lvl_cd,
        trspn_grp::varchar(10) as trspn_grp,
        haz_matl_num::varchar(40) as haz_matl_num,
        div::varchar(10) as div,
        cmpt::varchar(10) as cmpt,
        ean_obsol::varchar(13) as ean_obsol,
        gr_prtd_qty::number(13,3) as gr_prtd_qty,
        prcmt_rule::varchar(10) as prcmt_rule,
        src_supl::varchar(10) as src_supl,
        seasn_cat::varchar(10) as seasn_cat,
        lbl_type_cd::varchar(10) as lbl_type_cd,
        lbl_form::varchar(10) as lbl_form,
        deact::varchar(10) as deact,
        prmry_upc_cd::varchar(40) as prmry_upc_cd,
        ean_cat::varchar(10) as ean_cat,
        lgth_meas::number(13,3) as lgth_meas,
        wdth_meas::number(13,3) as wdth_meas,
        hght_meas::number(13,3) as hght_meas,
        dim_uom_cd::varchar(10) as dim_uom_cd,
        prod_hier_cd::varchar(40) as prod_hier_cd,
        stk_tfr_chg_cost::varchar(10) as stk_tfr_chg_cost,
        cad_ind::varchar(10) as cad_ind,
        qm_prcmt_act::varchar(10) as qm_prcmt_act,
        allw_pkgng_wt::number(13,3) as allw_pkgng_wt,
        wt_unit::varchar(10) as wt_unit,
        allw_pkgng_vol::number(13,3) as allw_pkgng_vol,
        vol_unit::varchar(10) as vol_unit,
        exces_wt_tlrnc::number(3,1) as exces_wt_tlrnc,
        exces_vol_tlrnc::number(3,1) as exces_vol_tlrnc,
        var_prch_ord_unit::varchar(10) as var_prch_ord_unit,
        rvsn_lvl_asgn_matl::varchar(10) as rvsn_lvl_asgn_matl,
        configurable_matl_ind::varchar(10) as configurable_matl_ind,
        btch_mgmt_reqt_ind::varchar(10) as btch_mgmt_reqt_ind,
        pkgng_matl_type_cd::varchar(10) as pkgng_matl_type_cd,
        max_lvl_vol::number(3,0) as max_lvl_vol,
        stack_fact::number(18,0) as stack_fact,
        pkgng_matl_grp::varchar(10) as pkgng_matl_grp,
        auth_grp::varchar(10) as auth_grp,
        vld_from_dt::date as vld_from_dt,
        del_dt::date as del_dt,
        seasn_yr::varchar(10) as seasn_yr,
        prc_bnd_cat::varchar(10) as prc_bnd_cat,
        bill_of_matl::varchar(10) as bill_of_matl,
        extrnl_matl_grp_txt::varchar(40) as extrnl_matl_grp_txt,
        cross_plnt_cnfg_matl::varchar(40) as cross_plnt_cnfg_matl,
        matl_cat::varchar(10) as matl_cat,
        matl_coprod_ind::varchar(10) as matl_coprod_ind,
        fllp_matl_ind::varchar(10) as fllp_matl_ind,
        prc_ref_matl::varchar(40) as prc_ref_matl,
        cros_plnt_matl_sts::varchar(10) as cros_plnt_matl_sts,
        cros_dstn_chn_matl_sts::varchar(10) as cros_dstn_chn_matl_sts,
        cros_plnt_matl_sts_vld_dt::date as cros_plnt_matl_sts_vld_dt,
        chn_matl_vld_from_dt::date as chn_matl_vld_from_dt,
        tax_clsn_matl::varchar(10) as tax_clsn_matl,
        catlg_prfl::varchar(20) as catlg_prfl,
        min_rmn_shlf_lif::number(4,0) as min_rmn_shlf_lif,
        tot_shlf_lif::number(4,0) as tot_shlf_lif,
        strg_pct::number(3,0) as strg_pct,
        cntnt_uom_cd::varchar(10) as cntnt_uom_cd,
        net_cntnt_meas::number(13,3) as net_cntnt_meas,
        cmpr_prc_unit::number(5,0) as cmpr_prc_unit,
        isr_matl_grp::varchar(40) as isr_matl_grp,
        grs_cntnt_meas::number(13,3) as grs_cntnt_meas,
        qty_conv_meth::varchar(10) as qty_conv_meth,
        intrnl_obj_num::number(18,0) as intrnl_obj_num,
        envmt_rlvnt::varchar(10) as envmt_rlvnt,
        prod_allc_dtrmn_proc::varchar(40) as prod_allc_dtrmn_proc,
        prc_prfl_vrnt::varchar(10) as prc_prfl_vrnt,
        matl_qual_disc::varchar(10) as matl_qual_disc,
        mfr_part_num::varchar(40) as mfr_part_num,
        mfr_num::varchar(10) as mfr_num,
        intrnl_inv_mgmt::varchar(40) as intrnl_inv_mgmt,
        mfr_part_prfl::varchar(10) as mfr_part_prfl,
        meas_usg_unit::varchar(10) as meas_usg_unit,
        rollout_seasn::varchar(10) as rollout_seasn,
        dngrs_goods_ind_prof::varchar(10) as dngrs_goods_ind_prof,
        hi_viscous_ind::varchar(10) as hi_viscous_ind,
        in_bulk_lqd_ind::varchar(10) as in_bulk_lqd_ind,
        lvl_explc_ser_num::varchar(10) as lvl_explc_ser_num,
        pkgng_matl_clse_pkgng::varchar(10) as pkgng_matl_clse_pkgng,
        appr_btch_rec_ind::varchar(10) as appr_btch_rec_ind,
        ovrd_chg_num::varchar(10) as ovrd_chg_num,
        matl_cmplt_lvl::number(18,0) as matl_cmplt_lvl,
        per_ind_shlf_lif_expn_dt::varchar(10) as per_ind_shlf_lif_expn_dt,
        rd_rule_sled::varchar(10) as rd_rule_sled,
        prod_cmpos_prtd_pkgng::varchar(10) as prod_cmpos_prtd_pkgng,
        genl_item_cat_grp::varchar(10) as genl_item_cat_grp,
        gn_matl_logl_vrnt::varchar(10) as gn_matl_logl_vrnt,
        prod_base::varchar(10) as prod_base,
        vrnt::varchar(10) as vrnt,
        put_up::varchar(10) as put_up,
        mega_brnd_cd::varchar(10) as mega_brnd_cd,
        brnd_cd::varchar(10) as brnd_cd,
        tech::varchar(10) as tech,
        color::varchar(10) as color,
        seasonality::varchar(10) as seasonality,
        mfg_src_cd::varchar(10) as mfg_src_cd,
        mfr_part_num_new::varchar(256) as mfr_part_num_new,
        formulation_num::varchar(50) as formulation_num,
        pka_franchise_cd::varchar(2) as pka_franchise_cd,
        pka_franchise_desc::varchar(30) as pka_franchise_desc,
        pka_brand_cd::varchar(2) as pka_brand_cd,
        pka_brand_desc::varchar(30) as pka_brand_desc,
        pka_sub_brand_cd::varchar(4) as pka_sub_brand_cd,
        pka_sub_brand_desc::varchar(30) as pka_sub_brand_desc,
        pka_variant_cd::varchar(4) as pka_variant_cd,
        pka_variant_desc::varchar(30) as pka_variant_desc,
        pka_sub_variant_cd::varchar(4) as pka_sub_variant_cd,
        pka_sub_variant_desc::varchar(30) as pka_sub_variant_desc,
        pka_flavor_cd::varchar(4) as pka_flavor_cd,
        pka_flavor_desc::varchar(30) as pka_flavor_desc,
        pka_ingredient_cd::varchar(4) as pka_ingredient_cd,
        pka_ingredient_desc::varchar(30) as pka_ingredient_desc,
        pka_application_cd::varchar(4) as pka_application_cd,
        pka_application_desc::varchar(30) as pka_application_desc,
        pka_length_cd::varchar(4) as pka_length_cd,
        pka_length_desc::varchar(30) as pka_length_desc,
        pka_shape_cd::varchar(4) as pka_shape_cd,
        pka_shape_desc::varchar(30) as pka_shape_desc,
        pka_spf_cd::varchar(4) as pka_spf_cd,
        pka_spf_desc::varchar(30) as pka_spf_desc,
        pka_cover_cd::varchar(4) as pka_cover_cd,
        pka_cover_desc::varchar(30) as pka_cover_desc,
        pka_form_cd::varchar(4) as pka_form_cd,
        pka_form_desc::varchar(30) as pka_form_desc,
        pka_size_cd::varchar(4) as pka_size_cd,
        pka_size_desc::varchar(30) as pka_size_desc,
        pka_character_cd::varchar(4) as pka_character_cd,
        pka_character_desc::varchar(30) as pka_character_desc,
        pka_package_cd::varchar(4) as pka_package_cd,
        pka_package_desc::varchar(30) as pka_package_desc,
        pka_attribute_13_cd::varchar(4) as pka_attribute_13_cd,
        pka_attribute_13_desc::varchar(30) as pka_attribute_13_desc,
        pka_attribute_14_cd::varchar(4) as pka_attribute_14_cd,
        pka_attribute_14_desc::varchar(30) as pka_attribute_14_desc,
        pka_sku_identification_cd::varchar(2) as pka_sku_identification_cd,
        pka_sku_identification_desc::varchar(30) as pka_sku_identification_desc,
        pka_one_time_relabeling_cd::varchar(2) as pka_one_time_relabeling_cd,
        pka_one_time_relabeling_desc::varchar(30) as pka_one_time_relabeling_desc,
        pka_product_key::varchar(68) as pka_product_key,
        pka_product_key_description::varchar(255) as pka_product_key_description,
        pka_product_key_description_2::varchar(255) as pka_product_key_description_2,
        pka_root_code::varchar(68) as pka_root_code,
        pka_root_code_desc_1::varchar(255) as pka_root_code_desc_1,
        pka_root_code_desc_2::varchar(255) as pka_root_code_desc_2,
        crt_dttm::timestamp_ntz(9) as crt_dttm,
        updt_dttm::timestamp_ntz(9) as updt_dttm
    from trans
)

--Final CTE
select * from final