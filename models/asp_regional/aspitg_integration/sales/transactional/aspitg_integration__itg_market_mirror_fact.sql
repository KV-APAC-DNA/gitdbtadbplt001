{{
    config(
        materialized='incremental',
        incremental_strategy='append',
        pre_hook="{% if is_incremental() %}
        delete from {{this}} where (SELECT COUNT(*) FROM {{ source('aspsdl_raw', 'sdl_market_mirror_fact') }}) != 0;
        {% endif %}"
    )
}}

with source as 
(
    select * from {{ source('aspsdl_raw', 'sdl_market_mirror_fact') }}
),
final as
(
    select utag::varchar(600) as utag,
    tag::varchar(600) as tag,
    market::varchar(100) as market,
    channel::varchar(100) as channel,
    channel_type::varchar(100) as channel_type,
    channel_source::varchar(100) as channel_source,
    channel_group::varchar(100) as channel_group,
    channel_description::varchar(1000) as channel_description,
    category::varchar(100) as category,
    real_date::date as real_date,
    period::varchar(50) as period,
    time_period::date as time_period,
    time_period_type::varchar(50) as time_period_type,
    date_type::varchar(100) as date_type,
    last_period::date as last_period,
    supplier::varchar(100) as supplier,
    source::varchar(100) as source,
    product::varchar(3000) as product,
    segment::varchar(300) as segment,
    manufacturer::varchar(300) as manufacturer,
    brand::varchar(300) as brand,
    sub_brand::varchar(300) as sub_brand,
    packsize::float as packsize,
    npd::varchar(10) as npd,
    launch_year::number(38,0) as launch_year,
    base_flag::varchar(10) as base_flag,
    exclude_flag::varchar(10) as exclude_flag,
    cat_unit_type::varchar(50) as cat_unit_type,
    cat_selling_unit::varchar(50) as cat_selling_unit,
    unit::varchar(100) as unit,
    attribute_1::varchar(200) as attribute_1,
    attribute_1_desc::varchar(200) as attribute_1_desc,
    attribute_2::varchar(200) as attribute_2,
    attribute_2_desc::varchar(200) as attribute_2_desc,
    attribute_3::varchar(200) as attribute_3,
    attribute_3_desc::varchar(200) as attribute_3_desc,
    attribute_4::varchar(200) as attribute_4,
    attribute_4_desc::varchar(200) as attribute_4_desc,
    attribute_5::varchar(200) as attribute_5,
    attribute_5_desc::varchar(200) as attribute_5_desc,
    attribute_6::varchar(200) as attribute_6,
    attribute_6_desc::varchar(200) as attribute_6_desc,
    attribute_7::varchar(200) as attribute_7,
    attribute_7_desc::varchar(200) as attribute_7_desc,
    attribute_8::varchar(200) as attribute_8,
    attribute_8_desc::varchar(200) as attribute_8_desc,
    attribute_9::varchar(200) as attribute_9,
    attribute_9_desc::varchar(200) as attribute_9_desc,
    attribute_10::varchar(200) as attribute_10,
    attribute_10_desc::varchar(200) as attribute_10_desc,
    attribute_11::varchar(200) as attribute_11,
    attribute_11_desc::varchar(200) as attribute_11_desc,
    attribute_12::varchar(200) as attribute_12,
    attribute_12_desc::varchar(200) as attribute_12_desc,
    attribute_13::varchar(200) as attribute_13,
    attribute_13_desc::varchar(200) as attribute_13_desc,
    attribute_14::varchar(200) as attribute_14,
    attribute_14_desc::varchar(200) as attribute_14_desc,
    attribute_15::varchar(200) as attribute_15,
    attribute_15_desc::varchar(200) as attribute_15_desc,
    attribute_16::varchar(200) as attribute_16,
    attribute_16_desc::varchar(200) as attribute_16_desc,
    attribute_17::varchar(200) as attribute_17,
    attribute_17_desc::varchar(200) as attribute_17_desc,
    gph_gfo::varchar(250) as gph_gfo,
    gph_brand::varchar(250) as gph_brand,
    gph_sub_brand::varchar(250) as gph_sub_brand,
    gph_variant::varchar(250) as gph_variant,
    gph_need_state::varchar(250) as gph_need_state,
    gph_category::varchar(250) as gph_category,
    gph_sub_category::varchar(250) as gph_sub_category,
    gph_segment::varchar(250) as gph_segment,
    gph_sub_segment::varchar(250) as gph_sub_segment,
    ggh_country::varchar(250) as ggh_country,
    ggh_region::varchar(250) as ggh_region,
    ggh_cluster::varchar(250) as ggh_cluster,
    ggh_sub_cluster::varchar(200) as ggh_sub_cluster,
    ggh_country_3_cd::varchar(250) as ggh_country_3_cd,
    ggh_country_2_cd::varchar(250) as ggh_country_2_cd,
    ggh_market_type::varchar(200) as ggh_market_type,
    sku_value_sales_lc::float as sku_value_sales_lc,
    cat_value_sales_lc::float as cat_value_sales_lc,
    seg_value_sales_lc::float as seg_value_sales_lc,
    mnf_value_sales_lc::float as mnf_value_sales_lc,
    mnf_seg_value_sales_lc::float as mnf_seg_value_sales_lc,
    brd_value_sales_lc::float as brd_value_sales_lc,
    brd_seg_value_sales_lc::float as brd_seg_value_sales_lc,
    sku_value_sales_usd::float as sku_value_sales_usd,
    cat_value_sales_usd::float as cat_value_sales_usd,
    seg_value_sales_usd::float as seg_value_sales_usd,
    mnf_value_sales_usd::float as mnf_value_sales_usd,
    mnf_seg_value_sales_usd::float as mnf_seg_value_sales_usd,
    brd_value_sales_usd::float as brd_value_sales_usd,
    brd_seg_value_sales_usd::float as brd_seg_value_sales_usd,
    sku_promoted_value_sales_lc::float as sku_promoted_value_sales_lc,
    cat_promoted_value_sales_lc::float as cat_promoted_value_sales_lc,
    seg_promoted_value_sales_lc::float as seg_promoted_value_sales_lc,
    mnf_promoted_value_sales_lc::float as mnf_promoted_value_sales_lc,
    mnf_seg_promoted_value_sales_lc::float as mnf_seg_promoted_value_sales_lc,
    brd_promoted_value_sales_lc::float as brd_promoted_value_sales_lc,
    brd_seg_promoted_value_sales_lc::float as brd_seg_promoted_value_sales_lc,
    sku_promoted_value_sales_usd::float as sku_promoted_value_sales_usd,
    cat_promoted_value_sales_usd::float as cat_promoted_value_sales_usd,
    seg_promoted_value_sales_usd::float as seg_promoted_value_sales_usd,
    mnf_promoted_value_sales_usd::float as mnf_promoted_value_sales_usd,
    mnf_seg_promoted_value_sales_usd::float as mnf_seg_promoted_value_sales_usd,
    brd_promoted_value_sales_usd::float as brd_promoted_value_sales_usd,
    brd_seg_promoted_value_sales_usd::float as brd_seg_promoted_value_sales_usd,
    sku_base_value_sales_lc::float as sku_base_value_sales_lc,
    cat_base_value_sales_lc::float as cat_base_value_sales_lc,
    seg_base_value_sales_lc::float as seg_base_value_sales_lc,
    mnf_base_value_sales_lc::float as mnf_base_value_sales_lc,
    mnf_seg_base_value_sales_lc::float as mnf_seg_base_value_sales_lc,
    brd_base_value_sales_lc::float as brd_base_value_sales_lc,
    brd_seg_base_value_sales_lc::float as brd_seg_base_value_sales_lc,
    sku_base_value_sales_usd::float as sku_base_value_sales_usd,
    cat_base_value_sales_usd::float as cat_base_value_sales_usd,
    seg_base_value_sales_usd::float as seg_base_value_sales_usd,
    mnf_base_value_sales_usd::float as mnf_base_value_sales_usd,
    mnf_seg_base_value_sales_usd::float as mnf_seg_base_value_sales_usd,
    brd_base_value_sales_usd::float as brd_base_value_sales_usd,
    brd_seg_base_value_sales_usd::float as brd_seg_base_value_sales_usd,
    sku_unit_sales::float as sku_unit_sales,
    cat_unit_sales::float as cat_unit_sales,
    seg_unit_sales::float as seg_unit_sales,
    mnf_unit_sales::float as mnf_unit_sales,
    mnf_seg_unit_sales::float as mnf_seg_unit_sales,
    brd_unit_sales::float as brd_unit_sales,
    brd_seg_unit_sales::float as brd_seg_unit_sales,
    sku_promoted_unit_sales::float as sku_promoted_unit_sales,
    cat_promoted_unit_sales::float as cat_promoted_unit_sales,
    seg_promoted_unit_sales::float as seg_promoted_unit_sales,
    mnf_promoted_unit_sales::float as mnf_promoted_unit_sales,
    mnf_seg_promoted_unit_sales::float as mnf_seg_promoted_unit_sales,
    brd_promoted_unit_sales::float as brd_promoted_unit_sales,
    brd_seg_promoted_unit_sales::float as brd_seg_promoted_unit_sales,
    sku_base_unit_sales::float as sku_base_unit_sales,
    cat_base_unit_sales::float as cat_base_unit_sales,
    seg_base_unit_sales::float as seg_base_unit_sales,
    mnf_base_unit_sales::float as mnf_base_unit_sales,
    mnf_seg_base_unit_sales::float as mnf_seg_base_unit_sales,
    brd_base_unit_sales::float as brd_base_unit_sales,
    brd_seg_base_unit_sales::float as brd_seg_base_unit_sales,
    sku_volume_sales::float as sku_volume_sales,
    cat_volume_sales::float as cat_volume_sales,
    seg_volume_sales::float as seg_volume_sales,
    mnf_volume_sales::float as mnf_volume_sales,
    mnf_seg_volume_sales::float as mnf_seg_volume_sales,
    brd_volume_sales::float as brd_volume_sales,
    brd_seg_volume_sales::float as brd_seg_volume_sales,
    sku_promoted_volume_sales::float as sku_promoted_volume_sales,
    cat_promoted_volume_sales::float as cat_promoted_volume_sales,
    seg_promoted_volume_sales::float as seg_promoted_volume_sales,
    mnf_promoted_volume_sales::float as mnf_promoted_volume_sales,
    mnf_seg_promoted_volume_sales::float as mnf_seg_promoted_volume_sales,
    brd_promoted_volume_sales::float as brd_promoted_volume_sales,
    brd_seg_promoted_volume_sales::float as brd_seg_promoted_volume_sales,
    sku_base_volume_sales::float as sku_base_volume_sales,
    cat_base_volume_sales::float as cat_base_volume_sales,
    seg_base_volume_sales::float as seg_base_volume_sales,
    mnf_base_volume_sales::float as mnf_base_volume_sales,
    mnf_seg_base_volume_sales::float as mnf_seg_base_volume_sales,
    brd_base_volume_sales::float as brd_base_volume_sales,
    brd_seg_base_volume_sales::float as brd_seg_base_volume_sales,
    sku_numeric_distribution::float as sku_numeric_distribution,
    cat_numeric_distribution::float as cat_numeric_distribution,
    seg_numeric_distribution::float as seg_numeric_distribution,
    mnf_numeric_distribution::float as mnf_numeric_distribution,
    mnf_seg_numeric_distribution::float as mnf_seg_numeric_distribution,
    brd_numeric_distribution::float as brd_numeric_distribution,
    brd_seg_numeric_distribution::float as brd_seg_numeric_distribution,
    sku_weighted_distribution::float as sku_weighted_distribution,
    cat_weighted_distribution::float as cat_weighted_distribution,
    seg_weighted_distribution::float as seg_weighted_distribution,
    mnf_weighted_distribution::float as mnf_weighted_distribution,
    mnf_seg_weighted_distribution::float as mnf_seg_weighted_distribution,
    brd_weighted_distribution::float as brd_weighted_distribution,
    brd_seg_weighted_distribution::float as brd_seg_weighted_distribution,
    sku_cwd_feature_display_pct::float as sku_cwd_feature_display_pct,
    cat_cwd_feature_display_pct::float as cat_cwd_feature_display_pct,
    seg_cwd_feature_display_pct::float as seg_cwd_feature_display_pct,
    mnf_cwd_feature_display_pct::float as mnf_cwd_feature_display_pct,
    mnf_seg_cwd_feature_display_pct::float as mnf_seg_cwd_feature_display_pct,
    brd_cwd_feature_display_pct::float as brd_cwd_feature_display_pct,
    brd_seg_cwd_feature_display_pct::float as brd_seg_cwd_feature_display_pct,
    sku_cwd_display_pct::float as sku_cwd_display_pct,
    cat_cwd_display_pct::float as cat_cwd_display_pct,
    seg_cwd_display_pct::float as seg_cwd_display_pct,
    mnf_cwd_display_pct::float as mnf_cwd_display_pct,
    mnf_seg_cwd_display_pct::float as mnf_seg_cwd_display_pct,
    brd_cwd_display_pct::float as brd_cwd_display_pct,
    brd_seg_cwd_display_pct::float as brd_seg_cwd_display_pct,
    sku_cwd_feature_pct::float as sku_cwd_feature_pct,
    cat_cwd_feature_pct::float as cat_cwd_feature_pct,
    seg_cwd_feature_pct::float as seg_cwd_feature_pct,
    mnf_cwd_feature_pct::float as mnf_cwd_feature_pct,
    mnf_seg_cwd_feature_pct::float as mnf_seg_cwd_feature_pct,
    brd_cwd_feature_pct::float as brd_cwd_feature_pct,
    brd_seg_cwd_feature_pct::float as brd_seg_cwd_feature_pct,
    msl::varchar(10) as msl,
    filename::varchar(200) as filename,
    file_time_stamp::timestamp_ntz(9) as file_time_stamp,
    lcl_prod_hier_lvl_1::varchar(200) as lcl_prod_hier_lvl_1,
    lcl_prod_hier_lvl_2::varchar(200) as lcl_prod_hier_lvl_2,
    lcl_prod_hier_lvl_3::varchar(200) as lcl_prod_hier_lvl_3,
    lcl_prod_hier_lvl_4::varchar(200) as lcl_prod_hier_lvl_4,
    lcl_prod_hier_lvl_5::varchar(200) as lcl_prod_hier_lvl_5,
    lcl_prod_hier_lvl_6::varchar(200) as lcl_prod_hier_lvl_6,
    lcl_prod_hier_lvl_7::varchar(200) as lcl_prod_hier_lvl_7,
    lcl_prod_attribute_1::varchar(200) as lcl_prod_attribute_1,
    lcl_prod_attribute_2::varchar(200) as lcl_prod_attribute_2,
    lcl_prod_attribute_3::varchar(200) as lcl_prod_attribute_3,
    lcl_prod_attribute_4::varchar(200) as lcl_prod_attribute_4,
    lcl_prod_attribute_5::varchar(200) as lcl_prod_attribute_5,
    delivery_status::varchar(50) as delivery_status,
    key::varchar(50) as key,
    origin::varchar(50) as origin,
    gsr_description::varchar(300) as gsr_description,
    gsr_level::varchar(100) as gsr_level,
    gsr_flag::boolean as gsr_flag,
    launch_date::date as launch_date,
    sku_cwd_any_promo_pct::float as sku_cwd_any_promo_pct,
    cat_cwd_any_promo_pct::float as cat_cwd_any_promo_pct,
    seg_cwd_any_promo_pct::float as seg_cwd_any_promo_pct,
    mnf_cwd_any_promo_pct::float as mnf_cwd_any_promo_pct,
    mnf_seg_cwd_any_promo_pct::float as mnf_seg_cwd_any_promo_pct,
    brd_cwd_any_promo_pct::float as brd_cwd_any_promo_pct,
    brd_seg_cwd_any_promo_pct::float as brd_seg_cwd_any_promo_pct,
    sku_cwd_price_promo_pct::float as sku_cwd_price_promo_pct,
    cat_cwd_price_promo_pct::float as cat_cwd_price_promo_pct,
    seg_cwd_price_promo_pct::float as seg_cwd_price_promo_pct,
    mnf_cwd_price_promo_pct::float as mnf_cwd_price_promo_pct,
    mnf_seg_cwd_price_promo_pct::float as mnf_seg_cwd_price_promo_pct,
    brd_cwd_price_promo_pct::float as brd_cwd_price_promo_pct,
    brd_seg_cwd_price_promo_pct::float as brd_seg_cwd_price_promo_pct,
    sku_cwd_extra_qty_pct::float as sku_cwd_extra_qty_pct,
    cat_cwd_extra_qty_pct::float as cat_cwd_extra_qty_pct,
    seg_cwd_extra_qty_pct::float as seg_cwd_extra_qty_pct,
    mnf_cwd_extra_qty_pct::float as mnf_cwd_extra_qty_pct,
    mnf_seg_cwd_extra_qty_pct::float as mnf_seg_cwd_extra_qty_pct,
    brd_cwd_extra_qty_pct::float as brd_cwd_extra_qty_pct,
    brd_seg_cwd_extra_qty_pct::float as brd_seg_cwd_extra_qty_pct,
    sku_cwd_display_other_pct::float as sku_cwd_display_other_pct,
    cat_cwd_display_other_pct::float as cat_cwd_display_other_pct,
    seg_cwd_display_other_pct::float as seg_cwd_display_other_pct,
    mnf_cwd_display_other_pct::float as mnf_cwd_display_other_pct,
    mnf_seg_cwd_display_other_pct::float as mnf_seg_cwd_display_other_pct,
    brd_cwd_display_other_pct::float as brd_cwd_display_other_pct,
    brd_seg_cwd_display_other_pct::float as brd_seg_cwd_display_other_pct,
    sku_cwd_display_entry_pct::float as sku_cwd_display_entry_pct,
    cat_cwd_display_entry_pct::float as cat_cwd_display_entry_pct,
    seg_cwd_display_entry_pct::float as seg_cwd_display_entry_pct,
    mnf_cwd_display_entry_pct::float as mnf_cwd_display_entry_pct,
    mnf_seg_cwd_display_entry_pct::float as mnf_seg_cwd_display_entry_pct,
    brd_cwd_display_entry_pct::float as brd_cwd_display_entry_pct,
    brd_seg_cwd_display_entry_pct::float as brd_seg_cwd_display_entry_pct,
    sku_cwd_display_gondola_pct::float as sku_cwd_display_gondola_pct,
    cat_cwd_display_gondola_pct::float as cat_cwd_display_gondola_pct,
    seg_cwd_display_gondola_pct::float as seg_cwd_display_gondola_pct,
    mnf_cwd_display_gondola_pct::float as mnf_cwd_display_gondola_pct,
    mnf_seg_cwd_display_gondola_pct::float as mnf_seg_cwd_display_gondola_pct,
    brd_cwd_display_gondola_pct::float as brd_cwd_display_gondola_pct,
    brd_seg_cwd_display_gondola_pct::float as brd_seg_cwd_display_gondola_pct,
    sku_cwd_display_check_out_pct::float as sku_cwd_display_check_out_pct,
    cat_cwd_display_check_out_pct::float as cat_cwd_display_check_out_pct,
    seg_cwd_display_check_out_pct::float as seg_cwd_display_check_out_pct,
    mnf_cwd_display_check_out_pct::float as mnf_cwd_display_check_out_pct,
    mnf_seg_cwd_display_check_out_pct::float as mnf_seg_cwd_display_check_out_pct,
    brd_cwd_display_check_out_pct::float as brd_cwd_display_check_out_pct,
    brd_seg_cwd_display_check_out_pct::float as brd_seg_cwd_display_check_out_pct,
    sku_cwd_multibuy_pct::float as sku_cwd_multibuy_pct,
    cat_cwd_multibuy_pct::float as cat_cwd_multibuy_pct,
    seg_cwd_multibuy_pct::float as seg_cwd_multibuy_pct,
    mnf_cwd_multibuy_pct::float as mnf_cwd_multibuy_pct,
    mnf_seg_cwd_multibuy_pct::float as mnf_seg_cwd_multibuy_pct,
    brd_cwd_multibuy_pct::float as brd_cwd_multibuy_pct,
    brd_seg_cwd_multibuy_pct::float as brd_seg_cwd_multibuy_pct,
    sku_cwd_loyalty_card_pct::float as sku_cwd_loyalty_card_pct,
    cat_cwd_loyalty_card_pct::float as cat_cwd_loyalty_card_pct,
    seg_cwd_loyalty_card_pct::float as seg_cwd_loyalty_card_pct,
    mnf_cwd_loyalty_card_pct::float as mnf_cwd_loyalty_card_pct,
    mnf_seg_cwd_loyalty_card_pct::float as mnf_seg_cwd_loyalty_card_pct,
    brd_cwd_loyalty_card_pct::float as brd_cwd_loyalty_card_pct,
    brd_seg_cwd_loyalty_card_pct::float as brd_seg_cwd_loyalty_card_pct,
    channel_origin::varchar(50) as channel_origin,
    sku_weighted_distribution_w_pct::float as sku_weighted_distribution_w_pct,
    cat_weighted_distribution_w_pct::float as cat_weighted_distribution_w_pct,
    seg_weighted_distribution_w_pct::float as seg_weighted_distribution_w_pct,
    mnf_weighted_distribution_w_pct::float as mnf_weighted_distribution_w_pct,
    mnf_seg_weighted_distribution_w_pct::float as mnf_seg_weighted_distribution_w_pct,
    brd_weighted_distribution_w_pct::float as brd_weighted_distribution_w_pct,
    brd_seg_weighted_distribution_w_pct::float as brd_seg_weighted_distribution_w_pct,
    sku_weighted_distribution_4w_pct::float as sku_weighted_distribution_4w_pct,
    cat_weighted_distribution_4w_pct::float as cat_weighted_distribution_4w_pct,
    seg_weighted_distribution_4w_pct::float as seg_weighted_distribution_4w_pct,
    mnf_weighted_distribution_4w_pct::float as mnf_weighted_distribution_4w_pct,
    mnf_seg_weighted_distribution_4w_pct::float as mnf_seg_weighted_distribution_4w_pct,
    brd_weighted_distribution_4w_pct::float as brd_weighted_distribution_4w_pct,
    brd_seg_weighted_distribution_4w_pct::float as brd_seg_weighted_distribution_4w_pct,
    sku_weighted_distribution_12w_pct::float as sku_weighted_distribution_12w_pct,
    cat_weighted_distribution_12w_pct::float as cat_weighted_distribution_12w_pct,
    seg_weighted_distribution_12w_pct::float as seg_weighted_distribution_12w_pct,
    mnf_weighted_distribution_12w_pct::float as mnf_weighted_distribution_12w_pct,
    mnf_seg_weighted_distribution_12w_pct::float as mnf_seg_weighted_distribution_12w_pct,
    brd_weighted_distribution_12w_pct::float as brd_weighted_distribution_12w_pct,
    brd_seg_weighted_distribution_12w_pct::float as brd_seg_weighted_distribution_12w_pct,
    sku_weighted_distribution_pct::float as sku_weighted_distribution_pct,
    cat_weighted_distribution_pct::float as cat_weighted_distribution_pct,
    seg_weighted_distribution_pct::float as seg_weighted_distribution_pct,
    mnf_weighted_distribution_pct::float as mnf_weighted_distribution_pct,
    mnf_seg_weighted_distribution_pct::float as mnf_seg_weighted_distribution_pct,
    brd_weighted_distribution_pct::float as brd_weighted_distribution_pct,
    brd_seg_weighted_distribution_pct::float as brd_seg_weighted_distribution_pct,
    manufacturer_local::varchar(300) as manufacturer_local,
    manufacturer_global::varchar(300) as manufacturer_global,
    brand_local::varchar(300) as brand_local,
    brand_global::varchar(300) as brand_global,
    need_state::varchar(100) as need_state,
    gfo::varchar(100) as gfo,
    cluster::varchar(100) as cluster,
    sub_cluster::varchar(100) as sub_cluster,
    form::varchar(500) as form
 from source
)
select * from final