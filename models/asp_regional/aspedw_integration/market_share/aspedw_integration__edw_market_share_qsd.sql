with source as
(
    select * from {{ source('aspsdl_raw', 'sdl_market_share_qsd') }}
),
final as
(
    SELECT tag,
        period_type,
        TYPE,
        period_date,
        brand,
        gfo,
        "need state" as need_state,
        category,
        "sub-category" as sub_category,
        segment,
        "sub-segment" as sub_segment,
        manufacturer,
        "country/cluster" as country_or_cluster,
        region,
        "market type" as market_type,
        CLUSTER,
        "country (geo)" as country_geo,
        "special region" as special_region,
        "country strategic role" as country_strategic_role,
        universe,
        "last period" as last_period,
        round(value,4) as value,
        brand_manufacturer_flg,
        "database category" as database_category,
        "database date" as database_date,
        "text desc" as text_desc,
        metric_period,
        "update",
        filename,
        channel,
        convert_timezone('UTC',current_timestamp()) as crtd_dttm
    FROM source
)
select tag::varchar(255) as tag,
    period_type::varchar(64) as period_type,
    type::varchar(64) as type,
    period_date::varchar(10) as period_date,
    brand::varchar(255) as brand,
    gfo::varchar(255) as gfo,
    need_state::varchar(255) as need_state,
    category::varchar(255) as category,
    sub_category::varchar(255) as sub_category,
    segment::varchar(255) as segment,
    sub_segment::varchar(255) as sub_segment,
    manufacturer::varchar(255) as manufacturer,
    country_or_cluster::varchar(255) as country_or_cluster,
    region::varchar(255) as region,
    market_type::varchar(255) as market_type,
    cluster::varchar(255) as cluster,
    country_geo::varchar(255) as country_geo,
    special_region::varchar(255) as special_region,
    country_strategic_role::varchar(255) as country_strategic_role,
    universe::varchar(255) as universe,
    last_period::varchar(10) as last_period,
    value::number(20,4) as value,
    brand_manufacturer_flg::varchar(5) as brand_manufacturer_flg,
    database_category::varchar(255) as database_category,
    database_date::varchar(255) as database_date,
    text_desc::varchar(255) as text_desc,
    metric_period::varchar(255) as metric_period,
    "update"::varchar(255) as "update",
    filename::varchar(255) as filename,
    channel::varchar(150) as channel,
    crtd_dttm::timestamp_ntz(9) as crtd_dttm
 from final