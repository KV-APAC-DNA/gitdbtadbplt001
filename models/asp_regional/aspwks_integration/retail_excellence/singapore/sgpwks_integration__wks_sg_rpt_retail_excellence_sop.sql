--Overwriding default SQL header as we dont want to change timezone to Singapore
{{
    config(
        sql_header= ""
    )
}}

--Import CTE

with wks_sg_rpt_retail_excellence as (
    select * from {{ ref('sgpwks_integration__wks_sg_rpt_retail_excellence') }}
),

edw_list_price as(
    select * from {{ ref('aspedw_integration__edw_list_price') }}
),
sg_rpt_retail_excellence_sop  as 
(
SELECT FISC_YR,
       FISC_PER,
       "CLUSTER",
       MARKET,
	   'POS' AS DATA_SRC,
       UPPER(coalesce(CHANNEL_NAME,'Not defined')) as CHANNEL_NAME,
       SOLDTO_CODE,
       UPPER(DISTRIBUTOR_CODE) AS DISTRIBUTOR_CODE,
       UPPER(DISTRIBUTOR_NAME) AS DISTRIBUTOR_NAME,
       UPPER(coalesce(SELL_OUT_CHANNEL,'Not defined')) as SELL_OUT_CHANNEL,
       UPPER(STORE_TYPE) AS STORE_TYPE,
       PRIORITIZATION_SEGMENTATION,
       STORE_CATEGORY,
       UPPER(STORE_CODE) AS STORE_CODE,
       UPPER(STORE_NAME) AS STORE_NAME,
       STORE_GRADE,
       STORE_SIZE,
       REGION,
       ZONE_NAME,
       CITY,
       RTRLATITUDE,
       RTRLONGITUDE,
       CUSTOMER_SEGMENT_KEY,
       CUSTOMER_SEGMENT_DESCRIPTION,
       RETAIL_ENVIRONMENT,
       SAP_CUSTOMER_CHANNEL_KEY,
       SAP_CUSTOMER_CHANNEL_DESCRIPTION,
       SAP_CUSTOMER_SUB_CHANNEL_KEY,
       SAP_SUB_CHANNEL_DESCRIPTION,
       SAP_PARENT_CUSTOMER_KEY,
       SAP_PARENT_CUSTOMER_DESCRIPTION,
       SAP_BANNER_KEY,
       SAP_BANNER_DESCRIPTION,
       SAP_BANNER_FORMAT_KEY,
       SAP_BANNER_FORMAT_DESCRIPTION,
       CUSTOMER_NAME,
       CUSTOMER_CODE,
       PRODUCT_CODE,
       PRODUCT_NAME,
       PROD_HIER_L1,
       PROD_HIER_L2,
       PROD_HIER_L3,
       PROD_HIER_L4,
       PROD_HIER_L5,
       PROD_HIER_L6,
       PROD_HIER_L7,
       PROD_HIER_L8,
       PROD_HIER_L9,
       MAPPED_SKU_CD,
       SAP_PROD_SGMT_CD,
       SAP_PROD_SGMT_DESC,
       SAP_BASE_PROD_DESC,
       SAP_MEGA_BRND_DESC,
       SAP_BRND_DESC,
       SAP_VRNT_DESC,
       SAP_PUT_UP_DESC,
       SAP_GRP_FRNCHSE_CD,
       SAP_GRP_FRNCHSE_DESC,
       SAP_FRNCHSE_CD,
       SAP_FRNCHSE_DESC,
       SAP_PROD_FRNCHSE_CD,
       SAP_PROD_FRNCHSE_DESC,
       SAP_PROD_MJR_CD,
       SAP_PROD_MJR_DESC,
       SAP_PROD_MNR_CD,
       SAP_PROD_MNR_DESC,
       SAP_PROD_HIER_CD,
       SAP_PROD_HIER_DESC,
       GLOBAL_PRODUCT_FRANCHISE,
       GLOBAL_PRODUCT_BRAND,
       GLOBAL_PRODUCT_SUB_BRAND,
       GLOBAL_PRODUCT_VARIANT,
       GLOBAL_PRODUCT_SEGMENT,
       GLOBAL_PRODUCT_SUBSEGMENT,
       GLOBAL_PRODUCT_CATEGORY,
       GLOBAL_PRODUCT_SUBCATEGORY,
       GLOBAL_PUT_UP_DESCRIPTION,
       EAN,
       SKU_CODE,
       SKU_DESCRIPTION,
       PKA_FRANCHISE_DESC,
       PKA_BRAND_DESC,
       PKA_SUB_BRAND_DESC,
       PKA_VARIANT_DESC,
       PKA_SUB_VARIANT_DESC,
       PKA_PRODUCT_KEY,
       PKA_PRODUCT_KEY_DESCRIPTION,
       SALES_VALUE,
       SALES_QTY,
       AVG_SALES_QTY,
       SALES_VALUE_LIST_PRICE,
       LM_SALES,
       LM_SALES_QTY,
       LM_AVG_SALES_QTY,
       LM_SALES_LP,
       P3M_SALES,
       P3M_QTY,
       P3M_AVG_QTY,
       P3M_SALES_LP,
       P6M_SALES,
       P6M_QTY,
       P6M_AVG_QTY,
       P6M_SALES_LP,
       P12M_SALES,
       P12M_QTY,
       P12M_AVG_QTY,
       P12M_SALES_LP,
       F3M_SALES,
       F3M_QTY,
       F3M_AVG_QTY,
       LM_SALES_FLAG,
       P3M_SALES_FLAG,
       P6M_SALES_FLAG,
       P12M_SALES_FLAG,
       MDP_FLAG,
       TARGET_COMPLAINCE,
       LIST_PRICE,
       TOTAL_SALES_LM,
       TOTAL_SALES_P3M,
       TOTAL_SALES_P6M,
       TOTAL_SALES_P12M,
       TOTAL_SALES_BY_STORE_LM,
       TOTAL_SALES_BY_STORE_P3M,
       TOTAL_SALES_BY_STORE_P6M,
       TOTAL_SALES_BY_STORE_P12M,
       TOTAL_SALES_BY_SKU_LM,
       TOTAL_SALES_BY_SKU_P3M,
       TOTAL_SALES_BY_SKU_P6M,
       TOTAL_SALES_BY_SKU_P12M,
       TOTAL_SALES_LM_LP,
       TOTAL_SALES_P3M_LP,
       TOTAL_SALES_P6M_LP,
       TOTAL_SALES_P12M_LP,
       TOTAL_SALES_BY_STORE_LM_LP,
       TOTAL_SALES_BY_STORE_P3M_LP,
       TOTAL_SALES_BY_STORE_P6M_LP,
       TOTAL_SALES_BY_STORE_P12M_LP,
       TOTAL_SALES_BY_SKU_LM_LP,
       TOTAL_SALES_BY_SKU_P3M_LP,
       TOTAL_SALES_BY_SKU_P6M_LP,
       TOTAL_SALES_BY_SKU_P12M_LP,
       (TOTAL_SALES_BY_STORE_LM / NULLIF(TOTAL_SALES_LM,0)) AS STORE_CONTRIBUTION_LM,
       (TOTAL_SALES_BY_SKU_LM / NULLIF(TOTAL_SALES_LM,0)) AS SKU_CONTRIBUTION_LM,
       (STORE_CONTRIBUTION_LM*SKU_CONTRIBUTION_LM*TOTAL_SALES_LM) AS SIZE_OF_PRICE_LM,
       (TOTAL_SALES_BY_STORE_P3M / NULLIF(TOTAL_SALES_P3M,0)) AS STORE_CONTRIBUTION_P3M,
       (TOTAL_SALES_BY_SKU_P3M / NULLIF(TOTAL_SALES_P3M,0)) AS SKU_CONTRIBUTION_P3M,
       (STORE_CONTRIBUTION_P3M*SKU_CONTRIBUTION_P3M*TOTAL_SALES_P3M) AS SIZE_OF_PRICE_P3M,
       (TOTAL_SALES_BY_STORE_P6M / NULLIF(TOTAL_SALES_P6M,0)) AS STORE_CONTRIBUTION_P6M,
       (TOTAL_SALES_BY_SKU_P6M / NULLIF(TOTAL_SALES_P6M,0)) AS SKU_CONTRIBUTION_P6M,
       (STORE_CONTRIBUTION_P6M*SKU_CONTRIBUTION_P6M*TOTAL_SALES_P6M) AS SIZE_OF_PRICE_P6M,
       (TOTAL_SALES_BY_STORE_P12M / NULLIF(TOTAL_SALES_P12M,0)) AS STORE_CONTRIBUTION_P12M,
       (TOTAL_SALES_BY_SKU_P12M / NULLIF(TOTAL_SALES_P12M,0)) AS SKU_CONTRIBUTION_P12M,
       (STORE_CONTRIBUTION_P12M*SKU_CONTRIBUTION_P12M*TOTAL_SALES_P12M) AS SIZE_OF_PRICE_P12M,
       (TOTAL_SALES_BY_STORE_LM_LP / NULLIF(TOTAL_SALES_LM_LP,0)) AS STORE_CONTRIBUTION_LM_LP,
       (TOTAL_SALES_BY_SKU_LM_LP / NULLIF(TOTAL_SALES_LM_LP,0)) AS SKU_CONTRIBUTION_LM_LP,
       (STORE_CONTRIBUTION_LM_LP*SKU_CONTRIBUTION_LM_LP*TOTAL_SALES_LM_LP) AS SIZE_OF_PRICE_LM_LP,
       (TOTAL_SALES_BY_STORE_P3M_LP / NULLIF(TOTAL_SALES_P3M_LP,0)) AS STORE_CONTRIBUTION_P3M_LP,
       (TOTAL_SALES_BY_SKU_P3M_LP / NULLIF(TOTAL_SALES_P3M_LP,0)) AS SKU_CONTRIBUTION_P3M_LP,
       (STORE_CONTRIBUTION_P3M_LP*SKU_CONTRIBUTION_P3M_LP*TOTAL_SALES_P3M_LP) AS SIZE_OF_PRICE_P3M_LP,
       (TOTAL_SALES_BY_STORE_P6M_LP / NULLIF(TOTAL_SALES_P6M_LP,0)) AS STORE_CONTRIBUTION_P6M_LP,
       (TOTAL_SALES_BY_SKU_P6M_LP / NULLIF(TOTAL_SALES_P6M_LP,0)) AS SKU_CONTRIBUTION_P6M_LP,
       (STORE_CONTRIBUTION_P6M_LP*SKU_CONTRIBUTION_P6M_LP*TOTAL_SALES_P6M_LP) AS SIZE_OF_PRICE_P6M_LP,
       (TOTAL_SALES_BY_STORE_P12M_LP / NULLIF(TOTAL_SALES_P12M_LP,0)) AS STORE_CONTRIBUTION_P12M_LP,
       (TOTAL_SALES_BY_SKU_P12M_LP / NULLIF(TOTAL_SALES_P12M_LP,0)) AS SKU_CONTRIBUTION_P12M_LP,
       (STORE_CONTRIBUTION_P12M_LP*SKU_CONTRIBUTION_P12M_LP*TOTAL_SALES_P12M_LP) AS SIZE_OF_PRICE_P12M_LP,
        MD5(DISTRIBUTOR_CODE||DISTRIBUTOR_NAME||SELL_OUT_CHANNEL||RETAIL_ENVIRONMENT||NVL(CUSTOMER_SEGMENT_DESCRIPTION,'csd')||
		NVL (SAP_CUSTOMER_CHANNEL_DESCRIPTION,'sccd') ||NVL (SAP_SUB_CHANNEL_DESCRIPTION,'sscd') ||NVL (SAP_PARENT_CUSTOMER_DESCRIPTION,'spscd') ||
		NVL (SAP_BANNER_DESCRIPTION,'sbd') || NVL (SAP_BANNER_FORMAT_DESCRIPTION,'sbfd')) as CUSTOMER_AGG_DIM_KEY,
		MD5(NVL (SAP_BASE_PROD_DESC,'sbpd') || NVL (SAP_MEGA_BRND_DESC,'smbd') ||NVL (SAP_BRND_DESC,'sb') || NVL (SAP_FRNCHSE_DESC,'sfd') ||
		NVL (SAP_PROD_MJR_DESC,'spmd') ||NVL (SAP_PROD_MNR_DESC,'spm') || NVL (PKA_FRANCHISE_DESC,'pfd')||
		NVL (PKA_BRAND_DESC,'pbd') ||NVL (PKA_SUB_BRAND_DESC,'pbsd') ||NVL (GLOBAL_PRODUCT_FRANCHISE,'gpf')||
		NVL (GLOBAL_PRODUCT_BRAND,'gpb') ||NVL (GLOBAL_PRODUCT_SUB_BRAND,'gpsb') ||NVL (GLOBAL_PRODUCT_SEGMENT,'gps')||
		NVL (GLOBAL_PRODUCT_SUBSEGMENT,'gpss') ||NVL (GLOBAL_PRODUCT_CATEGORY,'gpc') ||NVL (GLOBAL_PRODUCT_SUBCATEGORY,'gpsc')) AS PRODUCT_AGG_DIM_KEY,
SYSDATE()		
FROM (SELECT MAIN.FISC_YR,		
		MAIN.FISC_PER,		
		MAIN.CLUSTER,		
		MAIN.MARKET AS MARKET,		
		MAIN.CHANNEL_NAME,		
		MAIN.SOLDTO_CODE,		
		MAIN.DISTRIBUTOR_CODE,		
		MAIN.DISTRIBUTOR_NAME,		
		MAIN.SELL_OUT_CHANNEL,		
		MAIN.STORE_TYPE AS STORE_TYPE,		
		'Not available' as PRIORITIZATION_SEGMENTATION,
		'Not available' as STORE_CATEGORY,
		MAIN.STORE_CODE,		
		MAIN.STORE_NAME,		
		'Not available' as STORE_GRADE,
		'Not available' as STORE_SIZE,
		MAIN.REGION,		
		MAIN.ZONE_NAME,		
		MAIN.CITY,		
		'Not available' as RTRLATITUDE,
		'Not available' as RTRLONGITUDE,
		MAIN.PRODUCT_CODE,		
		MAIN.PRODUCT_NAME,		
		MAIN.PROD_HIER_L1,		
		MAIN.PROD_HIER_L2,		
		MAIN.PROD_HIER_L3,		
		MAIN.PROD_HIER_L4,		
		MAIN.PROD_HIER_L5,		
		MAIN.PROD_HIER_L6,		
		MAIN.PROD_HIER_L7,		
		MAIN.PROD_HIER_L8,		
		MAIN.PROD_HIER_L9,		
		MAIN.MAPPED_SKU_CD,		
		MAIN.CUSTOMER_SEGMENT_KEY,		
		MAIN.CUSTOMER_SEGMENT_DESCRIPTION,		
		MAIN.RETAIL_ENVIRONMENT,		
		MAIN.SAP_CUSTOMER_CHANNEL_KEY,		
		MAIN.SAP_CUSTOMER_CHANNEL_DESCRIPTION,		
		MAIN.SAP_CUSTOMER_SUB_CHANNEL_KEY,		
		MAIN.SAP_SUB_CHANNEL_DESCRIPTION,		
		MAIN.SAP_PARENT_CUSTOMER_KEY,		
		MAIN.SAP_PARENT_CUSTOMER_DESCRIPTION,		
		MAIN.SAP_BANNER_KEY,		
		MAIN.SAP_BANNER_DESCRIPTION,		
		MAIN.SAP_BANNER_FORMAT_KEY,		
		MAIN.SAP_BANNER_FORMAT_DESCRIPTION,		
		MAIN.CUSTOMER_NAME,		
		MAIN.CUSTOMER_CODE,	
		MAIN.SAP_PROD_SGMT_CD,		
		MAIN.SAP_PROD_SGMT_DESC,		
		MAIN.SAP_BASE_PROD_DESC,		
		MAIN.SAP_MEGA_BRND_DESC,		
		MAIN.SAP_BRND_DESC,		
		MAIN.SAP_VRNT_DESC,		
		MAIN.SAP_PUT_UP_DESC,		
		MAIN.SAP_GRP_FRNCHSE_CD,		
		MAIN.SAP_GRP_FRNCHSE_DESC,		
		MAIN.SAP_FRNCHSE_CD,		
		MAIN.SAP_FRNCHSE_DESC,		
		MAIN.SAP_PROD_FRNCHSE_CD,		
		MAIN.SAP_PROD_FRNCHSE_DESC,		
		MAIN.SAP_PROD_MJR_CD,		
		MAIN.SAP_PROD_MJR_DESC,		
		MAIN.SAP_PROD_MNR_CD,		
		MAIN.SAP_PROD_MNR_DESC,		
		MAIN.SAP_PROD_HIER_CD,		
		MAIN.SAP_PROD_HIER_DESC,		
		MAIN.GLOBAL_PRODUCT_FRANCHISE,		
		MAIN.GLOBAL_PRODUCT_BRAND,		
		MAIN.GLOBAL_PRODUCT_SUB_BRAND,		
		MAIN.GLOBAL_PRODUCT_VARIANT,		
		MAIN.GLOBAL_PRODUCT_SEGMENT,		
		MAIN.GLOBAL_PRODUCT_SUBSEGMENT,		
		MAIN.GLOBAL_PRODUCT_CATEGORY,	
		MAIN.GLOBAL_PRODUCT_SUBCATEGORY,		
		MAIN.GLOBAL_PUT_UP_DESCRIPTION,		
		MAIN.EAN,		
		MAIN.SKU_CODE,		
		MAIN.SKU_DESCRIPTION,		
		MAIN.PKA_FRANCHISE_DESC,		
		MAIN.PKA_BRAND_DESC,		
		MAIN.PKA_SUB_BRAND_DESC,		
		MAIN.PKA_VARIANT_DESC,		
		MAIN.PKA_SUB_VARIANT_DESC,		
		MAIN.PKA_PRODUCT_KEY,		
		MAIN.PKA_PRODUCT_KEY_DESCRIPTION,		
		MAIN.SALES_VALUE AS SALES_VALUE,		
		MAIN.SALES_QTY AS SALES_QTY,		
		MAIN.AVG_SALES_QTY AS AVG_SALES_QTY,		
		MAIN.SALES_VALUE_LIST_PRICE AS SALES_VALUE_LIST_PRICE,		
		MAIN.LM_SALES AS LM_SALES,		
		MAIN.LM_SALES_QTY AS LM_SALES_QTY,		
		MAIN.LM_AVG_SALES_QTY AS LM_AVG_SALES_QTY,		
		MAIN.LM_SALES_LP AS LM_SALES_LP,		
		MAIN.P3M_SALES AS P3M_SALES,		
		MAIN.P3M_QTY AS P3M_QTY,		
		MAIN.P3M_AVG_QTY AS P3M_AVG_QTY,		
		MAIN.P3M_SALES_LP AS P3M_SALES_LP,		
		MAIN.F3M_SALES AS F3M_SALES,		
		MAIN.F3M_QTY AS F3M_QTY,		
		MAIN.F3M_AVG_QTY AS F3M_AVG_QTY,		
		MAIN.P6M_SALES AS P6M_SALES,		
		MAIN.P6M_QTY AS P6M_QTY,		
		MAIN.P6M_AVG_QTY AS P6M_AVG_QTY,		
		MAIN.P6M_SALES_LP AS P6M_SALES_LP,		
		MAIN.P12M_SALES AS P12M_SALES,		
		MAIN.P12M_QTY AS P12M_QTY,		
		MAIN.P12M_AVG_QTY AS P12M_AVG_QTY,		
		MAIN.P12M_SALES_LP AS P12M_SALES_LP,		
		MAIN.LM_SALES_FLAG,		
		MAIN.P3M_SALES_FLAG,		
		MAIN.P6M_SALES_FLAG,		
		MAIN.P12M_SALES_FLAG,		
		MAIN.MDP_FLAG,		
		100 AS TARGET_COMPLAINCE,
		LP.LIST_PRICE,		
		SUM(MAIN.LM_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_LM,		
		SUM(MAIN.P3M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_P3M,		
		SUM(MAIN.P6M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_P6M,		
		SUM(MAIN.P12M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_P12M,		
		SUM(MAIN.LM_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_LM,		
		SUM(MAIN.P3M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_P3M,		
		SUM(MAIN.P6M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_P6M,		
		SUM(MAIN.P12M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_P12M,		
		SUM(MAIN.LM_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_LM,		
		SUM(MAIN.P3M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_P3M,		
		SUM(MAIN.P6M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_P6M,		
		SUM(MAIN.P12M_SALES) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_P12M,		
		SUM(MAIN.LM_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_LM_LP,		
		SUM(MAIN.P3M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_P3M_LP,		
		SUM(MAIN.P6M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_P6M_LP,		
		SUM(MAIN.P12M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND) AS TOTAL_SALES_P12M_LP,		
		SUM(MAIN.LM_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_LM_LP,		
		SUM(MAIN.P3M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_P3M_LP,		
		SUM(MAIN.P6M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_P6M_LP,		
		SUM(MAIN.P12M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,STORE_CODE) AS TOTAL_SALES_BY_STORE_P12M_LP,		
		SUM(MAIN.LM_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_LM_LP,		
		SUM(MAIN.P3M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_P3M_LP,		
		SUM(MAIN.P6M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_P6M_LP,		
		SUM(MAIN.P12M_SALES_LP) OVER (PARTITION BY FISC_PER,DISTRIBUTOR_CODE,GLOBAL_PRODUCT_BRAND,PRODUCT_CODE) AS TOTAL_SALES_BY_SKU_P12M_LP		
FROM wks_sg_rpt_retail_excellence MAIN		
  LEFT JOIN (SELECT LTRIM(edw_list_price.MATERIAL,'0') AS MATERIAL,		
                    edw_list_price.AMOUNT AS LIST_PRICE,	
PG_CATALOG		       
             FROM edw_list_price		    
             WHERE edw_list_price.SLS_ORG IN ('4000','2210','8888','330A')) LP		
         ON LTRIM (MAIN.SKU_CODE,'0') = LP.MATERIAL		
        AND RN = 1)

)
--Final select
select * from sg_rpt_retail_excellence_sop