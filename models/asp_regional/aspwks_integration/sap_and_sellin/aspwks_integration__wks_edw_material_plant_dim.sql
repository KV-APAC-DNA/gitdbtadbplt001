with itg_matl_plnt as (
    select * from {{ ref('aspitg_integration__itg_matl_plnt') }}
),

itg_matl_plnt_text as (
    select * from {{ ref('aspitg_integration__itg_matl_plnt_text') }}
),

--Join
edw_material_plant_dim_temp as (
    select
        plnt,
        matl_plnt_view,
        abc_in,
        del_fl,
        mrp_type,
        gr_prcsg_time,
        mrp_ctl,
        time_unit,
        plan_delv_time,
        prdtn_schd,
        cntl_area,
        prctr,
        prchsng_gr,
        tot_rl_time_repl,
        uom_basis_mov_ave,
        base_unit,
        ctry,
        valut_cls,
        cncnc,
        std_matl_cost,
        spl_prcmt,
        min_lot_size,
        rd_val_po_qty,
        matl,
        vend,
        prcmt_type,
        predecessor,
        base_qty_matplant,
        cost_lot_size_in,
        ld_gr,
        mil_goods_ind,
        availability_check,
        mm_pp_sts,
        auto_po_allw,
        stk_type,
        src_list_ind,
        qta_usg,
        mrp_grp,
        reordr_pt_mat_plant,
        plng_time_fence,
        plng_cyc,
        lot_size_mat_plan,
        max_lot_size,
        fx_lot_size_zbstfe,
        max_stk_lvl,
        cyc_time,
        btch_ent,
        iss_strg_loc,
        backflush_ind,
        strge_loc_ext_proc,
        plng_cal,
        sched_mrgn_key,
        sfty_stk,
        cvge_prfl,
        per_in,
        strtgy_gr,
        cnsmptn_mode,
        cnsmptn_per_bw,
        cnsmptn_per_fw,
        alt_bom,
        prdtn_unit,
        prdtn_sched_pro,
        tlrnc_under_delv,
        overdeliv_tlrnc,
        unit_iss,
        cc_phys_inv,
        insp_intv,
        cntl_key,
        cert_type,
        qm_sys_req,
        spec_proc_cst,
        var_key,
        prc_cntl,
        mvg_prc,
        devaluation_ind,
        prod_cost_ind,
        orig_gr,
        matl_orig_ind,
        fut_pind_prc,
        fut_pind_prc_1,
        plan_prc_dt,
        cost_ovhd_grp,
        prc_unit,
        mrp_ctl_zmrp,
        lunch_dt,
        npi_id,
        prev_pind_prc,
        fut_pind_prc_2,
        plan_prc_dt_2,
        fut_pind_prc_3,
        plan_prc_dt_3,
        npi_launch_wk,
        npi_launch_mo,
        sku_sgmnt,
        successor_on_going,
        sui_in,
        toll_mkup_cost,
        intco_mkup,
        act_sku_in,
        snp_plnr,
        transpotatn_plnr,
        auto_tlb_off,
        sfty_stk_min_in,
        sfty_stk_max_in_zmax_stck,
        rfs_in,
        bulk_exp,
        dmand_plnr,
        dmand_prfl,
        trgt_days_supl_zday,
        min_shlf_lif,
        gi_prcsg_time,
        pp_ds_hrzn_zppds,
        srvc_lvl,
        do_not_cost,
        vld_from_dt,
        maint_sts,
        rd_val,
        snp_prdtn_horiz,
        snp_prod_horiz_perd,
        sfty_stk_res_percentage_zsstk,
        snp_stk_trn_hor,
        snp_stk_trn_hor_peri,
        rglt_lic,
        sfty_stk_meth,
        snp_checkg_hor,
        per_fact,
        use_per_fact,
        dyn_peg_max_bkwd,
        push_dstn,
        cnsdr_sls_ordr,
        cnsdr_fcst,
        atd_rcpt,
        atd_iss,
        pegging_strtgy,
        dmand_fcast_err_percentage,
        fair_shr_rule,
        pull_depl_hor,
        push_depl_hor,
        prdtn_cost,
        max_earliness,
        max_lateness,
        strg_costs_prod,
        uom,
        fx_lot_size,
        exact_lot_size,
        per_type,
        nr_per_cap,
        pp_ds_hrzn,
        bulk_exp_dur,
        apo_prod_plnr,
        fix_stk_tfr,
        delay_pnlty,
        max_delay,
        non_del_penal,
        snp_prdtn_horiz_zprodh,
        npi_in_apo,
        std_mat_cost_wo_pu,
        crt_on,
        prod_type_apo,
        mstr_cd,
        copy_hist_apo,
        prod_classftn,
        fcst_indc_apo,
        jit_in,
        tot_rl_time,
        sfty_stk_min_in_zminstk,
        sfty_stk_max_in,
        trgt_days_supl,
        srvc_lvl_zservlv,
        dmand_fcast_err_percentage_zfedem,
        fisc_yr_vrnt,
        cost_yr,
        fut_std_prc,
        med_desc
        -- tgt.crt_dttm as tgt_crt_dttm,
        -- updt_dttm,
        -- case when tgt.crt_dttm is null then 'i' else 'u' end as chng_flg
    from (select a.*, b.med_desc as med_desc
    from itg_matl_plnt as a
    left outer join itg_matl_plnt_text as b 
    on a.plnt=b.plnt and a.matl_plnt_view=b.plnt_mat and b.lang_key='E')
),

final as (
    select
        plnt,
        matl_plnt_view,
        abc_in,
        del_fl,
        mrp_type,
        gr_prcsg_time,
        mrp_ctl,
        time_unit,
        plan_delv_time,
        prdtn_schd,
        cntl_area,
        prctr,
        prchsng_gr,
        tot_rl_time_repl,
        uom_basis_mov_ave,
        base_unit,
        ctry,
        valut_cls,
        cncnc,
        std_matl_cost,
        spl_prcmt,
        min_lot_size,
        rd_val_po_qty,
        matl,
        vend,
        prcmt_type,
        predecessor,
        base_qty_matplant,
        cost_lot_size_in,
        ld_gr,
        mil_goods_ind,
        availability_check,
        mm_pp_sts,
        auto_po_allw,
        stk_type,
        src_list_ind,
        qta_usg,
        mrp_grp,
        reordr_pt_mat_plant,
        plng_time_fence,
        plng_cyc,
        lot_size_mat_plan,
        max_lot_size,
        fx_lot_size_zbstfe,
        max_stk_lvl,
        cyc_time,
        btch_ent,
        iss_strg_loc,
        backflush_ind,
        strge_loc_ext_proc,
        plng_cal,
        sched_mrgn_key,
        sfty_stk,
        cvge_prfl,
        per_in,
        strtgy_gr,
        cnsmptn_mode,
        cnsmptn_per_bw,
        cnsmptn_per_fw,
        alt_bom,
        prdtn_unit,
        prdtn_sched_pro,
        tlrnc_under_delv,
        overdeliv_tlrnc,
        unit_iss,
        cc_phys_inv,
        insp_intv,
        cntl_key,
        cert_type,
        qm_sys_req,
        spec_proc_cst,
        var_key,
        prc_cntl,
        mvg_prc,
        devaluation_ind,
        prod_cost_ind,
        orig_gr,
        matl_orig_ind,
        fut_pind_prc,
        fut_pind_prc_1,
        plan_prc_dt,
        cost_ovhd_grp,
        prc_unit,
        mrp_ctl_zmrp,
        lunch_dt,
        npi_id,
        prev_pind_prc,
        fut_pind_prc_2,
        plan_prc_dt_2,
        fut_pind_prc_3,
        plan_prc_dt_3,
        npi_launch_wk,
        npi_launch_mo,
        sku_sgmnt,
        successor_on_going,
        sui_in,
        toll_mkup_cost,
        intco_mkup,
        act_sku_in,
        snp_plnr,
        transpotatn_plnr,
        auto_tlb_off,
        sfty_stk_min_in,
        sfty_stk_max_in_zmax_stck,
        rfs_in,
        bulk_exp,
        dmand_plnr,
        dmand_prfl,
        trgt_days_supl_zday,
        min_shlf_lif,
        gi_prcsg_time,
        pp_ds_hrzn_zppds,
        srvc_lvl,
        do_not_cost,
        vld_from_dt,
        maint_sts,
        rd_val,
        snp_prdtn_horiz,
        snp_prod_horiz_perd,
        sfty_stk_res_percentage_zsstk,
        snp_stk_trn_hor,
        snp_stk_trn_hor_peri,
        rglt_lic,
        sfty_stk_meth,
        snp_checkg_hor,
        per_fact,
        use_per_fact,
        dyn_peg_max_bkwd,
        push_dstn,
        cnsdr_sls_ordr,
        cnsdr_fcst,
        atd_rcpt,
        atd_iss,
        pegging_strtgy,
        dmand_fcast_err_percentage,
        fair_shr_rule,
        pull_depl_hor,
        push_depl_hor,
        prdtn_cost,
        max_earliness,
        max_lateness,
        strg_costs_prod,
        uom,
        fx_lot_size,
        exact_lot_size,
        per_type,
        nr_per_cap,
        pp_ds_hrzn,
        bulk_exp_dur,
        apo_prod_plnr,
        fix_stk_tfr,
        delay_pnlty,
        max_delay,
        non_del_penal,
        snp_prdtn_horiz_zprodh,
        npi_in_apo,
        std_mat_cost_wo_pu,
        crt_on,
        prod_type_apo,
        mstr_cd,
        copy_hist_apo,
        prod_classftn,
        fcst_indc_apo,
        jit_in,
        tot_rl_time,
        sfty_stk_min_in_zminstk,
        sfty_stk_max_in,
        trgt_days_supl,
        srvc_lvl_zservlv,
        dmand_fcast_err_percentage_zfedem,
        fisc_yr_vrnt,
        cost_yr,
        fut_std_prc,
        med_desc,
        current_timestamp()::timestamp_ntz(9) as updt_dttm
    from edw_material_plant_dim_temp
)

select * from final
