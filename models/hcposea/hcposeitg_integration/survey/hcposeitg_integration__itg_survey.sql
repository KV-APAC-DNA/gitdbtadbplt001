
with sdl_hcp_osea_survey
as
(
select * from {{ source('hcposesdl_raw', 'sdl_hcp_osea_survey') }}
)
,
transformed as
(
    select
    SURVEY_ID,
OWNER_ID,
(CASE WHEN UPPER(IS_DELETED) = 'TRUE' THEN 1 WHEN UPPER(IS_DELETED) IS NULL THEN 0 WHEN UPPER(IS_DELETED) = ' ' 
 THEN 0 ELSE 0 END) AS IS_DELETED,
SURVEY_NAME,
RECORD_TYPE_ID,
CREATED_DATE,
CREATED_BY_ID,
LAST_MODIFIED_DATE,
LAST_MODIFIED_BY_ID,
SYSTEM_MODSTAMP,
MAY_EDIT,
CASE WHEN UPPER(IS_LOCKED) = 'TRUE' THEN 1 WHEN UPPER(IS_LOCKED) = 'FALSE' THEN 0 ELSE 0 END AS IS_LOCKED,	          
LAST_VIEWED_DATE,
LAST_REFERENCED_DATE,
ASSIGNMENT_TYPE,
CHANNELS,
END_DATE,
EXPIRED,
EXTERNAL_ID,
LANGUAGE,
LOCKED,
ALLOW_USERS_TO_CHOOSE_TARGETS,
PRODUCT,
REGION,
SEGMENTS,
START_DATE,
STATUS,
INCLUDED_USER_TERRITORIES,
ZVOD_QUESTIONS_VOD,
ZVOD_SEGMENTS_VOD,
ZVOD_TARGETS_VOD,
MAXIMUM_POSSIBLE_SCORE,
MINIMUM_POSSIBLE_SCORE,
ACCOUNT_TYPES,
AUTOMATICALLY_CREATE_TARGET_RECORDS,
INCLUDED_USER_TERRITORIES_1,
COUNTRY,
DETAIL_GROUP,
PROFILE_NAME,
SHARE_TEAM,
ZVOD_ADVANCED_SHARE_TEAM_VOD,
IFRAME_LANDING_PAGE_URL,
SCORE_DISPLAY,
SURVEY_RESULTS_SHARING_SCOPE,
ENABLE_EMPLOYEE_COMMENT,
TARGET_TYPE,
SURVEY_TYPE,
MINDSET_INDICATOR,
MINDSET_PRODUCT,
MINDSET_SEGMENTATION_MODEL,
METRIC_CONSIDERED,
ALLOWED_BACK_DAYS,
ALLOW_EMAIL_DAILY_REMINDERS,
ALLOWED_BACK_DAYS_TO_ACKNOWLEDGE,
LEGACY_ID,
current_timestamp() as INSERTED_DATE,
       NULL as UPDATED_DATE 
from sdl_hcp_osea_survey
)
,
final as
(select 
	SURVEY_ID::VARCHAR(18) AS RECORD_ID,
OWNER_ID::VARCHAR(30) AS OWNER_ID,
IS_DELETED::NUMBER(38,0) AS IS_DELETED,
SURVEY_NAME::VARCHAR(100) AS SURVEY_NAME,
RECORD_TYPE_ID::VARCHAR(18) AS RECORD_TYPE_ID,
CREATED_DATE::TIMESTAMP_NTZ(9) AS CREATED_DATE,
CREATED_BY_ID::VARCHAR(18) AS CREATED_BY_ID,
LAST_MODIFIED_DATE::TIMESTAMP_NTZ(9) AS LAST_MODIFIED_DATE,
LAST_MODIFIED_BY_ID::VARCHAR(18) AS LAST_MODIFIED_BY_ID,
SYSTEM_MODSTAMP::TIMESTAMP_NTZ(9) AS SYSTEM_MODSTAMP,
MAY_EDIT::VARCHAR(10) AS MAY_EDIT,
IS_LOCKED::NUMBER(38,0) AS IS_LOCKED,
LAST_VIEWED_DATE::TIMESTAMP_NTZ(9) AS LAST_VIEWED_DATE,
LAST_REFERENCED_DATE::TIMESTAMP_NTZ(9) AS LAST_REFERENCED_DATE,
ASSIGNMENT_TYPE::VARCHAR(100) AS ASSIGNMENT_TYPE,
CHANNELS::VARCHAR(255) AS CHANNELS,
END_DATE::DATE AS END_DATE,
EXPIRED::VARCHAR(1300) AS EXPIRED,
EXTERNAL_ID::VARCHAR(120) AS EXTERNAL_ID,
LANGUAGE::VARCHAR(100) AS LANGUAGE,
LOCKED::VARCHAR(100) AS LOCKED,
ALLOW_USERS_TO_CHOOSE_TARGETS::VARCHAR(50) AS ALLOW_USERS_TO_CHOOSE_TARGETS,
PRODUCT::VARCHAR(100) AS PRODUCT,
REGION::VARCHAR(255) AS REGION,
SEGMENTS::VARCHAR(800) AS SEGMENTS,
START_DATE::DATE AS START_DATE,
STATUS::VARCHAR(100) AS STATUS,
INCLUDED_USER_TERRITORIES::VARCHAR(255) AS INCLUDED_USER_TERRITORIES,
ZVOD_QUESTIONS_VOD::VARCHAR(100) AS ZVOD_QUESTIONS_VOD,
ZVOD_SEGMENTS_VOD::VARCHAR(100) AS ZVOD_SEGMENTS_VOD,
ZVOD_TARGETS_VOD::VARCHAR(100) AS ZVOD_TARGETS_VOD,
MAXIMUM_POSSIBLE_SCORE::VARCHAR(11) AS MAXIMUM_POSSIBLE_SCORE,
MINIMUM_POSSIBLE_SCORE::VARCHAR(11) AS MINIMUM_POSSIBLE_SCORE,
ACCOUNT_TYPES::VARCHAR(5000) AS ACCOUNT_TYPES,
AUTOMATICALLY_CREATE_TARGET_RECORDS::VARCHAR(100) AS AUTOMATICALLY_CREATE_TARGET_RECORDS,
INCLUDED_USER_TERRITORIES_1::VARCHAR(5000) AS INCLUDED_USER_TERRITORIES_1,
COUNTRY::VARCHAR(50) AS COUNTRY,
DETAIL_GROUP::VARCHAR(100) AS DETAIL_GROUP,
PROFILE_NAME::VARCHAR(255) AS PROFILE_NAME,
SHARE_TEAM::VARCHAR(80) AS SHARE_TEAM,
ZVOD_ADVANCED_SHARE_TEAM_VOD::VARCHAR(100) AS ZVOD_ADVANCED_SHARE_TEAM_VOD,
IFRAME_LANDING_PAGE_URL::VARCHAR(255) AS IFRAME_LANDING_PAGE_URL,
SCORE_DISPLAY::VARCHAR(100) AS SCORE_DISPLAY,
SURVEY_RESULTS_SHARING_SCOPE::VARCHAR(100) AS SURVEY_RESULTS_SHARING_SCOPE,
ENABLE_EMPLOYEE_COMMENT::VARCHAR(100) AS ENABLE_EMPLOYEE_COMMENT,
TARGET_TYPE::VARCHAR(100) AS TARGET_TYPE,
SURVEY_TYPE::VARCHAR(100) AS SURVEY_TYPE,
MINDSET_INDICATOR::VARCHAR(100) AS MINDSET_INDICATOR,
MINDSET_PRODUCT::VARCHAR(100) AS MINDSET_PRODUCT,
MINDSET_SEGMENTATION_MODEL::VARCHAR(100) AS MINDSET_SEGMENTATION_MODEL,
METRIC_CONSIDERED::VARCHAR(100) AS METRIC_CONSIDERED,
ALLOWED_BACK_DAYS::NUMBER(5,0) AS ALLOWED_BACK_DAYS,
ALLOW_EMAIL_DAILY_REMINDERS::VARCHAR(100) AS ALLOW_EMAIL_DAILY_REMINDERS,
ALLOWED_BACK_DAYS_TO_ACKNOWLEDGE::NUMBER(3,0) AS ALLOWED_BACK_DAYS_TO_ACKNOWLEDGE,
LEGACY_ID::VARCHAR(255) AS LEGACY_ID,
	inserted_date::timestamp_ntz(9) as inserted_date,
	updated_date::timestamp_ntz(9) as updated_date
	from transformed
)

select * from final 
