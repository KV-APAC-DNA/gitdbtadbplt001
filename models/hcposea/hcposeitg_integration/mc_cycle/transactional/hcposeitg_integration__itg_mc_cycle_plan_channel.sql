{{
    config(
        materialized= "incremental",
        incremental_strategy= "append",
        pre_hook = "{% if is_incremental() %}
                delete from {{this}}
                where (mc_cycle_plan_channel_id) in (select mc_cycle_plan_channel_id
                from {{ source('hcposesdl_raw', 'sdl_hcp_osea_mc_cycle_plan_channel') }} stg_mc_cycle_plan_channel
                where stg_mc_cycle_plan_channel.mc_cycle_plan_channel_id = mc_cycle_plan_channel_id);
                {% endif %}"
    )
}}
with sdl_hcp_osea_mc_cycle_plan_channel
as
(
select * from {{ source('hcposesdl_raw', 'sdl_hcp_osea_mc_cycle_plan_channel') }}
)
,
transformed as
(
select 
MC_CYCLE_PLAN_CHANNEL_ID,
 (CASE WHEN UPPER(IS_DELETED) = 'TRUE' THEN 1 WHEN UPPER(IS_DELETED) IS NULL THEN 0 WHEN UPPER(IS_DELETED) = ' ' THEN 0 ELSE 0 END) AS IS_DELETED,
CYCLE_PLAN_CHANNEL_NAME,
RECORD_TYPE_ID,
CREATED_DATE,
CREATED_BY_ID,
LAST_MODIFIED_DATE,
LAST_MODIFIED_BY_ID,
SYSTEM_MODSTAMP,
MAY_EDIT,
CASE WHEN UPPER(IS_LOCKED) = 'TRUE' THEN 1 WHEN UPPER(IS_LOCKED) = 'FALSE' THEN 0 ELSE 0 END AS IS_LOCKED,	          
CYCLE_PLAN_TARGET,
CHANNEL_ACTIVITY_ACTUAL,
CHANNEL_ACTIVITY_GOAL,
CHANNEL_ACTIVITY_MAX,
CHANNEL_ACTIVITY_REMAINING,
CHANNEL_ATTAINMENT,
CHANNEL_INTERACTIONS_ACTUAL,
CHANNEL_INTERACTIONS_EARNED,
CHANNEL_INTERACTIONS_GOAL,
CHANNEL,
CYCLE_CHANNEL,
EXTERNAL_ID,
LAST_CALCULATED,
PRODUCT_ATTAINMENT,
PRODUCT_INTERACTIONS_EARNED,
PRODUCT_INTERACTIONS_GOAL,
VEEVA_EXTERNAL_ID,
CHANNEL_STATUS,
PRODUCT_STATUS,
TEAM_CHANNEL_ACTIVITY_ACTUAL,
TEAM_CHANNEL_ACTIVITY_GOAL,
TEAM_CHANNEL_ACTIVITY_MAX,
TEAM_CHANNEL_ACTIVITY_REMAINING,
TEAM_CHANNEL_ATTAINMENT,
TEAM_CHANNEL_INTERACTIONS_ACTUAL,
TEAM_CHANNEL_INTERACTIONS_EARNED,
TEAM_CHANNEL_INTERACTIONS_GOAL,
TEAM_CHANNEL_STATUS,
TEAM_PRODUCT_ATTAINMENT,
TEAM_PRODUCT_INTERACTIONS_EARNED,
TEAM_PRODUCT_INTERACTIONS_GOAL,
TEAM_PRODUCT_STATUS,
ACTIVITY_GOAL_EDIT,
CYCLE_PLAN,
TEAM_ACTIVITY_GOAL_EDIT,
CHANNEL_LAST_ACTIVITY_DATE,
CHANNEL_LAST_ACTIVITY_DATETIME,
TEAM_CHANNEL_LAST_ACTIVITY_DATE,
TEAM_CHANNEL_LAST_ACTIVITY_DATETIME,
CHANNEL_LAST_ACTIVITY_DATE_1,
TEAM_CHANNEL_LAST_ACTIVITY_DATE_1,
IS_CALL_CHANNEL,
MASTER_ALIGN_ID,
COUNTRY_CODE,
LEGACY_ID,
ACTUAL_GOAL,
CHANNEL_ACTIVITY_PERCENT,
CHANNEL_ACTUAL_ACHIEVEMENT,
HISTORICAL_CHANNEL_VALUE,
MC_CYCLE_PLAN_CHANNEL_ID_18,
CHANNEL_WEIGHT,
current_timestamp() as INSERTED_DATE,
       NULL as UPDATED_DATE 
from sdl_hcp_osea_mc_cycle_plan_channel
)
,
final as
(select 
	MC_CYCLE_PLAN_CHANNEL_ID::VARCHAR(18) AS MC_CYCLE_PLAN_CHANNEL_ID,
IS_DELETED::NUMBER(38,0) AS IS_DELETED,
CYCLE_PLAN_CHANNEL_NAME::VARCHAR(255) AS CYCLE_PLAN_CHANNEL_NAME,
RECORD_TYPE_ID::VARCHAR(18) AS RECORD_TYPE_ID,
CREATED_DATE::TIMESTAMP_NTZ(9) AS CREATED_DATE,
CREATED_BY_ID::VARCHAR(18) AS CREATED_BY_ID,
LAST_MODIFIED_DATE::TIMESTAMP_NTZ(9) AS LAST_MODIFIED_DATE,
LAST_MODIFIED_BY_ID::VARCHAR(18) AS LAST_MODIFIED_BY_ID,
SYSTEM_MODSTAMP::TIMESTAMP_NTZ(9) AS SYSTEM_MODSTAMP,
MAY_EDIT::VARCHAR(10) AS MAY_EDIT,
IS_LOCKED::NUMBER(38,0) AS IS_LOCKED,
CYCLE_PLAN_TARGET::VARCHAR(50) AS CYCLE_PLAN_TARGET,
CHANNEL_ACTIVITY_ACTUAL::NUMBER(18,1) AS CHANNEL_ACTIVITY_ACTUAL,
CHANNEL_ACTIVITY_GOAL::NUMBER(18,1) AS CHANNEL_ACTIVITY_GOAL,
CHANNEL_ACTIVITY_MAX::NUMBER(18,1) AS CHANNEL_ACTIVITY_MAX,
CHANNEL_ACTIVITY_REMAINING::NUMBER(18,1) AS CHANNEL_ACTIVITY_REMAINING,
CHANNEL_ATTAINMENT::NUMBER(18,1) AS CHANNEL_ATTAINMENT,
CHANNEL_INTERACTIONS_ACTUAL::NUMBER(18,1) AS CHANNEL_INTERACTIONS_ACTUAL,
CHANNEL_INTERACTIONS_EARNED::NUMBER(18,1) AS CHANNEL_INTERACTIONS_EARNED,
CHANNEL_INTERACTIONS_GOAL::NUMBER(18,1) AS CHANNEL_INTERACTIONS_GOAL,
CHANNEL::VARCHAR(1500) AS CHANNEL,
CYCLE_CHANNEL::VARCHAR(18) AS CYCLE_CHANNEL,
EXTERNAL_ID::VARCHAR(100) AS EXTERNAL_ID,
LAST_CALCULATED::TIMESTAMP_NTZ(9) AS LAST_CALCULATED,
PRODUCT_ATTAINMENT::NUMBER(18,3) AS PRODUCT_ATTAINMENT,
PRODUCT_INTERACTIONS_EARNED::NUMBER(18,1) AS PRODUCT_INTERACTIONS_EARNED,
PRODUCT_INTERACTIONS_GOAL::NUMBER(18,1) AS PRODUCT_INTERACTIONS_GOAL,
VEEVA_EXTERNAL_ID::VARCHAR(100) AS VEEVA_EXTERNAL_ID,
CHANNEL_STATUS::VARCHAR(40) AS CHANNEL_STATUS,
PRODUCT_STATUS::VARCHAR(40) AS PRODUCT_STATUS,
TEAM_CHANNEL_ACTIVITY_ACTUAL::NUMBER(18,1) AS TEAM_CHANNEL_ACTIVITY_ACTUAL,
TEAM_CHANNEL_ACTIVITY_GOAL::NUMBER(18,1) AS TEAM_CHANNEL_ACTIVITY_GOAL,
TEAM_CHANNEL_ACTIVITY_MAX::NUMBER(18,1) AS TEAM_CHANNEL_ACTIVITY_MAX,
TEAM_CHANNEL_ACTIVITY_REMAINING::NUMBER(18,1) AS TEAM_CHANNEL_ACTIVITY_REMAINING,
TEAM_CHANNEL_ATTAINMENT::NUMBER(18,3) AS TEAM_CHANNEL_ATTAINMENT,
TEAM_CHANNEL_INTERACTIONS_ACTUAL::NUMBER(18,1) AS TEAM_CHANNEL_INTERACTIONS_ACTUAL,
TEAM_CHANNEL_INTERACTIONS_EARNED::NUMBER(18,1) AS TEAM_CHANNEL_INTERACTIONS_EARNED,
TEAM_CHANNEL_INTERACTIONS_GOAL::NUMBER(18,1) AS TEAM_CHANNEL_INTERACTIONS_GOAL,
TEAM_CHANNEL_STATUS::VARCHAR(40) AS TEAM_CHANNEL_STATUS,
TEAM_PRODUCT_ATTAINMENT::NUMBER(18,1) AS TEAM_PRODUCT_ATTAINMENT,
TEAM_PRODUCT_INTERACTIONS_EARNED::NUMBER(18,1) AS TEAM_PRODUCT_INTERACTIONS_EARNED,
TEAM_PRODUCT_INTERACTIONS_GOAL::NUMBER(18,1) AS TEAM_PRODUCT_INTERACTIONS_GOAL,
TEAM_PRODUCT_STATUS::VARCHAR(40) AS TEAM_PRODUCT_STATUS,
ACTIVITY_GOAL_EDIT::NUMBER(18,1) AS ACTIVITY_GOAL_EDIT,
CYCLE_PLAN::VARCHAR(1500) AS CYCLE_PLAN,
TEAM_ACTIVITY_GOAL_EDIT::NUMBER(18,1) AS TEAM_ACTIVITY_GOAL_EDIT,
CHANNEL_LAST_ACTIVITY_DATE::DATE AS CHANNEL_LAST_ACTIVITY_DATE,
CHANNEL_LAST_ACTIVITY_DATETIME::TIMESTAMP_NTZ(9) AS CHANNEL_LAST_ACTIVITY_DATETIME,
TEAM_CHANNEL_LAST_ACTIVITY_DATE::DATE AS TEAM_CHANNEL_LAST_ACTIVITY_DATE,
TEAM_CHANNEL_LAST_ACTIVITY_DATETIME::TIMESTAMP_NTZ(9) AS TEAM_CHANNEL_LAST_ACTIVITY_DATETIME,
CHANNEL_LAST_ACTIVITY_DATE_1::DATE AS CHANNEL_LAST_ACTIVITY_DATE_1,
TEAM_CHANNEL_LAST_ACTIVITY_DATE_1::DATE AS TEAM_CHANNEL_LAST_ACTIVITY_DATE_1,
IS_CALL_CHANNEL::VARCHAR(20) AS IS_CALL_CHANNEL,
MASTER_ALIGN_ID::VARCHAR(20) AS MASTER_ALIGN_ID,
COUNTRY_CODE::VARCHAR(2) AS COUNTRY_CODE,
LEGACY_ID::VARCHAR(255) AS LEGACY_ID,
ACTUAL_GOAL::NUMBER(18,4) AS ACTUAL_GOAL,
CHANNEL_ACTIVITY_PERCENT::NUMBER(18,4) AS CHANNEL_ACTIVITY_PERCENT,
CHANNEL_ACTUAL_ACHIEVEMENT::NUMBER(18,4) AS CHANNEL_ACTUAL_ACHIEVEMENT,
HISTORICAL_CHANNEL_VALUE::NUMBER(18,4) AS HISTORICAL_CHANNEL_VALUE,
MC_CYCLE_PLAN_CHANNEL_ID_18::VARCHAR(50) AS MC_CYCLE_PLAN_CHANNEL_ID_18,
CHANNEL_WEIGHT::NUMBER(18,4) AS CHANNEL_WEIGHT,
	inserted_date::timestamp_ntz(9) as inserted_date,
	updated_date::timestamp_ntz(9) as updated_date
	from transformed
)

select * from final 
