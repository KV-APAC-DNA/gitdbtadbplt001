with source as(
    select * from {{ source('thasdl_raw', 'sdl_mds_th_rolling_forecast') }}
),
transformed as(
    select
        cast(trim("fiscal_year/period") as int) as fisc_yr_per,
        cast(trim("j&j_fiscal_week") as int) as fisc_wk,
        trim(company_code) as co_cd,
        trim(value_type) as val_type,
        trim(version) as vrsn,
        trim(manual_type) as manual_typ,
        trim(currency) as crncy_key,
        trim(sales_organization) as sls_org,
        trim(distribution_channel) as dstr_chnl,
        trim(division) as dvsn,
        trim(material) as matl_num,
        trim("b1_mega-brand") as b1_mega_brnd,
        trim(b2_brand) as b2_brnd,
        trim(b3_base_product) as b3_base_prod,
        trim(b4_variant) as b4_var,
        trim("b5_put-up") as b5_put_up,
        trim("operating_group") as oper_grp,
        trim("franchise_group") as franchise_grp,
        trim(franchise) as franchise,
        trim(product_franchise) as prod_fran,
        trim(product_major) as prod_major,
        trim(product_minor) as prod_minor,
        trim(current_sales_employee) as sls_emp_curr,
        trim(customer_number) as cust_num,
        trim(local_customer_grp_1) as local_cust_grp1,
        trim(local_customer_grp_2) as local_cust_grp2,
        trim(local_customer_grp_3) as local_cust_grp3,
        trim(local_customer_grp_4) as local_cust_grp4,
        trim(local_customer_grp_5) as local_cust_grp5,
        trim(local_customer_grp_6) as local_cust_grp6,
        cast(trim(sales_target) as decimal(20, 5)) as sls_target,
        cast(trim(quantity) as decimal(20, 5)) as qty,
        trim(unit) as unit,
        trim(fiscal_variant) as fisc_yr_var,
        cast(trim(fiscal_year) as int) as fisc_yr,
        trim(country) as ctry_key,
        to_char(cast(current_timestamp()::timestampntz(9) as timestampntz), 'YYYYMMDDHH24MISSFF3') as cdl_dttm,
        current_timestamp()::timestampntz(9) as crtd_dttm,
        current_timestamp()::timestampntz(9) as updt_dttm
    from source
),
final as(
    select 
        fisc_yr_per::number(18,0) as fisc_yr_per,
        fisc_wk::number(18,0) as fisc_wk,
        co_cd::varchar(4) as co_cd,
        val_type::varchar(20) as val_type,
        vrsn::varchar(20) as vrsn,
        manual_typ::varchar(20) as manual_typ,
        crncy_key::varchar(5) as crncy_key,
        sls_org::varchar(4) as sls_org,
        dstr_chnl::varchar(4) as dstr_chnl,
        dvsn::varchar(4) as dvsn,
        matl_num::varchar(18) as matl_num,
        b1_mega_brnd::varchar(10) as b1_mega_brnd,
        b2_brnd::varchar(10) as b2_brnd,
        b3_base_prod::varchar(10) as b3_base_prod,
        b4_var::varchar(10) as b4_var,
        b5_put_up::varchar(10) as b5_put_up,
        oper_grp::varchar(18) as oper_grp,
        franchise_grp::varchar(20) as franchise_grp,
        franchise::varchar(20) as franchise,
        prod_fran::varchar(18) as prod_fran,
        prod_major::varchar(18) as prod_major,
        prod_minor::varchar(18) as prod_minor,
        sls_emp_curr::varchar(20) as sls_emp_curr,
        cust_num::varchar(10) as cust_num,
        local_cust_grp1::varchar(20) as local_cust_grp1,
        local_cust_grp2::varchar(20) as local_cust_grp2,
        local_cust_grp3::varchar(20) as local_cust_grp3,
        local_cust_grp4::varchar(20) as local_cust_grp4,
        local_cust_grp5::varchar(20) as local_cust_grp5,
        local_cust_grp6::varchar(20) as local_cust_grp6,
        sls_target::number(20,5) as sls_target,
        qty::number(20,5) as qty,
        unit::varchar(10) as unit,
        fisc_yr_var::varchar(10) as fisc_yr_var,
        fisc_yr::number(18,0) as fisc_yr,
        ctry_key::varchar(5) as ctry_key,
        cdl_dttm::varchar(255) as cdl_dttm,
        crtd_dttm as crtd_dttm,
        updt_dttm as updt_dttm,
    from transformed
)
select * from final