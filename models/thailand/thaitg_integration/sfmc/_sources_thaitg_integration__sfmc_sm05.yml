version: 2

sources:
  - name: thasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: thasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
      - name: sdl_th_sfmc_click_data 
        tags: ["th_sfmc_click"]
        tests:
            - test_null:
                not_null_columns: ['is_unique','batch_id','job_id','email_name','event_date','subscriber_key']
                select_columns: ['is_unique','batch_id','job_id','email_name','event_date','subscriber_key','url','link_name','is_unique','file_name']
                name: TRATBL_sdl_th_sfmc_click_data__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_duplicate:
                group_by_columns: ['job_id','batch_id','subscriber_id','subscriber_key','event_date','url','link_name','is_unique','file_name']
                select_columns: ['job_id','batch_id','subscriber_id','subscriber_key','event_date','url','link_name','is_unique','file_name']
                name: TRATBL_sdl_th_sfmc_click_data__duplicate_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_lookup:
                select_columns: ['job_id','batch_id','subscriber_id','subscriber_key','event_date','url','link_name','is_unique','file_name']
                column: "upper(coalesce(subscriber_key, ''))" 
                lookup_column: "upper(coalesce(subscriber_key, ''))"
                lookup_table: "{{ ref('thaitg_integration__itg_sfmc_consumer_master') }}"
                name: TRATBL_sdl_th_sfmc_click_data__lookup_test
                config:
                  store_failures: true
                  schema: thawks_integration
      - name: sdl_th_sfmc_complaint_data
        tags: ["th_sfmc_complaint"]
        tests:
            - test_null:
                not_null_columns: ['job_id','batch_id','subscriber_key','event_date','email_name']
                select_columns: ['job_id','batch_id','subscriber_id','subscriber_key','email_id','file_name']
                name: TRATBL_sdl_th_sfmc_complaint_data__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_duplicate:
                group_by_columns: ['job_id','batch_id','subscriber_id','subscriber_key','email_id','file_name']
                select_columns: ['job_id','batch_id','subscriber_id','subscriber_key','email_id','file_name']
                name: TRATBL_sdl_th_sfmc_complaint_data__duplicate_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_lookup:
                select_columns: ["subscriber_key"]
                column: "upper(coalesce(subscriber_key, ''))" 
                lookup_column: "upper(coalesce(subscriber_key, ''))"
                lookup_table: "{{ ref('thaitg_integration__itg_sfmc_consumer_master') }}"
                name: TRATBL_sdl_th_sfmc_complaint_data__lookup_test
                config:
                  store_failures: true
                  schema: thawks_integration

      - name: sdl_jnj_mer_cop
        tests:
            - test_null:
                not_null_columns: ['file_name','cop_date','emp_address_pc','pc_name','store_name','question','answer']
                select_columns: ['file_name','cop_date','emp_address_pc','pc_name','store_name','question','answer']
                name: TRATBL_sdl_jnj_mer_cop__null_test
                config:
                  store_failures: true
                  schema: thawks_integration

            - test_date_format_odd_eve_leap:
                model_nm: "{{ source('thasdl_raw', 'sdl_jnj_mer_cop') }}"
                date_column: "cop_date"
                filter: "(odd_mon.cop_date) = (even_mon.cop_date) and (odd_mon.result) = (even_mon.result)"
                failure_reason: "'cop_date HAVING INCORRECT DATE-FORMAT. EXPECTED: YYYYMMDD'"
                select_columns: ['file_name','cop_date','emp_address_pc','pc_name','store_name','question','answer']
                name: TRATBL_sdl_jnj_mer_cop__test_date_format_odd_eve_leap
                config:
                  store_failures: true
                  schema: thawks_integration
      - name: sdl_jnj_mer_share_of_shelf
        tests:
            - test_null:
                not_null_columns: ['file_name','sos_date','merchandiser_name','area','channel','account','store_name','category','agency','brand']
                select_columns: ['file_name','sos_date','merchandiser_name','area','channel','account','store_name','category','agency','brand']
                name: TRATBL_sdl_jnj_mer_share_of_shelf__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_duplicate:
                group_by_columns: ['file_name','sos_date','merchandiser_name','area','channel','account','store_name','category','agency','brand']
                select_columns: ['file_name','sos_date','merchandiser_name','area','channel','account','store_name','category','agency','brand']
                name: TRATBL_sdl_jnj_mer_share_of_shelf__duplicate_test
                config:
                  store_failures: true
                  schema: thawks_integration

            - test_date_format_odd_eve_leap:
                model_nm: "{{ source('thasdl_raw', 'sdl_jnj_mer_share_of_shelf') }}"
                date_column: "sos_date"
                filter: "(odd_mon.sos_date) = (even_mon.sos_date) and (odd_mon.result) = (even_mon.result)"
                failure_reason: "'SOS_DATE HAVING INCORRECT DATE-FORMAT. EXPECTED: YYYYMMDD'"
                select_columns: ['file_name','sos_date','Merchandiser_Name','Area','Channel','Account','Store_Name','Category','Agency','Brand']
                name: TRATBL_sdl_jnj_mer_share_of_shelf__test_date_format_odd_eve_leap
                config:
                  store_failures: true
                  schema: thawks_integration
      - name: sdl_jnj_osa_oos_report
        tests:
            - test_null:
                not_null_columns: ['file_name','osa_oos_date','week','emp_address_pc','pc_name','area','channel','account','store_name','shop_type','brand','category','barcode','sku','msl_price_tag']
                select_columns: ['file_name','osa_oos_date','week','emp_address_pc','pc_name','area','channel','account','store_name','shop_type','brand','category','barcode','sku','msl_price_tag']
                name: TRATBL_sdl_jnj_osa_oos_report__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_date_format_odd_eve_leap:
                model_nm: "{{ source('thasdl_raw', 'sdl_jnj_osa_oos_report') }}"
                date_column: "osa_oos_date"
                filter: "(odd_mon.osa_oos_date) = (even_mon.osa_oos_date) and (odd_mon.result) = (even_mon.result)"
                failure_reason: "'OSA_OOS_DATE HAVING INCORRECT DATE-FORMAT. EXPECTED: YYYYMMDD'"
                select_columns: ['file_name','osa_oos_date','week','emp_address_pc','pc_name','area','channel','account','store_name','shop_type','brand','category','barcode','sku','msl_price_tag']
                name: TRATBL_sdl_jnj_osa_oos_report__test_date_format_odd_eve_leap
                config:
                  store_failures: true
                  schema: thawks_integration
      - name: sdl_th_sfmc_sent_data
        tests:
            - test_null:
                not_null_columns: ['job_id','batch_id','event_date','subscriber_key','email_name']
                select_columns: ['job_id','batch_id','subscriber_id','subscriber_key','event_date','email_id','file_name']
                name: TRATBL_sdl_th_sfmc_sent_data__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_duplicate:
                group_by_columns: ['job_id','batch_id','subscriber_id','subscriber_key','event_date','email_id','file_name']
                select_columns: ['job_id','batch_id','subscriber_id','subscriber_key','event_date','email_id','file_name']
                name: TRATBL_sdl_th_sfmc_sent_data__duplicate_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_lookup:
                select_columns: ["subscriber_key"]
                column: "upper(coalesce(subscriber_key, ''))" 
                lookup_column: "upper(coalesce(subscriber_key, ''))"
                lookup_table: "{{ ref('thaitg_integration__itg_sfmc_consumer_master') }}"
                name: TRATBL_sdl_th_sfmc_sent_data__lookup_test
                config:
                  store_failures: true
                  schema: thawks_integration



      