version: 2

sources:
  - name: thasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: thasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
      - name: sdl_th_sfmc_bounce_data
        tags: ["th_sfmc_bounce",""]
        tests:
          - test_duplicate__ff:
              group_by_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","file_name"]
              name: TRATBL_sdl_th_sfmc_bounce_data__duplicate_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_null__ff:
              not_null_columns: ["subscriber_key","event_date","email_name","job_id","batch_id"]
              failure_reason: "Nulls present in subscriber_key or event_date or email_name or job_id or batch_id"
              name: TRATBL_sdl_th_sfmc_bounce_data__null_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_lookup__ff:
              failure_reason: "Subscriber_Key not present in Consumer Master Lookup Table"
              column: "upper(nvl(subscriber_key,''))"
              lookup_table: "{{ ref('aspitg_integration__itg_sfmc_consumer_master') }}"
              lookup_column: "upper(nvl(subscriber_key,''))"
              name: TRATBL_sdl_th_sfmc_bounce_data__lookup_test
              config:
                store_failures: true
                schema: thawks_integration