version: 2

sources:
  - name: thasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: thasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_th_sfmc_children_data
      tags: ["th_crm_childern"]
      tests:
        - test_null:
            select_columns: ["parent_key","child_number"]
            not_null_columns: ["parent_key","child_number"]
            name: TRATBL_sdl_th_sfmc_children_data__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["parent_key","child_number","file_name"]
            select_columns: ["parent_key","child_number"]
            name: TRATBL_sdl_th_sfmc_children_data__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
    
    - name: sdl_th_sfmc_consumer_master
      tags: [""]
      tests:
        - test_null:
            select_columns: ["subscriber_key"]
            not_null_columns: ["subscriber_key"]
            name: TRATBL_sdl_th_sfmc_consumer_master__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["subscriber_key","file_name"]
            select_columns: ["subscriber_key"]
            name: TRATBL_sdl_th_sfmc_consumer_master__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
    - name: sdl_th_sfmc_consumer_master_additional
      tags: [""]
      tests:
        - test_null:
            select_columns: ["subscriber_key","attribute_name","attribute_value"]
            not_null_columns: ["subscriber_key","attribute_name","attribute_value"]
            name: TRATBL_sdl_th_sfmc_consumer_master_additional__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["subscriber_key","attribute_name","attribute_value","file_name"]
            select_columns: ["subscriber_key","attribute_name","attribute_value"]
            name: TRATBL_sdl_th_sfmc_consumer_master_additional__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
    - name: sdl_th_sfmc_open_data
      tags: [""]
      tests:
        - test_null:
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique"]
            not_null_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique"]
            name: TRATBL_sdl_th_sfmc_open_data__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique","file_name"]
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique"]
            name: TRATBL_sdl_th_sfmc_open_data__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
    - name: sdl_th_sfmc_unsubscribe_data
      tags: [""]
      tests:
        - test_null:
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date"]
            not_null_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date"]
            name: TRATBL_sdl_th_sfmc_unsubscribe_data__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date","file_name"]
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date"]
            name: TRATBL_sdl_th_sfmc_unsubscribe_data__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
    - name: sdl_jnj_consumerreach_711
      tags: [""]
      tests:
        - test_null:
            select_columns: ["cdate","retail","retailname","retailbranch","jjskubarcode","jjskuname","file_name"]
            not_null_columns: ["cdate","retail","retailname","retailbranch","jjskubarcode","jjskuname","file_name"]
            name: TRATBL_sdl_jnj_consumerreach_711__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_lookup:
              select_columns: ["cdate","retail","retailname","retailbranch","jjskubarcode","jjskuname","file_name"]
              lookup_column: "cdate, regexp_like (cdate,'(20)[0-9]{2}-(01|02|03|04|05|06|07|08|09|10|11|12)-(01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31)') as result"
              lookup_table: "{{ source('thasdl_raw','sdl_jnj_consumerreach_711') }}"
              lookup_filter: "result = true"
              column: "cdate,true"
              failure_reason: "'CDATE HAVING INCORRECT DATE-FORMAT. EXPECTED: YYYY-MM-DD'"
              name: TRATBL_sdl_jnj_consumerreach_711__lookup_test
              config:
                store_failures: true
                schema: thawks_integration
    - name: sdl_jnj_consumerreach_sfm
      tags: [""]
      tests:
        - test_null:
            select_columns: ["cdate","retail","retailname","retailbranch","jjskubarcode","jjskuname","file_name"]
            not_null_columns: ["cdate","retail","retailname","retailbranch","jjskubarcode","jjskuname","file_name"]
            name: TRATBL_sdl_jnj_consumerreach_sfm__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_lookup:
              select_columns: ["cdate","retail","retailname","retailbranch","jjskubarcode","jjskuname","file_name"]
              lookup_column: "cdate, regexp_like (cdate,'(20)[0-9]{2}-(01|02|03|04|05|06|07|08|09|10|11|12)-(01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31)') as result"
              lookup_table: "{{ source('thasdl_raw','sdl_jnj_consumerreach_sfm') }}"
              lookup_filter: "result = true"
              column: "cdate,true"
              failure_reason: "'CDATE HAVING INCORRECT DATE-FORMAT. EXPECTED: YYYY-MM-DD'"
              name: TRATBL_sdl_jnj_consumerreach_sfm__lookup_test
              config:
                store_failures: true
                schema: thawks_integration
        
  