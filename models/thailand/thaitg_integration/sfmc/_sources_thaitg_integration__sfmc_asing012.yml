version: 2

sources:
  - name: thasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: thasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_th_sfmc_children_data
      tags: ["th_crm_childern"]
      tests:
        - test_null:
            select_columns: ["parent_key","child_number"]
            not_null_columns: ["parent_key","child_number"]
            name: TRATBL_sdl_th_sfmc_children_data__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["parent_key","child_number","file_name"]
            select_columns: ["parent_key","child_number"]
            name: TRATBL_sdl_th_sfmc_children_data__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_lookup:
              select_columns: ["parent_key"]
              column: "upper(nvl(parent_key, ''))"
              lookup_column: "upper(nvl(subscriber_key, ''))"
              lookup_table: "{{ ref('thaitg_integration__itg_sfmc_consumer_master') }} "
              name: TRATBL_sdl_th_sfmc_children_data__lookup_test
              config:
                store_failures: true
                schema: thawks_integration
    
    - name: sdl_th_sfmc_consumer_master
      tags: ["th_crm_consumer_master"]
      tests:
        - test_null:
            select_columns: ["subscriber_key"]
            not_null_columns: ["subscriber_key"]
            name: TRATBL_sdl_th_sfmc_consumer_master__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["subscriber_key","file_name"]
            select_columns: ["subscriber_key"]
            name: TRATBL_sdl_th_sfmc_consumer_master__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
        
    - name: sdl_th_sfmc_consumer_master_additional
      tags: ["th_crm_consumer_master_additional"]
      tests:
        - test_null:
            select_columns: ["subscriber_key","attribute_name","attribute_value"]
            not_null_columns: ["subscriber_key","attribute_name","attribute_value"]
            name: TRATBL_sdl_th_sfmc_consumer_master_additional__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["subscriber_key","attribute_name","attribute_value","file_name"]
            select_columns: ["subscriber_key","attribute_name","attribute_value"]
            name: TRATBL_sdl_th_sfmc_consumer_master_additional__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_lookup:
              select_columns: ["subscriber_key"]
              column: "upper(nvl(subscriber_key, ''))"
              lookup_column: "upper(nvl(subscriber_key, ''))"
              lookup_table: "{{ ref('thaitg_integration__itg_sfmc_consumer_master') }} "
              name: TRATBL_sdl_th_sfmc_consumer_master_additional__lookup_test
              config:
                store_failures: true
                schema: thawks_integration
    - name: sdl_th_sfmc_open_data
      tags: ["th_sfmc_open"]
      tests:
        - test_null:
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique"]
            not_null_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique"]
            name: TRATBL_sdl_th_sfmc_open_data__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique","file_name"]
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","event_date","email_id","is_unique"]
            name: TRATBL_sdl_th_sfmc_open_data__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_lookup:
              select_columns: ["subscriber_key"]
              column: "upper(nvl(subscriber_key, ''))"
              lookup_column: "upper(nvl(subscriber_key, ''))"
              lookup_table: "{{ ref('thaitg_integration__itg_sfmc_consumer_master') }} "
              name: TRATBL_sdl_th_sfmc_open_data__lookup_test
              config:
                store_failures: true
                schema: thawks_integration
    - name: sdl_th_sfmc_unsubscribe_data
      tags: ["th_sfmc_unsubscribe"]
      tests:
        - test_null:
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date"]
            not_null_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date"]
            name: TRATBL_sdl_th_sfmc_unsubscribe_data__null_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_duplicate:
            group_by_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date","file_name"]
            select_columns: ["job_id","batch_id","subscriber_id","subscriber_key","email_id","event_date"]
            name: TRATBL_sdl_th_sfmc_unsubscribe_data__duplicate_test
            config:
              store_failures: true
              schema: thawks_integration
        - test_lookup:
              select_columns: ["subscriber_key"]
              column: "upper(nvl(subscriber_key, ''))"
              lookup_column: "upper(nvl(subscriber_key, ''))"
              lookup_table: "{{ ref('thaitg_integration__itg_sfmc_consumer_master') }} "
              name: TRATBL_sdl_th_sfmc_unsubscribe_data__lookup_test
              config:
                store_failures: true
                schema: thawks_integration
    