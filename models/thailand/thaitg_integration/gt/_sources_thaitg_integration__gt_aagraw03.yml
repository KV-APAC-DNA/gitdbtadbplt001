version: 2

sources:
  - name: thasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: thasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_la_gt_visit
      tags: ["laos_file_ingestion",""]
      tests:
          - test_duplicate__ff:
              group_by_columns: ["filename","id_sale","id_customer","date_plan","date_visi","time_visi","visit_end","saleunit","time_plan"]
              name: TRATBL_sdl_la_gt_visit__duplicate_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_null__ff:
              not_null_columns: ["id_sale","id_customer","date_plan","saleunit","time_plan"]
              name: TRATBL_sdl_la_gt_visit__null_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              where_clause: "not regexp_like (trim(date_plan),'[1-2][0-9][0-9][0-9][0-1][0-9][0-3][0-9]')"
              failure_reason: "'Invalid date_plan'"
              name: TRATBL_sdl_la_gt_visit__date_plan_filter_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              select_columns: ["filename","id_sale","id_customer","date_plan","date_visi","time_visi","visit_end","saleunit","time_plan"]
              where_clause: "not regexp_like (trim(date_visi),'[1-2][0-9][0-9][0-9][0-1][0-9][0-3][0-9]')"
              failure_reason: "'Invalid date_visi'"
              name: TRATBL_sdl_la_gt_visit__date_visi_filter_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              select_columns: ["filename","id_sale","id_customer","date_plan","date_visi","time_visi","visit_end","saleunit","time_plan"]
              where_clause: "not regexp_like (trim(visit_end),'[1-2][0-9][0-9][0-9][0-1][0-9][0-3][0-9]')"
              failure_reason: "'Invalid visit_end'"
              name: TRATBL_sdl_la_gt_visit__visit_end_filter_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              select_columns: ["filename","id_sale","id_customer","date_plan","date_visi","time_visi","visit_end","saleunit","time_plan"]
              where_clause: "not regexp_like (trim(time_visi),'[0-2][0-9]:[0-5][0-9]')"
              failure_reason: "'Invalid time_visi'"
              name: TRATBL_sdl_la_gt_visit__time_visi_filter_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              select_columns: ["filename","id_sale","id_customer","date_plan","date_visi","time_visi","visit_end","saleunit","time_plan"]
              where_clause: "not regexp_like (trim(visit_time),'[0-2][0-9]:[0-5][0-9]')"
              failure_reason: "'Invalid visit_time'"
              name: TRATBL_sdl_la_gt_visit__visit_time_filter_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              select_columns: ["filename","id_sale","id_customer","date_plan","date_visi","time_visi","visit_end","saleunit","time_plan"]
              where_clause: "substring(upper(trim(id_sale)),1,3) <> upper(trim(saleunit))"
              failure_reason:  "'id_sale is not matching with saleunit'"
              name: TRATBL_sdl_la_gt_visit__saleunit_filter_test
              config:
                store_failures: true
                schema: thawks_integration
    - name: sdl_la_gt_schedule
      tags: ["laos_file_ingestion",""]
      tests:
          - test_duplicate:
              group_by_columns: ["filename","saleunit","employee_id","route_id","schedule_date"]
              need_counts: no
              name: TRATBL_sdl_la_gt_schedule__duplicate_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_null:
              not_null_columns: ["saleunit","employee_id","route_id","schedule_date"]
              select_columns: ["filename","saleunit","employee_id","route_id","schedule_date"]
              name: TRATBL_sdl_la_gt_schedule__null_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              select_columns: ["filename","saleunit","employee_id","route_id","schedule_date"]
              where_clause: "not regexp_like (trim(schedule_date),'[1-2][0-9][0-9][0-9][0-1][0-9][0-3][0-9]')"
              failure_reason: "'Invalid schedule_date'"
              name: TRATBL_sdl_la_gt_schedule__schedule_date_filter_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_filter:
              select_columns: ["filename","saleunit","employee_id","route_id","schedule_date"]
              where_clause: "not substring(upper(trim(employee_id)),1,3) = upper(trim(saleunit))"
              failure_reason:  "'employee_id is not matching with saleunit'"
              name: TRATBL_sdl_la_gt_schedule__saleunit_filter_test
              config:
                store_failures: true
                schema: thawks_integration