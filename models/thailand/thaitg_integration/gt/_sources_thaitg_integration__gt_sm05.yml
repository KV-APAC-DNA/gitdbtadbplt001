version: 2

sources:
  - name: thasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: thasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
      - name: sdl_th_gt_schedule
        tags: ["th_gt_schedule"]
        tests:
          - test_null:
              not_null_columns: ["filename","employeeid","routeid","saleunit","schedule_date"]
              select_columns: ["filename","employeeid","routeid","saleunit","schedule_date"]
              name: TRATBL_sdl_th_gt_schedule__null_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_duplicate:
              group_by_columns: ["filename","employeeid","routeid","saleunit","schedule_date"]
              select_columns: ["filename","employeeid","routeid","saleunit","schedule_date"]
              name: TRATBL_sdl_th_gt_schedule__duplicate_test
              config:
                store_failures: true
                schema: thawks_integration
          - test_column:
              compare_columns: ['saleunit','employeeid']
              select_columns: ['filename','saleunit','employeeid','routeid','schedule_date']
              name: TRATBL_sdl_th_gt_schedule__test_column
              config:
                store_failures: true
                schema: thawks_integration

          - test_date_format_odd_eve_leap:
              model_nm: "{{ source('thasdl_raw', 'sdl_th_gt_schedule') }}"
              date_column: "schedule_date"
              filter: "(odd_mon.schedule_date) = (even_mon.schedule_date) and (even_mon.schedule_date) = (feb.schedule_date) and (odd_mon.result) = (even_mon.result) and (even_mon.result) = (feb.result)"
              failure_reason: "'SCHEDULE_DATE HAVING INCORRECT DATE-FORMAT. EXPECTED: YYYYMMDD'"
              select_columns: ['saleunit','employeeid','routeid','schedule_date']
              name: TRATBL_sdl_th_gt_schedule__test_date_format_odd_eve_leap
              config:
                store_failures: true
                schema: thawks_integration
                  

      - name: sdl_th_mt_7_11
        tags: ["th_mt_7_eleven"]
        tests:
            - test_null:
                not_null_columns: ["inventory_report_date","supplier_code","partner_gln","ean_item_code","inventory_location"]
                select_columns: ["inventory_report_date","supplier_code","partner_gln","ean_item_code","inventory_location"]
                name: TRATBL_sdl_th_mt_7_11__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_duplicate:
                group_by_columns: ["inventory_report_date","supplier_code","partner_gln","ean_item_code","inventory_location"]
                select_columns: ["inventory_report_date","supplier_code","partner_gln","ean_item_code","inventory_location"]
                name: TRATBL_sdl_th_mt_7_11__duplicate_test
                config:
                  store_failures: true
                  schema: thawks_integration
      - name: sdl_th_mt_tops
        tags: ["th_mt_tops"]
        tests:
            - test_null:
                not_null_columns: ["inventory_report_date","supplier_gln","partner_gln","ean_item_code","inventory_location"]
                select_columns: ["inventory_report_date","supplier_gln","partner_gln","ean_item_code","inventory_location"]
                name: TRATBL_sdl_th_mt_tops__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_duplicate:
                group_by_columns: ["inventory_report_date","supplier_gln","partner_gln","ean_item_code","inventory_location"]
                select_columns: ["inventory_report_date","supplier_gln","partner_gln","ean_item_code","inventory_location"]
                name: TRATBL_sdl_th_mt_tops__duplicate_test
                config:
                  store_failures: true
                  schema: thawks_integration


      - name: sdl_th_gt_visit
        tests:
            - test_null:
                not_null_columns: ['saleunit','id_sale','id_customer','time_plan','date_plan']
                select_columns: ['filename','saleunit','id_sale','id_customer','time_plan','date_plan','time_visi','visit_end','visit_time']
                name: TRATBL_sdl_th_gt_visit__null_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_duplicate:
                group_by_columns: ['filename','saleunit','id_sale','id_customer','date_plan','time_plan','time_visi','visit_end','visit_time']
                select_columns: ['filename','saleunit','id_sale','id_customer','date_plan','time_plan','time_visi','visit_end','visit_time']
                filter: "trim(time_plan) not in ('88888','99999')"
                name: TRATBL_sdl_th_gt_visit__duplicate_test
                config:
                  store_failures: true
                  schema: thawks_integration
            - test_column:
                compare_columns: ['saleunit','id_sale']
                select_columns: ['filename','saleunit','id_sale','id_customer','date_plan','time_plan','time_visi','visit_end','visit_time']
                name: TRATBL_sdl_th_gt_visit__test_column
                config:
                  store_failures: true
                  schema: thawks_integration

            - test_date_format_odd_eve_leap:
                model_nm: "{{ source('thasdl_raw', 'sdl_th_gt_visit') }}"
                date_column: "date_plan"
                filter: "(odd_mon.date_plan) = (even_mon.date_plan) and (even_mon.date_plan) = (feb.date_plan) and (odd_mon.result) = (even_mon.result) and (even_mon.result) = (feb.result)"
                failure_reason: "'DATE_PLAN HAVING INCORRECT DATE-FORMAT. EXPECTED: YYYYMMDD'"
                select_columns: ['filename','saleunit','id_sale','id_customer','time_plan','date_plan','time_visi','visit_end','visit_time']
                name: TRATBL_sdl_th_gt_visit__test_date_format_odd_eve_leap
                config:
                  store_failures: true
                  schema: thawks_integration

      