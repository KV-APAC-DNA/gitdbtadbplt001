{{
    config
    (
        materialized="incremental",
        incremental_strategy= "append",
        pre_hook = "{% if is_incremental() %}
        DELETE FROM {{this}}
        WHERE HIT_VISITSTARTTIME IN (SELECT MIN(SDL.HIT_VISITSTARTTIME) FROM {{ source('snapindsdl_raw', 'sdl_ga360_aspac_sessions') }} as SDL);
        {% endif %}"
    )
}}
with sdl_ga360_aspac_sessions as
(
    select * from {{ source('snapindsdl_raw', 'sdl_ga360_aspac_sessions') }}
),
final as
(
    select
    hit_timestamp::timestamp_ntz(9) as hit_timestamp,
	visitnumber::number(18,0) as visitnumber,
	visitid::varchar(25) as visitid,
	fullvisitorid::varchar(25) as fullvisitorid,
	hit_visitstarttime::timestamp_ntz(9) as hit_visitstarttime,
	hit_date::date as hit_date,
	date::date as date,
	referralpath::varchar(1500) as referralpath,
	campaign::varchar(1000) as campaign,
	source::varchar(500) as source,
	medium::varchar(250) as medium,
	keyword::varchar(1500) as keyword,
	adcontent::varchar(1000) as adcontent,
	browser::varchar(500) as browser,
	browserversion::varchar(500) as browserversion,
	operatingsystem::varchar(500) as operatingsystem,
	operatingsystemversion::varchar(500) as operatingsystemversion,
	ismobile::varchar(5) as ismobile,
	devicecategory::varchar(50) as devicecategory,
	mobiledeviceinfo::varchar(150) as mobiledeviceinfo,
	mobiledevicemarketingname::varchar(150) as mobiledevicemarketingname,
	mobiledevicemodel::varchar(150) as mobiledevicemodel,
	mobileinputselector::varchar(150) as mobileinputselector,
	mobiledevicebranding::varchar(150) as mobiledevicebranding,
	channelgrouping::varchar(50) as channelgrouping,
	country::varchar(100) as country,
	region::varchar(100) as region,
	metro::varchar(100) as metro,
	networkdomain::varchar(150) as networkdomain,
	networklocation::varchar(150) as networklocation,
	type::varchar(10) as type,
	socialinteractionnetwork::varchar(50) as socialinteractionnetwork,
	socialinteractionaction::varchar(50) as socialinteractionaction,
	hitnumber::number(18,0) as hitnumber,
	hits_time::number(15,5) as hits_time,
	hour::number(18,0) as hour,
	minute::number(18,0) as minute,
	issecure::varchar(5) as issecure,
	isentrance::varchar(5) as isentrance,
	isexit::varchar(5) as isexit,
	isinteraction::varchar(5) as isinteraction,
	referer::varchar(1500) as referer,
	pagepath::varchar(2000) as pagepath,
	hostname::varchar(250) as hostname,
	pagetitle::varchar(1100) as pagetitle,
	searchkeyword::varchar(1000) as searchkeyword,
	searchcategory::varchar(50) as searchcategory,
	hit_transactionid::varchar(250) as hit_transactionid,
	transactionrevenue::number(38,0) as transactionrevenue,
	transactiontax::number(38,0) as transactiontax,
	transactionshipping::number(38,0) as transactionshipping,
	affiliation::varchar(50) as affiliation,
	hit_transaction_currencycode::varchar(50) as hit_transaction_currencycode,
	localtransactionrevenue::number(38,0) as localtransactionrevenue,
	localtransactiontax::number(38,0) as localtransactiontax,
	localtransactionshipping::number(38,0) as localtransactionshipping,
	transactioncoupon::varchar(100) as transactioncoupon,
	transactionid::varchar(250) as transactionid,
	productname::varchar(250) as productname,
	productcategory::varchar(250) as productcategory,
	productsku::varchar(250) as productsku,
	itemquantity::varchar(250) as itemquantity,
	itemrevenue::number(18,0) as itemrevenue,
	currencycode::varchar(50) as currencycode,
	localitemrevenue::number(18,0) as localitemrevenue,
	action_type::varchar(250) as action_type,
	step::varchar(50) as step,
	option::varchar(250) as option,
	hits_product_v2productsku::varchar(1000) as hits_product_v2productsku,
	hits_product_v2productname::varchar(1000) as hits_product_v2productname,
	hits_product_v2productcategory::varchar(250) as hits_product_v2productcategory,
	hits_product_productvariant::varchar(250) as hits_product_productvariant,
	hits_product_productbrand::varchar(250) as hits_product_productbrand,
	isimpression::varchar(5) as isimpression,
	productlistname::varchar(150) as productlistname,
	productlistposition::number(18,0) as productlistposition,
	isclick::varchar(5) as isclick,
	productcouponcode::varchar(150) as productcouponcode,
	productrevenue::number(38,0) as productrevenue,
	productrefundamount::number(38,0) as productrefundamount,
	eventcategory::varchar(50) as eventcategory,
	eventaction::varchar(1500) as eventaction,
	eventlabel::varchar(5000) as eventlabel,
	eventvalue::number(18,0) as eventvalue,
	product_detail_views_g3::number(18,0) as product_detail_views_g3,
	store_locator_submits_g8::number(18,0) as store_locator_submits_g8,
	registration_start::number(18,0) as registration_start,
	page_type_cd2::varchar(256) as page_type_cd2,
	site_section_cd3::varchar(2500) as site_section_cd3,
	sub_section_cd4::varchar(2000) as sub_section_cd4,
	video_name_cd22::varchar(500) as video_name_cd22,
	video_segment_cd23::varchar(50) as video_segment_cd23,
	coupon_name_cd26::varchar(50) as coupon_name_cd26,
	coupon_type_cd27::varchar(50) as coupon_type_cd27,
	video_length_cd36::varchar(50) as video_length_cd36,
	video_player_cd37::varchar(50) as video_player_cd37,
	region_cd39::varchar(50) as region_cd39,
	country_cd40::varchar(100) as country_cd40,
	brand_cd41::varchar(250) as brand_cd41,
	exit_domain_cd43::varchar(1500) as exit_domain_cd43,
	product_region_cd60::varchar(100) as product_region_cd60,
	product_gfo_cd61::varchar(50) as product_gfo_cd61,
	product_sub_brand_cd62::varchar(250) as product_sub_brand_cd62,
	product_need_state_cd63::varchar(50) as product_need_state_cd63,
	product_sub_category_cd64::varchar(50) as product_sub_category_cd64,
	product_segment_cd65::varchar(50) as product_segment_cd65,
	product_sub_segment_cd66::varchar(100) as product_sub_segment_cd66,
	product_variant_cd67::varchar(256) as product_variant_cd67,
	pct_page_viewed_cm1::number(18,0) as pct_page_viewed_cm1,
	eretailer_exit_cm3::number(18,0) as eretailer_exit_cm3,
	free_trial_request_cm4::number(18,0) as free_trial_request_cm4,
	video_play_cm6::number(18,0) as video_play_cm6,
	video_time_played_cm7::number(18,0) as video_time_played_cm7,
	video_segments_viewed_cm8::number(18,0) as video_segments_viewed_cm8,
	video_completes_cm9::number(18,0) as video_completes_cm9,
	where_to_buy_search_cm10::number(18,0) as where_to_buy_search_cm10,
	registration_cm17::number(18,0) as registration_cm17,
	log_in_cm18::number(18,0) as log_in_cm18,
	log_out_cm19::number(18,0) as log_out_cm19,
	coupon_click_cm20::number(18,0) as coupon_click_cm20,
	coupon_print_cm21::number(18,0) as coupon_print_cm21,
	coupon_print_error_cm22::number(18,0) as coupon_print_error_cm22,
	coupon_value_cm23::number(18,0) as coupon_value_cm23,
	coupon_rebate_cm24::number(18,0) as coupon_rebate_cm24,
	product_rating_submit_cm26::number(18,0) as product_rating_submit_cm26,
	product_rating_value_cm27::number(18,0) as product_rating_value_cm27,
	pdp_view_cm28::number(18,0) as pdp_view_cm28,
	downloads_cm31::number(18,0) as downloads_cm31,
	site_exit_cm32::number(18,0) as site_exit_cm32,
	social_share_cm34::number(18,0) as social_share_cm34,
	page_engagement_cm37::number(18,0) as page_engagement_cm37,
	listing_viewed_cm45::number(18,0) as listing_viewed_cm45,
	recommended_product_interaction_cm46::number(18,0) as recommended_product_interaction_cm46,
	favorite_product_interaction_cm47::number(18,0) as favorite_product_interaction_cm47,
	recommended_product_location_cm70::number(18,0) as recommended_product_location_cm70,
	favorite_product_interaction_type_cm72::number(18,0) as favorite_product_interaction_type_cm72,
	bounces::number(18,0) as bounces,
	hits::number(18,0) as hits,
	new_visits::number(18,0) as new_visits,
	pageviews::number(18,0) as pageviews,
	screenviews::number(18,0) as screenviews,
	timeonscreen::number(18,0) as timeonscreen,
	timeonsite::number(18,0) as timeonsite,
	total_transaction_revenue::number(38,0) as total_transaction_revenue,
	transactions::number(18,0) as transactions,
	unique_screen_views::number(18,0) as unique_screen_views,
	visits::number(18,0) as visits,
	productquantity::number(18,0) as productquantity,
	localproductprice::number(38,0) as localproductprice,
	localproductrefundamount::number(38,0) as localproductrefundamount,
	localproductrevenue::number(38,0) as localproductrevenue,
	productprice::number(38,0) as productprice,
	promocreative::varchar(500) as promocreative,
	promoid::varchar(500) as promoid,
	promoname::varchar(500) as promoname,
	promoposition::varchar(500) as promoposition,
	promoisview::varchar(5) as promoisview,
	promoisclick::varchar(5) as promoisclick,
	localrefundamount::number(38,0) as localrefundamount,
	refundamount::number(38,0) as refundamount,
	adsensebackfilldfprevenuecpc::number(38,0) as adsensebackfilldfprevenuecpc,
	adsensebackfilldfprevenuecpm::number(38,0) as adsensebackfilldfprevenuecpm,
	adxbackfilldfprevenuecpc::number(38,0) as adxbackfilldfprevenuecpc,
	adxbackfilldfprevenuecpm::number(38,0) as adxbackfilldfprevenuecpm,
	dfprevenuecpc::number(38,0) as dfprevenuecpc,
	dfprevenuecpm::number(38,0) as dfprevenuecpm,
	totals_transactionrevenue::number(38,0) as totals_transactionrevenue,
	load_date::date as load_date,
	gcph_gfo::varchar(100) as gcph_gfo,
	gcph_brand::varchar(100) as gcph_brand,
	gcph_subbrand::varchar(100) as gcph_subbrand,
	gcph_varient::varchar(100) as gcph_varient,
	gcph_needstate::varchar(100) as gcph_needstate,
	gcph_category::varchar(100) as gcph_category,
	gcph_subcategory::varchar(100) as gcph_subcategory,
	gcph_segment::varchar(100) as gcph_segment,
	gcph_subsegment::varchar(100) as gcph_subsegment
    from sdl_ga360_aspac_sessions
)
select * from final