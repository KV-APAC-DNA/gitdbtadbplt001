version: 2

sources:
  - name: hcpsdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: snapindsdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_hcp360_in_iqvia_sales
      tags: ["in_iqvia_sales_ingestion","ingestion"]
      tests:
        - test_format:
                select_columns: ["pack"]
                failure_reason: "'Column value mismatch'"
                where_clause: "product IN ('ORS-L', 'ORS-L FOS', 'ORS-L PLUS', 'ORS-L REHYDRATE', 'ORS%') AND pack NOT IN (SELECT iqvia FROM dev_dna_core.snapinditg_integration.itg_mds_hcp360_product_mapping WHERE brand = 'ORSL')"
                name: TRATBL_sdl_hcp360_in_iqvia_sales__test_format
                config:
                  store_failures: true
                  schema: hcpwks_integration
    - name: sdl_hcp360_in_iqvia_speciality
      tags: ["in_iqvia_edw_load","ingestion"]
      tests:
        - test_format:
                select_columns: ["product_description"]
                failure_reason: "'Column value mismatch'"
                where_clause: "brand IN ('ORS-L', 'ORS-L FOS', 'ORS-L PLUS', 'ORS-L REHYDRATE', 'ORS%') AND product_description NOT IN (SELECT iqvia FROM dev_dna_core.snapinditg_integration.itg_mds_hcp360_product_mapping WHERE brand = 'ORSL')"
                name: TRATBL_sdl_hcp360_in_iqvia_speciality__test_format
                config:
                  store_failures: true
                  schema: hcpwks_integration
    - name: sdl_hcp360_in_iqvia_aveeno_zone
      tags: ["in_iqvia_sales_ingestion","ingestion"]
      tests:
        - test_format:
                select_columns: ["pack"]
                failure_reason: "'Column value mismatch'"
                where_clause: "(product LIKE 'AVEENO%' or product LIKE 'AVEENO%') AND pack NOT IN (SELECT iqvia FROM dev_dna_core.snapinditg_integration.itg_mds_hcp360_product_mapping WHERE brand = 'AVEENO BABY' or brand = 'DERMA')"
                name: TRATBL_sdl_hcp360_in_iqvia_aveeno_zone__test_format
                config:
                  store_failures: true
                  schema: hcpwks_integration
    # - name: sdl_hcp360_in_iqvia_aveeno_speciality
    #   tags: ["in_iqvia_edw_load","ingestion"]
    #   tests:
    #     - test_format:
    #             select_columns: ["product_description"]
    #             failure_reason: "'Column value mismatch'"
    #             where_clause: "(product_description LIKE 'AVEENO%' or product_description LIKE 'AVEENO%') AND product_description NOT IN (SELECT iqvia FROM dev_dna_core.snapinditg_integration.itg_mds_hcp360_product_mapping WHERE brand = 'AVEENO BABY' or brand = 'DERMA')"
    #             name: TRATBL_sdl_hcp360_in_iqvia_aveeno_speciality__test_format
    #             config:
    #               store_failures: true
    #               schema: hcpwks_integration