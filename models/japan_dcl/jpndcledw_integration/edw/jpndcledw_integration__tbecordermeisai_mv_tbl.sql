with TBECORDERMEISAI
AS
(
    select * from jpdclitg_integration.TBECORDERMEISAI
),
t1 AS
(
    SELECT ROW_NUMBER() OVER (
            PARTITION BY a.DIORDERID ORDER BY a.DIMEISAIID ASC
            ) as row_number,
        dimeisaiid,
        DIORDERID,
        disetid,
        diid,
        c_diitemtype,
        dsitemid,
        dsitemname,
        c_dsitemnameryaku,
        diusualprc,
        ditotalprc,
        diitemtax,
        diitemnum,
        c_diitemtotalprc,
        c_didiscountmeisai,
        dishukkasts,
        c_dipresentgrantcord,
        c_dikesaiid,
        c_dsregularmeisaiid,
        c_dsordertype,
        c_disubscriptionkubun,
        c_diregularcourseid,
        dipromid,
        c_disetitemprc,
        c_dssetitemkbn,
        c_dssetitemflg,
        c_dspickingflg,
        c_dspointflg,
        c_dspointitemflg,
        c_dsnoshinshooutputflg,
        dicancel,
        c_dshenpinflg,
        dsshukaflg,
        dihenpinyoteinum,
        c_dinoshinshoitemprc,
        c_dssampleclasscd,
        c_dssamplelogicd,
        disokoid,
        dirouteid,
        c_distockchanelid,
        c_dihikiatenum,
        c_diadjustprc,
        c_dsdemandkbn,
        c_dsdiscpritekiyoflg,
        c_didiscountrate,
        c_dsmessage,
        c_diorderlineno,
        c_dikesailineno,
        c_dspotsalesno,
        c_dipotlineno,
        disetmeisaiid,
        c_difrontsortorder,
        c_dinondispflg,
        c_dsfreekbn,
        c_diusepoint,
        dsprep,
        dsren,
        dselim,
        diprepusr,
        direnusr,
        dielimusr,
        dielimflg,
        c_diwarnitemid,
        c_diyoyakuhenpinflg,
        c_dihenpinzuminum,
        c_diregulardiscountrate,
        c_dstaxkbn,
        ditaxrate,
        CURRENT_TIMESTAMP() as inserted_date,
        'ETL_Batch' as inserted_by,
        CURRENT_TIMESTAMP() as updated_date,
        null as updated_by
    FROM TBECORDERMEISAI a
),
final as
(
    select row_number::NUMBER(38,0) AS ROW_NUMBER,
        dimeisaiid::NUMBER(38,0) AS DIMEISAIID,
        DIORDERID::VARCHAR(18) AS DIORDERID,
        disetid::NUMBER(38,0) AS DISETID,
        diid::NUMBER(38,0) AS DIID,
        c_diitemtype::VARCHAR(3) AS C_DIITEMTYPE,
        dsitemid::VARCHAR(45) AS DSITEMID,
        dsitemname::VARCHAR(192) AS DSITEMNAME,
        c_dsitemnameryaku::VARCHAR(192) AS C_DSITEMNAMERYAKU,
        diusualprc::NUMBER(38,0) AS DIUSUALPRC,
        ditotalprc::NUMBER(38,0) AS DITOTALPRC,
        diitemtax::NUMBER(38,0) AS DIITEMTAX,
        diitemnum::NUMBER(38,0) AS DIITEMNUM,
        c_diitemtotalprc::NUMBER(38,0) AS C_DIITEMTOTALPRC,
        c_didiscountmeisai::NUMBER(38,0) AS C_DIDISCOUNTMEISAI,
        dishukkasts::VARCHAR(6) AS DISHUKKASTS,
        c_dipresentgrantcord::NUMBER(38,0) AS C_DIPRESENTGRANTCORD,
        c_dikesaiid::NUMBER(38,0) AS C_DIKESAIID,
        c_dsregularmeisaiid::NUMBER(38,0) AS C_DSREGULARMEISAIID,
        c_dsordertype::VARCHAR(1) AS C_DSORDERTYPE,
        c_disubscriptionkubun::VARCHAR(1) AS C_DISUBSCRIPTIONKUBUN,
        c_diregularcourseid::NUMBER(38,0) AS C_DIREGULARCOURSEID,
        dipromid::NUMBER(38,0) AS DIPROMID,
        c_disetitemprc::NUMBER(38,0) AS C_DISETITEMPRC,
        c_dssetitemkbn::VARCHAR(1) AS C_DSSETITEMKBN,
        c_dssetitemflg::VARCHAR(1) AS C_DSSETITEMFLG,
        c_dspickingflg::VARCHAR(1) AS C_DSPICKINGFLG,
        c_dspointflg::VARCHAR(1) AS C_DSPOINTFLG,
        c_dspointitemflg::VARCHAR(1) AS C_DSPOINTITEMFLG,
        c_dsnoshinshooutputflg::VARCHAR(1) AS C_DSNOSHINSHOOUTPUTFLG,
        dicancel::VARCHAR(1) AS DICANCEL,
        c_dshenpinflg::VARCHAR(1) AS C_DSHENPINFLG,
        dsshukaflg::VARCHAR(1) AS DSSHUKAFLG,
        dihenpinyoteinum::NUMBER(38,0) AS DIHENPINYOTEINUM,
        c_dinoshinshoitemprc::NUMBER(38,0) AS C_DINOSHINSHOITEMPRC,
        c_dssampleclasscd::VARCHAR(15) AS C_DSSAMPLECLASSCD,
        c_dssamplelogicd::VARCHAR(3) AS C_DSSAMPLELOGICD,
        disokoid::NUMBER(38,0) AS DISOKOID,
        dirouteid::NUMBER(38,0) AS DIROUTEID,
        c_distockchanelid::NUMBER(38,0) AS C_DISTOCKCHANELID,
        c_dihikiatenum::NUMBER(18,0) AS C_DIHIKIATENUM,
        c_diadjustprc::NUMBER(38,0) AS C_DIADJUSTPRC,
        c_dsdemandkbn::VARCHAR(1) AS C_DSDEMANDKBN,
        c_dsdiscpritekiyoflg::VARCHAR(1) AS C_DSDISCPRITEKIYOFLG,
        c_didiscountrate::NUMBER(18,0) AS C_DIDISCOUNTRATE,
        c_dsmessage::VARCHAR(87) AS C_DSMESSAGE,
        c_diorderlineno::NUMBER(38,0) AS C_DIORDERLINENO,
        c_dikesailineno::NUMBER(38,0) AS C_DIKESAILINENO,
        c_dspotsalesno::VARCHAR(25) AS C_DSPOTSALESNO,
        c_dipotlineno::NUMBER(38,0) AS C_DIPOTLINENO,
        disetmeisaiid::NUMBER(38,0) AS DISETMEISAIID,
        c_difrontsortorder::NUMBER(38,0) AS C_DIFRONTSORTORDER,
        c_dinondispflg::VARCHAR(1) AS C_DINONDISPFLG,
        c_dsfreekbn::VARCHAR(1) AS C_DSFREEKBN,
        c_diusepoint::NUMBER(18,0) AS C_DIUSEPOINT,
        dsprep::TIMESTAMP_NTZ(9) AS DSPREP,
        dsren::TIMESTAMP_NTZ(9) AS DSREN,
        dselim::TIMESTAMP_NTZ(9) AS DSELIM,
        diprepusr::NUMBER(38,0) AS DIPREPUSR,
        direnusr::NUMBER(38,0) AS DIRENUSR,
        dielimusr::NUMBER(38,0) AS DIELIMUSR,
        dielimflg::VARCHAR(1) AS DIELIMFLG,
        c_diwarnitemid::NUMBER(38,0) AS C_DIWARNITEMID,
        c_diyoyakuhenpinflg::VARCHAR(1) AS C_DIYOYAKUHENPINFLG,
        c_dihenpinzuminum::NUMBER(38,0) AS C_DIHENPINZUMINUM,
        c_diregulardiscountrate::NUMBER(18,0) AS C_DIREGULARDISCOUNTRATE,
        c_dstaxkbn::VARCHAR(3) AS C_DSTAXKBN,
        ditaxrate::NUMBER(38,0) AS DITAXRATE,
        inserted_date::TIMESTAMP_NTZ(9) AS INSERTED_DATE,
        inserted_by::VARCHAR(100) AS INSERTED_BY,
        updated_date::TIMESTAMP_NTZ(9) AS UPDATED_DATE,
        updated_by::VARCHAR(100) AS UPDATED_BY
    from t1 
)
select * from final
