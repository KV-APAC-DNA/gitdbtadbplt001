WITH tbUsrPram
AS (
    SELECT *
    FROM {{ref('jpndclitg_integration__tbusrpram')}}
    ),
tbPromotion
AS (
    SELECT *
    FROM {{ref('jpndclitg_integration__tbpromotion')}}
    ),
HANYO_ATTR
AS (
    SELECT *
    FROM {{ref('jpndcledw_integration__hanyo_attr')}}
    ),
t1
AS (
    SELECT LPAD(tbUsrPram.DIUSRID, 10, '0') AS KOKYANO,
        tbUsrPram.DSZIP AS ZIPCODE,
        tbUsrPram.DSPREF AS TODOFUKENNAME,
        tbUsrPram.DSSEIBETSU AS SEIBETUKBN,
        CAST(TO_CHAR(TO_DATE(tbUsrPram.DSBIRTHDAY, 'YYYY-MM-DD HH24:MI:SS'), 'YYYYMMDD') AS INTEGER) AS BIRTHDAY,
        {{ get_birthday_edit("CAST(TO_CHAR(TO_TIMESTAMP(tbUsrPram.dsBirthDay, 'YYYY-MM-DD HH24:MI:SS'), 'YYYYMMDD') AS INTEGER)") }} AS BIRTHDAYEDIT,
        -- EDW_SCHEMA.GET_BIRTHDAY_EDIT(CAST(TO_CHAR(TO_DATE(tbUsrPram.dsBirthDay, 'YYYY-MM-DD HH24:MI:SS'), 'YYYYMMDD') AS INTEGER)) AS BIRTHDAYEDIT,
        tbUsrPram.DSDAT10 AS KOKYAKBN,
        tbUsrPram.DSDAT11 AS KOKYATAIOKBN,
        tbUsrPram.DSDAT12 AS KOKYASTS,
        tbUsrPram.DSDAT61 AS DMTENPOFLG,
        tbUsrPram.DSDAT60 AS DMTSUHANFLG,
        tbUsrPram.DSDAT63 AS TELTENPOFLG,
        tbUsrPram.DSDAT62 AS TELTSUHANFLG,
        NVL(tbPromotion.dspromcode, '00000') AS FIRSTMEDIACODE,
        tbUsrPram.DISECESSIONFLG AS DELETEFLG,
        tbUsrPram.DSDAT9 AS CARRERNAME,
        CAST(TO_CHAR(TO_DATE(tbUsrPram.DSPREP, 'YYYY-MM-DD HH24:MI:SS'), 'YYYYMMDD') AS INTEGER) AS INSERTDATE,
        CAST(TO_CHAR(TO_TIMESTAMP(tbUsrPram.DSPREP, 'YYYY-MM-DD HH24:MI:SS'), 'HH24MISS') AS INTEGER) AS INSERTTIME,
        LPAD(tbUsrPram.DIPREPUSR, 10, '0') AS INSERTID,
        CAST(TO_CHAR(TO_DATE(tbUsrPram.DSREN, 'YYYY-MM-DD HH24:MI:SS'), 'YYYYMMDD') AS INTEGER) AS UPDATEDATE,
        tbUsrPram.DSDAT66 AS RANK,
        tbUsrPram.DSDAT67 AS HCARDCONTRACTDATE,
        tbUsrPram.DSDAT69 AS HCARDCANCELDATE,
        tbUsrPram.DSDAT71 AS HCARDCLASS,
        tbUsrPram.DSDAT7 AS CARDKOKYANO,
        tbUsrPram.DSDAT13 AS FSKBN,
        NULL AS rowid01,																					
        NULL AS	rowid02,
        HANYO_ATTR.ATTR5 AS TODOFUKENCODE,
        tbUsrPram.DSDAT93 AS TESTUSRFLG,
        tbUsrPram.DSNAME AS NAME1,
        tbUsrPram.DSNAME2 AS NAME2,
        tbUsrPram.DSKANA AS KANA1,
        tbUsrPram.DSKANA2 AS KANA2,
        tbUsrPram.DSCITY AS CITY,
        tbUsrPram.DSADDR AS ADDR,
        tbUsrPram.DSTATEMONO AS TATEMONO,
        tbUsrPram.DSMAIL AS MAIL_PC,
        tbUsrPram.DSTEL AS TEL,
        tbUsrPram.DISECESSIONFLG AS TAIKAI_FLG,
        tbUsrPram.DIPOINT AS POINT,
        tbUsrPram.DISNDFLG AS SNDFLG,
        tbUsrPram.DSCTRLCD AS WEBNO,
        tbUsrPram.DSDAT1 AS MAIL_MOBILE,
        tbUsrPram.DSDAT2 AS TEL_MOBILE,
        tbUsrPram.DSDAT3 AS TEL_OTHER,
        tbUsrPram.DSDAT4 AS MAIN_TEL,
        tbUsrPram.DSDAT5 AS MAIN_MAIL,
        tbUsrPram.DSDAT14 AS PASTPAYKBN,
        tbUsrPram.DSDAT18 AS BUYRUIKEI,
        tbUsrPram.DSDAT19 AS BUYRUIKEISAMPLEIN,
        tbUsrPram.DSDAT20 AS BUYFIRST,
        tbUsrPram.DSDAT21 AS BUYLAST_ESTHEUP4,
        tbUsrPram.DSDAT22 AS BUYLAST_ESTHEUPCAB,
        tbUsrPram.DSDAT23 AS BUYLAST_SONICLIFT,
        tbUsrPram.DSDAT24 AS BUYLAST_ACG,
        tbUsrPram.DSDAT25 AS BUYLAST_GEL,
        tbUsrPram.DSDAT32 AS BUYNUM_ESTHEUP4,
        tbUsrPram.DSDAT33 AS BUYNUM_ESTHEUPCAB,
        tbUsrPram.DSDAT34 AS BUYNUM_SONICLIFT,
        tbUsrPram.DSDAT35 AS BUYNUM_ACG,
        tbUsrPram.DSDAT36 AS BUYNUM_GEL,
        tbUsrPram.DSDAT40 AS NOPAY_YEN,
        tbUsrPram.DSDAT44 AS CHANNEL_REGIST,
        tbUsrPram.DSDAT46 AS MAILMEMB_FLG,
        tbUsrPram.DSDAT48 AS MAILBIHADA_FLG,
        tbUsrPram.DSDAT50 AS MAILCILABO_FLG,
        tbUsrPram.DSDAT52 AS ADDR_KANA,
        tbUsrPram.DSDAT53 AS MAILTENKI_FLG,
        tbUsrPram.DSDAT55 AS MAILSTORE_FLG,
        tbUsrPram.DSDAT64 AS SNDNEWSLETTER_FLG,
        tbUsrPram.DSDAT65 AS SNDMOUSIKOMI_FLG,
        tbUsrPram.DSDAT68 AS HCARDUPDATE,
        tbUsrPram.DSDAT70 AS HCARDGROUPNO,
        tbUsrPram.DSDAT72 AS OKURIJO_MEMO,
        tbUsrPram.DSDAT92 AS POINTGUIDE_FLG,
        tbUsrPram.DSDAT94 AS ECCONTRACTDATE,
        tbUsrPram.DSFAX AS FAXNO,
        tbUsrPram.DSMEMO AS MEMO,
        tbUsrPram.DIRENUSR AS UPDATEID
    FROM tbUsrPram,
        tbPromotion,
        HANYO_ATTR
    WHERE tbUsrPram.dipromid = tbPromotion.dipromid(+)
        AND tbUsrPram.DSPREF = HANYO_ATTR.ATTR1(+)
        AND HANYO_ATTR.KBNMEI(+) = 'TODOFUKEN'
    ),
final as
(
    select KOKYANO::VARCHAR(60) AS KOKYANO,
        ZIPCODE::VARCHAR(30) AS ZIPCODE,
        TODOFUKENNAME::VARCHAR(120) AS TODOFUKENNAME,
        SEIBETUKBN::VARCHAR(760) AS SEIBETUKBN,
        BIRTHDAY::NUMBER(18,0) AS BIRTHDAY,
        BIRTHDAYEDIT::NUMBER(18,0) AS BIRTHDAYEDIT,
        KOKYAKBN::VARCHAR(12000) AS KOKYAKBN,
        KOKYATAIOKBN::VARCHAR(12000) AS KOKYATAIOKBN,
        KOKYASTS::VARCHAR(12000) AS KOKYASTS,
        DMTENPOFLG::VARCHAR(12000) AS DMTENPOFLG,
        DMTSUHANFLG::VARCHAR(12000) AS DMTSUHANFLG,
        TELTENPOFLG::VARCHAR(12000) AS TELTENPOFLG,
        TELTSUHANFLG::VARCHAR(12000) AS TELTSUHANFLG,
        FIRSTMEDIACODE::VARCHAR(20) AS FIRSTMEDIACODE,
        DELETEFLG::VARCHAR(760) AS DELETEFLG,
        CARRERNAME::VARCHAR(12000) AS CARRERNAME,
        INSERTDATE::NUMBER(18,0) AS INSERTDATE,
        INSERTTIME::NUMBER(18,0) AS INSERTTIME,
        INSERTID::VARCHAR(60) AS INSERTID,
        UPDATEDATE::NUMBER(18,0) AS UPDATEDATE,
        RANK::VARCHAR(12000) AS RANK,
        HCARDCONTRACTDATE::VARCHAR(12000) AS HCARDCONTRACTDATE,
        HCARDCANCELDATE::VARCHAR(12000) AS HCARDCANCELDATE,
        HCARDCLASS::VARCHAR(12000) AS HCARDCLASS,
        CARDKOKYANO::VARCHAR(12000) AS CARDKOKYANO,
        FSKBN::VARCHAR(12000) AS FSKBN,
        ROWID01::VARCHAR(60) AS ROWID01,
        ROWID02::VARCHAR(60) AS ROWID02,
        TODOFUKENCODE::VARCHAR(120) AS TODOFUKENCODE,
        TESTUSRFLG::VARCHAR(12000) AS TESTUSRFLG,
        NAME1::VARCHAR(60) AS NAME1,
        NAME2::VARCHAR(60) AS NAME2,
        KANA1::VARCHAR(60) AS KANA1,
        KANA2::VARCHAR(60) AS KANA2,
        CITY::VARCHAR(216) AS CITY,
        ADDR::VARCHAR(160) AS ADDR,
        TATEMONO::VARCHAR(160) AS TATEMONO,
        MAIL_PC::VARCHAR(360) AS MAIL_PC,
        TEL::VARCHAR(48) AS TEL,
        TAIKAI_FLG::VARCHAR(760) AS TAIKAI_FLG,
        POINT::NUMBER(30,0) AS POINT,
        SNDFLG::VARCHAR(760) AS SNDFLG,
        WEBNO::VARCHAR(48) AS WEBNO,
        MAIL_MOBILE::VARCHAR(12000) AS MAIL_MOBILE,
        TEL_MOBILE::VARCHAR(12000) AS TEL_MOBILE,
        TEL_OTHER::VARCHAR(12000) AS TEL_OTHER,
        MAIN_TEL::VARCHAR(12000) AS MAIN_TEL,
        MAIN_MAIL::VARCHAR(12000) AS MAIN_MAIL,
        PASTPAYKBN::VARCHAR(12000) AS PASTPAYKBN,
        BUYRUIKEI::VARCHAR(12000) AS BUYRUIKEI,
        BUYRUIKEISAMPLEIN::VARCHAR(12000) AS BUYRUIKEISAMPLEIN,
        BUYFIRST::VARCHAR(12000) AS BUYFIRST,
        BUYLAST_ESTHEUP4::VARCHAR(12000) AS BUYLAST_ESTHEUP4,
        BUYLAST_ESTHEUPCAB::VARCHAR(12000) AS BUYLAST_ESTHEUPCAB,
        BUYLAST_SONICLIFT::VARCHAR(12000) AS BUYLAST_SONICLIFT,
        BUYLAST_ACG::VARCHAR(12000) AS BUYLAST_ACG,
        BUYLAST_GEL::VARCHAR(12000) AS BUYLAST_GEL,
        BUYNUM_ESTHEUP4::VARCHAR(12000) AS BUYNUM_ESTHEUP4,
        BUYNUM_ESTHEUPCAB::VARCHAR(12000) AS BUYNUM_ESTHEUPCAB,
        BUYNUM_SONICLIFT::VARCHAR(12000) AS BUYNUM_SONICLIFT,
        BUYNUM_ACG::VARCHAR(12000) AS BUYNUM_ACG,
        BUYNUM_GEL::VARCHAR(12000) AS BUYNUM_GEL,
        NOPAY_YEN::VARCHAR(12000) AS NOPAY_YEN,
        CHANNEL_REGIST::VARCHAR(12000) AS CHANNEL_REGIST,
        MAILMEMB_FLG::VARCHAR(12000) AS MAILMEMB_FLG,
        MAILBIHADA_FLG::VARCHAR(12000) AS MAILBIHADA_FLG,
        MAILCILABO_FLG::VARCHAR(12000) AS MAILCILABO_FLG,
        ADDR_KANA::VARCHAR(12000) AS ADDR_KANA,
        MAILTENKI_FLG::VARCHAR(12000) AS MAILTENKI_FLG,
        MAILSTORE_FLG::VARCHAR(12000) AS MAILSTORE_FLG,
        SNDNEWSLETTER_FLG::VARCHAR(12000) AS SNDNEWSLETTER_FLG,
        SNDMOUSIKOMI_FLG::VARCHAR(12000) AS SNDMOUSIKOMI_FLG,
        HCARDUPDATE::VARCHAR(12000) AS HCARDUPDATE,
        HCARDGROUPNO::VARCHAR(12000) AS HCARDGROUPNO,
        OKURIJO_MEMO::VARCHAR(12000) AS OKURIJO_MEMO,
        POINTGUIDE_FLG::VARCHAR(12000) AS POINTGUIDE_FLG,
        ECCONTRACTDATE::VARCHAR(12000) AS ECCONTRACTDATE,
        FAXNO::VARCHAR(48) AS FAXNO,
        MEMO::VARCHAR(6000) AS MEMO,
        UPDATEID::NUMBER(30,0) AS UPDATEID,
        CURRENT_TIMESTAMP()::TIMESTAMP_NTZ(9)  AS INSERTED_DATE,
        'ETL_Batch'::VARCHAR(900)  AS INSERTED_BY,
        CURRENT_TIMESTAMP()::TIMESTAMP_NTZ(9)  AS UPDATED_DATE,
        NULL::VARCHAR(900) AS UPDATED_BY
    from t1
)
SELECT *
FROM
final
