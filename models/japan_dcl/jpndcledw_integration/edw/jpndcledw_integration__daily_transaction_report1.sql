WITH wqwt03
AS (
  SELECT *
  FROM {{ source('jpdcledw_integration','"wqwt03通販売上明細"') }}
  ),
transformed
AS (
    SELECT
        "売上no", "受注年度名称", "受注半期名称", "受注四半期名称", "受注年", "受注月",
        TO_CHAR(TO_DATE(TRIM(TO_CHAR("受注年月日", '99999999')), 'YYYYMMDD'), 'YYYY/MM/DD') AS "受注年月日",
        "出荷年度名称", "出荷半期名称", "出荷四半期名称", "出荷年", "出荷月",
        TO_CHAR(TO_DATE(TRIM(TO_CHAR("出荷年月日", '99999999')), 'YYYYMMDD'), 'YYYY/MM/DD') AS "出荷年月日",
        "受注区分コード", "c受注区分名", "返品理由コード", "c返品理由名", "cキャンセルフラグ名",
        "取引形態区分コード", "c取引形態区分名", "決済区分コード", "c決済区分名", "c削除フラグ名",
        "c通信経路大区分名", "c通信経路中区分名", "c通信経路小区分名", "c通信経路名",
        "購入媒体コード", "c購入媒体名", "受注商品大々区分コード", "c受注商品大々区分名",
        "受注商品大区分コード", "c受注商品大区分名", "受注商品中区分コード", "c受注商品中区分名",
        "受注商品コード", "c受注商品名", "受注担当者コード", "c受注担当者名",
        "受注商品su割引後税抜金額", "受注商品数量", "消費税額", 1 as "?column?", "顧客no",
        TO_CHAR(TO_DATE(TRIM(TO_CHAR("お届希望日", '99999999')), 'YYYYMMDD'), 'YYYY/MM/DD') AS "お届希望日",
        "販促dm_店舗名", "販促dm_cc通販その他名", "部門1追加属性1", "部門1追加属性2",
        "部門1追加属性3", "部門1追加属性4", "部門1追加属性5", "部門1追加属性6",
        "部門1追加属性7", "部門1追加属性8", "部門1追加属性9", "部門1追加属性10",
        "部門2追加属性1", "部門2追加属性2", "部門2追加属性3", "部門2追加属性4",
        "部門2追加属性5", "部門2追加属性6", "部門2追加属性7", "部門2追加属性8",
        "部門2追加属性9", "部門2追加属性10", "部門3追加属性1", "部門3追加属性2",
        "部門3追加属性3", "部門3追加属性4", "部門3追加属性5", "部門3追加属性6",
        "部門3追加属性7", "部門3追加属性8", "部門3追加属性9", "部門3追加属性10",
        "部門4追加属性1", "部門4追加属性2", "部門4追加属性3", "部門4追加属性4",
        "部門4追加属性5", "部門4追加属性6", "部門4追加属性7", "部門4追加属性8",
        "部門4追加属性9", "部門4追加属性10", "部門5追加属性1", "部門5追加属性2",
        "部門5追加属性3", "部門5追加属性4", "部門5追加属性5", "部門5追加属性6",
        "部門5追加属性7", "部門5追加属性8", "部門5追加属性9", "部門5追加属性10",
        "部門6追加属性1", "部門6追加属性2", "部門6追加属性3", "部門6追加属性4",
        "部門6追加属性5", "部門6追加属性6", "部門6追加属性7", "部門6追加属性8",
        "部門6追加属性9", "部門6追加属性10", "部門6追加属性11", "部門6追加属性12",
        "部門6追加属性13", "部門6追加属性14", "部門6追加属性15", "部門6追加属性16",
        "部門6追加属性17", "部門6追加属性18", "部門6追加属性19", "部門6追加属性20"
FROM wqwt03
WHERE
    TO_CHAR(TO_DATE(TRIM(TO_CHAR("出荷年月日", '99999999')), 'YYYYMMDD'), 'YYYY/MM') >=
    TO_CHAR(DATEADD(year, -1, convert_timezone('Asia/Tokyo', CURRENT_TIMESTAMP())), 'YYYY/MM')
ORDER BY "売上no" ASC, "受注区分コード" ASC, "返品理由コード" ASC
),
final
AS (
  SELECT
        "売上no"::VARCHAR(24) AS "売上no",
        "受注年度名称"::VARCHAR(100) AS "受注年度名称",
        "受注半期名称"::VARCHAR(20) AS "受注半期名称",
        "受注四半期名称"::VARCHAR(100) AS "受注四半期名称",
        "受注年"::VARCHAR(16) AS "受注年",
        "受注月"::VARCHAR(8) AS "受注月",
        "受注年月日"::VARCHAR(18) AS "受注年月日",
        "出荷年度名称"::VARCHAR(100) AS "出荷年度名称",
        "出荷半期名称"::VARCHAR(20) AS "出荷半期名称",
        "出荷四半期名称"::VARCHAR(100) AS "出荷四半期名称",
        "出荷年"::VARCHAR(16) AS "出荷年",
        "出荷月"::VARCHAR(8) AS "出荷月",
        "出荷年月日"::VARCHAR(18) AS "出荷年月日",
        "受注区分コード"::VARCHAR(4) AS "受注区分コード",
        "c受注区分名"::VARCHAR(223) AS "c受注区分名",
        "返品理由コード"::VARCHAR(6) AS "返品理由コード",
        "c返品理由名"::VARCHAR(909) AS "c返品理由名",
        "cキャンセルフラグ名"::VARCHAR(19) AS "cキャンセルフラグ名",
        "取引形態区分コード"::VARCHAR(4) AS "取引形態区分コード",
        "c取引形態区分名"::VARCHAR(223) AS "c取引形態区分名",
        "決済区分コード"::VARCHAR(4) AS "決済区分コード",
        "c決済区分名"::VARCHAR(54) AS "c決済区分名",
        "c削除フラグ名"::VARCHAR(23) AS "c削除フラグ名",
        "c通信経路大区分名"::VARCHAR(60) AS "c通信経路大区分名",
        "c通信経路中区分名"::VARCHAR(60) AS "c通信経路中区分名",
        "c通信経路小区分名"::VARCHAR(60) AS "c通信経路小区分名",
        "c通信経路名"::VARCHAR(60) AS "c通信経路名",
        "購入媒体コード"::VARCHAR(10) AS "購入媒体コード",
        "c購入媒体名"::VARCHAR(394) AS "c購入媒体名",
        "受注商品大々区分コード"::VARCHAR(7) AS "受注商品大々区分コード",
        "c受注商品大々区分名"::VARCHAR(110) AS "c受注商品大々区分名",
        "受注商品大区分コード"::VARCHAR(7) AS "受注商品大区分コード",
        "c受注商品大区分名"::VARCHAR(110) AS "c受注商品大区分名",
        "受注商品中区分コード"::VARCHAR(7) AS "受注商品中区分コード",
        "c受注商品中区分名"::VARCHAR(110) AS "c受注商品中区分名",
        "受注商品コード"::VARCHAR(45) AS "受注商品コード",
        "c受注商品名"::VARCHAR(433) AS "c受注商品名",
        "受注担当者コード"::VARCHAR(48) AS "受注担当者コード",
        "c受注担当者名"::VARCHAR(73) AS "c受注担当者名",
        "受注商品su割引後税抜金額"::NUMBER(18,0) AS "受注商品su割引後税抜金額",
        "受注商品数量"::NUMBER(18,0) AS "受注商品数量",
        "消費税額"::NUMBER(18,0) AS "消費税額",
        "?column?"::NUMBER(38,0) AS "?column?",
        "顧客no"::VARCHAR(40) AS "顧客no",
        "お届希望日"::VARCHAR(18) AS "お届希望日",
        "販促dm_店舗名"::VARCHAR(12000) AS "販促dm_店舗名",
        "販促dm_cc通販その他名"::VARCHAR(12000) AS "販促dm_cc通販その他名",
        "部門1追加属性1"::VARCHAR(1) AS "部門1追加属性1",
        "部門1追加属性2"::VARCHAR(1) AS "部門1追加属性2",
        "部門1追加属性3"::VARCHAR(1) AS "部門1追加属性3",
        "部門1追加属性4"::VARCHAR(1) AS "部門1追加属性4",
        "部門1追加属性5"::VARCHAR(1) AS "部門1追加属性5",
        "部門1追加属性6"::VARCHAR(1) AS "部門1追加属性6",
        "部門1追加属性7"::VARCHAR(1) AS "部門1追加属性7",
        "部門1追加属性8"::VARCHAR(1) AS "部門1追加属性8",
        "部門1追加属性9"::VARCHAR(1) AS "部門1追加属性9",
        "部門1追加属性10"::VARCHAR(1) AS "部門1追加属性10",
        "部門2追加属性1"::VARCHAR(1) AS "部門2追加属性1",
        "部門2追加属性2"::VARCHAR(1) AS "部門2追加属性2",
        "部門2追加属性3"::VARCHAR(1) AS "部門2追加属性3",
        "部門2追加属性4"::VARCHAR(1) AS "部門2追加属性4",
        "部門2追加属性5"::VARCHAR(1) AS "部門2追加属性5",
        "部門2追加属性6"::VARCHAR(1) AS "部門2追加属性6",
        "部門2追加属性7"::VARCHAR(1) AS "部門2追加属性7",
        "部門2追加属性8"::VARCHAR(1) AS "部門2追加属性8",
        "部門2追加属性9"::VARCHAR(1) AS "部門2追加属性9",
        "部門2追加属性10"::VARCHAR(1) AS "部門2追加属性10",
        "部門3追加属性1"::VARCHAR(1) AS "部門3追加属性1",
        "部門3追加属性2"::VARCHAR(1) AS "部門3追加属性2",
        "部門3追加属性3"::VARCHAR(1) AS "部門3追加属性3",
        "部門3追加属性4"::VARCHAR(1) AS "部門3追加属性4",
        "部門3追加属性5"::VARCHAR(1) AS "部門3追加属性5",
        "部門3追加属性6"::VARCHAR(1) AS "部門3追加属性6",
        "部門3追加属性7"::VARCHAR(1) AS "部門3追加属性7",
        "部門3追加属性8"::VARCHAR(1) AS "部門3追加属性8",
        "部門3追加属性9"::VARCHAR(1) AS "部門3追加属性9",
        "部門3追加属性10"::VARCHAR(1) AS "部門3追加属性10",
        "部門4追加属性1"::VARCHAR(1) AS "部門4追加属性1",
        "部門4追加属性2"::VARCHAR(1) AS "部門4追加属性2",
        "部門4追加属性3"::VARCHAR(1) AS "部門4追加属性3",
        "部門4追加属性4"::VARCHAR(1) AS "部門4追加属性4",
        "部門4追加属性5"::VARCHAR(1) AS "部門4追加属性5",
        "部門4追加属性6"::VARCHAR(1) AS "部門4追加属性6",
        "部門4追加属性7"::VARCHAR(1) AS "部門4追加属性7",
        "部門4追加属性8"::VARCHAR(1) AS "部門4追加属性8",
        "部門4追加属性9"::VARCHAR(1) AS "部門4追加属性9",
        "部門4追加属性10"::VARCHAR(1) AS "部門4追加属性10",
        "部門5追加属性1"::VARCHAR(1) AS "部門5追加属性1",
        "部門5追加属性2"::VARCHAR(1) AS "部門5追加属性2",
        "部門5追加属性3"::VARCHAR(1) AS "部門5追加属性3",
        "部門5追加属性4"::VARCHAR(1) AS "部門5追加属性4",
        "部門5追加属性5"::VARCHAR(1) AS "部門5追加属性5",
        "部門5追加属性6"::VARCHAR(1) AS "部門5追加属性6",
        "部門5追加属性7"::VARCHAR(1) AS "部門5追加属性7",
        "部門5追加属性8"::VARCHAR(1) AS "部門5追加属性8",
        "部門5追加属性9"::VARCHAR(1) AS "部門5追加属性9",
        "部門5追加属性10"::VARCHAR(1) AS "部門5追加属性10",
        "部門6追加属性1"::VARCHAR(1) AS "部門6追加属性1",
        "部門6追加属性2"::VARCHAR(1) AS "部門6追加属性2",
        "部門6追加属性3"::VARCHAR(1) AS "部門6追加属性3",
        "部門6追加属性4"::VARCHAR(1) AS "部門6追加属性4",
        "部門6追加属性5"::VARCHAR(1) AS "部門6追加属性5",
        "部門6追加属性6"::VARCHAR(1) AS "部門6追加属性6",
        "部門6追加属性7"::VARCHAR(1) AS "部門6追加属性7",
        "部門6追加属性8"::VARCHAR(1) AS "部門6追加属性8",
        "部門6追加属性9"::VARCHAR(1) AS "部門6追加属性9",
        "部門6追加属性10"::VARCHAR(1) AS "部門6追加属性10",
        "部門6追加属性11"::VARCHAR(1) AS "部門6追加属性11",
        "部門6追加属性12"::VARCHAR(1) AS "部門6追加属性12",
        "部門6追加属性13"::VARCHAR(1) AS "部門6追加属性13",
        "部門6追加属性14"::VARCHAR(1) AS "部門6追加属性14",
        "部門6追加属性15"::VARCHAR(1) AS "部門6追加属性15",
        "部門6追加属性16"::VARCHAR(1) AS "部門6追加属性16",
        "部門6追加属性17"::VARCHAR(1) AS "部門6追加属性17",
        "部門6追加属性18"::VARCHAR(1) AS "部門6追加属性18",
        "部門6追加属性19"::VARCHAR(1) AS "部門6追加属性19",
        "部門6追加属性20"::VARCHAR(1) AS "部門6追加属性20"
  FROM transformed
)
SELECT *
FROM final