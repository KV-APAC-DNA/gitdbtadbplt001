{{
    config(
        materialized='incremental',
        incremental_strategy = 'delete+insert',
    )
}}

with dm_user_attr
as
(
    select * from  {{ ref('jpndcledw_integration__dm_user_attr') }}
),
final as 
(
    select to_char(dateadd(day,-2,current_timestamp()), 'YYYYMM')::VARCHAR(60) AS yymm,
        KOKYANO::VARCHAR(60) AS KOKYANO,
        ZIPCODE::VARCHAR(60) AS ZIPCODE,
        TODOFUKENNAME::VARCHAR(60) AS TODOFUKENNAME,
        SEIBETUKBN::VARCHAR(60) AS SEIBETUKBN,
        BIRTHDAY::VARCHAR(60) AS BIRTHDAY,
        BIRTHDAY_MD::VARCHAR(60) AS BIRTHDAY_MD,
        KOKYAKBN::VARCHAR(60) AS KOKYAKBN,
        DMTENPOFLG::VARCHAR(60) AS DMTENPOFLG,
        DMTSUHANFLG::VARCHAR(60) AS DMTSUHANFLG,
        TELTENPOFLG::VARCHAR(60) AS TELTENPOFLG,
        TELTSUHANFLG::VARCHAR(60) AS TELTSUHANFLG,
        FIRSTMEDIACODE::VARCHAR(60) AS FIRSTMEDIACODE,
        TAIKAI_FLG::VARCHAR(60) AS TAIKAI_FLG,
        WEBNO::VARCHAR(60) AS WEBNO,
        ORDER_CNT_CALL_1M::NUMBER(18,0) AS ORDER_CNT_CALL_1M,
        ORDER_AMT_CALL_1M::FLOAT AS ORDER_AMT_CALL_1M,
        POINT_USAGE_CNT_CALL_1M::NUMBER(18,0) AS POINT_USAGE_CNT_CALL_1M,
        POINT_USAGE_AMT_CALL_1M::FLOAT AS POINT_USAGE_AMT_CALL_1M,
        COUPON_USAGE_CNT_CALL_1M::NUMBER(18,0) AS COUPON_USAGE_CNT_CALL_1M,
        COUPON_USAGE_AMT_CALL_1M::FLOAT AS COUPON_USAGE_AMT_CALL_1M,
        ORDER_CNT_CALL_3M::NUMBER(18,0) AS ORDER_CNT_CALL_3M,
        ORDER_AMT_CALL_3M::FLOAT AS ORDER_AMT_CALL_3M,
        POINT_USAGE_CNT_CALL_3M::NUMBER(18,0) AS POINT_USAGE_CNT_CALL_3M,
        POINT_USAGE_AMT_CALL_3M::FLOAT AS POINT_USAGE_AMT_CALL_3M,
        COUPON_USAGE_CNT_CALL_3M::NUMBER(18,0) AS COUPON_USAGE_CNT_CALL_3M,
        COUPON_USAGE_AMT_CALL_3M::FLOAT AS COUPON_USAGE_AMT_CALL_3M,
        ORDER_CNT_CALL_6M::NUMBER(18,0) AS ORDER_CNT_CALL_6M,
        ORDER_AMT_CALL_6M::FLOAT AS ORDER_AMT_CALL_6M,
        POINT_USAGE_CNT_CALL_6M::NUMBER(18,0) AS POINT_USAGE_CNT_CALL_6M,
        POINT_USAGE_AMT_CALL_6M::FLOAT AS POINT_USAGE_AMT_CALL_6M,
        COUPON_USAGE_CNT_CALL_6M::NUMBER(18,0) AS COUPON_USAGE_CNT_CALL_6M,
        COUPON_USAGE_AMT_CALL_6M::FLOAT AS COUPON_USAGE_AMT_CALL_6M,
        ORDER_CNT_CALL_1Y::NUMBER(18,0) AS ORDER_CNT_CALL_1Y,
        ORDER_AMT_CALL_1Y::FLOAT AS ORDER_AMT_CALL_1Y,
        POINT_USAGE_CNT_CALL_1Y::NUMBER(18,0) AS POINT_USAGE_CNT_CALL_1Y,
        POINT_USAGE_AMT_CALL_1Y::FLOAT AS POINT_USAGE_AMT_CALL_1Y,
        COUPON_USAGE_CNT_CALL_1Y::NUMBER(18,0) AS COUPON_USAGE_CNT_CALL_1Y,
        COUPON_USAGE_AMT_CALL_1Y::FLOAT AS COUPON_USAGE_AMT_CALL_1Y,
        ORDER_CNT_CALL_2Y::NUMBER(18,0) AS ORDER_CNT_CALL_2Y,
        ORDER_AMT_CALL_2Y::FLOAT AS ORDER_AMT_CALL_2Y,
        POINT_USAGE_CNT_CALL_2Y::NUMBER(18,0) AS POINT_USAGE_CNT_CALL_2Y,
        POINT_USAGE_AMT_CALL_2Y::FLOAT AS POINT_USAGE_AMT_CALL_2Y,
        COUPON_USAGE_CNT_CALL_2Y::NUMBER(18,0) AS COUPON_USAGE_CNT_CALL_2Y,
        COUPON_USAGE_AMT_CALL_2Y::FLOAT AS COUPON_USAGE_AMT_CALL_2Y,
        ORDER_CNT_CALL::NUMBER(18,0) AS ORDER_CNT_CALL,
        ORDER_AMT_CALL::FLOAT AS ORDER_AMT_CALL,
        POINT_USAGE_CNT_CALL::NUMBER(18,0) AS POINT_USAGE_CNT_CALL,
        POINT_USAGE_AMT_CALL::FLOAT AS POINT_USAGE_AMT_CALL,
        COUPON_USAGE_CNT_CALL::NUMBER(18,0) AS COUPON_USAGE_CNT_CALL,
        COUPON_USAGE_AMT_CALL::FLOAT AS COUPON_USAGE_AMT_CALL,
        ORDER_CNT_WEB_1M::NUMBER(18,0) AS ORDER_CNT_WEB_1M,
        ORDER_AMT_WEB_1M::FLOAT AS ORDER_AMT_WEB_1M,
        POINT_USAGE_CNT_WEB_1M::NUMBER(18,0) AS POINT_USAGE_CNT_WEB_1M,
        POINT_USAGE_AMT_WEB_1M::FLOAT AS POINT_USAGE_AMT_WEB_1M,
        COUPON_USAGE_CNT_WEB_1M::NUMBER(18,0) AS COUPON_USAGE_CNT_WEB_1M,
        COUPON_USAGE_AMT_WEB_1M::FLOAT AS COUPON_USAGE_AMT_WEB_1M,
        ORDER_CNT_WEB_3M::NUMBER(18,0) AS ORDER_CNT_WEB_3M,
        ORDER_AMT_WEB_3M::FLOAT AS ORDER_AMT_WEB_3M,
        POINT_USAGE_CNT_WEB_3M::NUMBER(18,0) AS POINT_USAGE_CNT_WEB_3M,
        POINT_USAGE_AMT_WEB_3M::FLOAT AS POINT_USAGE_AMT_WEB_3M,
        COUPON_USAGE_CNT_WEB_3M::NUMBER(18,0) AS COUPON_USAGE_CNT_WEB_3M,
        COUPON_USAGE_AMT_WEB_3M::FLOAT AS COUPON_USAGE_AMT_WEB_3M,
        ORDER_CNT_WEB_6M::NUMBER(18,0) AS ORDER_CNT_WEB_6M,
        ORDER_AMT_WEB_6M::FLOAT AS ORDER_AMT_WEB_6M,
        POINT_USAGE_CNT_WEB_6M::NUMBER(18,0) AS POINT_USAGE_CNT_WEB_6M,
        POINT_USAGE_AMT_WEB_6M::FLOAT AS POINT_USAGE_AMT_WEB_6M,
        COUPON_USAGE_CNT_WEB_6M::NUMBER(18,0) AS COUPON_USAGE_CNT_WEB_6M,
        COUPON_USAGE_AMT_WEB_6M::FLOAT AS COUPON_USAGE_AMT_WEB_6M,
        ORDER_CNT_WEB_1Y::NUMBER(18,0) AS ORDER_CNT_WEB_1Y,
        ORDER_AMT_WEB_1Y::FLOAT AS ORDER_AMT_WEB_1Y,
        POINT_USAGE_CNT_WEB_1Y::NUMBER(18,0) AS POINT_USAGE_CNT_WEB_1Y,
        POINT_USAGE_AMT_WEB_1Y::FLOAT AS POINT_USAGE_AMT_WEB_1Y,
        COUPON_USAGE_CNT_WEB_1Y::NUMBER(18,0) AS COUPON_USAGE_CNT_WEB_1Y,
        COUPON_USAGE_AMT_WEB_1Y::FLOAT AS COUPON_USAGE_AMT_WEB_1Y,
        ORDER_CNT_WEB_2Y::NUMBER(18,0) AS ORDER_CNT_WEB_2Y,
        ORDER_AMT_WEB_2Y::FLOAT AS ORDER_AMT_WEB_2Y,
        POINT_USAGE_CNT_WEB_2Y::NUMBER(18,0) AS POINT_USAGE_CNT_WEB_2Y,
        POINT_USAGE_AMT_WEB_2Y::FLOAT AS POINT_USAGE_AMT_WEB_2Y,
        COUPON_USAGE_CNT_WEB_2Y::NUMBER(18,0) AS COUPON_USAGE_CNT_WEB_2Y,
        COUPON_USAGE_AMT_WEB_2Y::FLOAT AS COUPON_USAGE_AMT_WEB_2Y,
        ORDER_CNT_WEB::NUMBER(18,0) AS ORDER_CNT_WEB,
        ORDER_AMT_WEB::FLOAT AS ORDER_AMT_WEB,
        POINT_USAGE_CNT_WEB::NUMBER(18,0) AS POINT_USAGE_CNT_WEB,
        POINT_USAGE_AMT_WEB::FLOAT AS POINT_USAGE_AMT_WEB,
        COUPON_USAGE_CNT_WEB::NUMBER(18,0) AS COUPON_USAGE_CNT_WEB,
        COUPON_USAGE_AMT_WEB::FLOAT AS COUPON_USAGE_AMT_WEB,
        ORDER_CNT_STORE_1M::NUMBER(18,0) AS ORDER_CNT_STORE_1M,
        ORDER_AMT_STORE_1M::FLOAT AS ORDER_AMT_STORE_1M,
        POINT_USAGE_CNT_STORE_1M::NUMBER(18,0) AS POINT_USAGE_CNT_STORE_1M,
        POINT_USAGE_AMT_STORE_1M::FLOAT AS POINT_USAGE_AMT_STORE_1M,
        COUPON_USAGE_CNT_STORE_1M::NUMBER(18,0) AS COUPON_USAGE_CNT_STORE_1M,
        COUPON_USAGE_AMT_STORE_1M::FLOAT AS COUPON_USAGE_AMT_STORE_1M,
        ORDER_CNT_STORE_3M::NUMBER(18,0) AS ORDER_CNT_STORE_3M,
        ORDER_AMT_STORE_3M::FLOAT AS ORDER_AMT_STORE_3M,
        POINT_USAGE_CNT_STORE_3M::NUMBER(18,0) AS POINT_USAGE_CNT_STORE_3M,
        POINT_USAGE_AMT_STORE_3M::FLOAT AS POINT_USAGE_AMT_STORE_3M,
        COUPON_USAGE_CNT_STORE_3M::NUMBER(18,0) AS COUPON_USAGE_CNT_STORE_3M,
        COUPON_USAGE_AMT_STORE_3M::FLOAT AS COUPON_USAGE_AMT_STORE_3M,
        ORDER_CNT_STORE_6M::NUMBER(18,0) AS ORDER_CNT_STORE_6M,
        ORDER_AMT_STORE_6M::FLOAT AS ORDER_AMT_STORE_6M,
        POINT_USAGE_CNT_STORE_6M::NUMBER(18,0) AS POINT_USAGE_CNT_STORE_6M,
        POINT_USAGE_AMT_STORE_6M::FLOAT AS POINT_USAGE_AMT_STORE_6M,
        COUPON_USAGE_CNT_STORE_6M::NUMBER(18,0) AS COUPON_USAGE_CNT_STORE_6M,
        COUPON_USAGE_AMT_STORE_6M::FLOAT AS COUPON_USAGE_AMT_STORE_6M,
        ORDER_CNT_STORE_1Y::NUMBER(18,0) AS ORDER_CNT_STORE_1Y,
        ORDER_AMT_STORE_1Y::FLOAT AS ORDER_AMT_STORE_1Y,
        POINT_USAGE_CNT_STORE_1Y::NUMBER(18,0) AS POINT_USAGE_CNT_STORE_1Y,
        POINT_USAGE_AMT_STORE_1Y::FLOAT AS POINT_USAGE_AMT_STORE_1Y,
        COUPON_USAGE_CNT_STORE_1Y::NUMBER(18,0) AS COUPON_USAGE_CNT_STORE_1Y,
        COUPON_USAGE_AMT_STORE_1Y::FLOAT AS COUPON_USAGE_AMT_STORE_1Y,
        ORDER_CNT_STORE_2Y::NUMBER(18,0) AS ORDER_CNT_STORE_2Y,
        ORDER_AMT_STORE_2Y::FLOAT AS ORDER_AMT_STORE_2Y,
        POINT_USAGE_CNT_STORE_2Y::NUMBER(18,0) AS POINT_USAGE_CNT_STORE_2Y,
        POINT_USAGE_AMT_STORE_2Y::FLOAT AS POINT_USAGE_AMT_STORE_2Y,
        COUPON_USAGE_CNT_STORE_2Y::NUMBER(18,0) AS COUPON_USAGE_CNT_STORE_2Y,
        COUPON_USAGE_AMT_STORE_2Y::FLOAT AS COUPON_USAGE_AMT_STORE_2Y,
        ORDER_CNT_STORE::NUMBER(18,0) AS ORDER_CNT_STORE,
        ORDER_AMT_STORE::FLOAT AS ORDER_AMT_STORE,
        POINT_USAGE_CNT_STORE::NUMBER(18,0) AS POINT_USAGE_CNT_STORE,
        POINT_USAGE_AMT_STORE::FLOAT AS POINT_USAGE_AMT_STORE,
        COUPON_USAGE_CNT_STORE::NUMBER(18,0) AS COUPON_USAGE_CNT_STORE,
        COUPON_USAGE_AMT_STORE::FLOAT AS COUPON_USAGE_AMT_STORE,
        LTV_ORDER_CNT_CALL::NUMBER(18,0) AS LTV_ORDER_CNT_CALL,
        LTV_ORDER_CNT_WEB::NUMBER(18,0) AS LTV_ORDER_CNT_WEB,
        LTV_ORDER_CNT_STORE::NUMBER(18,0) AS LTV_ORDER_CNT_STORE,
        I_ORDER_DT::DATE AS I_ORDER_DT,
        L_ORDER_DT::DATE AS L_ORDER_DT,
        I_CHANNEL::VARCHAR(60) AS I_CHANNEL,
        L_CHANNEL::VARCHAR(60) AS L_CHANNEL,
        LBAG_REACTION_CNT::NUMBER(18,0) AS LBAG_REACTION_CNT,
        I_LBAG_ORDER_DT::DATE AS I_LBAG_ORDER_DT,
        L_LBAG_ORDER_DT::DATE AS L_LBAG_ORDER_DT,
        OUTLET_REACTION_CNT::NUMBER(18,0) AS OUTLET_REACTION_CNT,
        I_OUTLET_ORDER_DT::DATE AS I_OUTLET_ORDER_DT,
        L_OUTLET_ORDER_DT::DATE AS L_OUTLET_ORDER_DT,
        COUPON_USAGE_RATIO::FLOAT AS COUPON_USAGE_RATIO,
        COUPON_USAGE_AMT_AVERAGE::FLOAT AS COUPON_USAGE_AMT_AVERAGE,
        I_COUPON_USAGE_DT::DATE AS I_COUPON_USAGE_DT,
        L_COUPON_USAGE_DT::DATE AS L_COUPON_USAGE_DT,
        POINT_USAGE_RATIO::FLOAT AS POINT_USAGE_RATIO,
        TRADEUP_DATE_VC100::DATE AS TRADEUP_DATE_VC100,
        TRADEDOWN_DATE_VC100::DATE AS TRADEDOWN_DATE_VC100,
        STANDARD_NEW_DATE_VC100::DATE AS STANDARD_NEW_DATE_VC100,
        PREMIUM_NEW_DATE_VC100::DATE AS PREMIUM_NEW_DATE_VC100,
        TRADE_FLAG_VC100::VARCHAR(60) AS TRADE_FLAG_VC100,
        TRADEUP_DATE_AID::DATE AS TRADEUP_DATE_AID,
        TRADEDOWN_DATE_AID::DATE AS TRADEDOWN_DATE_AID,
        STANDARD_NEW_DATE_AID::DATE AS STANDARD_NEW_DATE_AID,
        PREMIUM_NEW_DATE_AID::DATE AS PREMIUM_NEW_DATE_AID,
        TRADE_FLAG_AID::VARCHAR(60) AS TRADE_FLAG_AID,
        TRADEUP_DATE_ACGEL::DATE AS TRADEUP_DATE_ACGEL,
        TRADEDOWN_DATE_ACGEL::DATE AS TRADEDOWN_DATE_ACGEL,
        STANDARD_NEW_DATE_ACGEL::DATE AS STANDARD_NEW_DATE_ACGEL,
        PREMIUM_NEW_DATE_ACGEL::DATE AS PREMIUM_NEW_DATE_ACGEL,
        TRADE_FLAG_ACGEL::VARCHAR(60) AS TRADE_FLAG_ACGEL,
        I_ORDER_DT_INC_SAMPLE::DATE AS I_ORDER_DT_INC_SAMPLE,
        L_ORDER_DT_WEB::DATE AS L_ORDER_DT_WEB,
        L_ORDER_DT_CALL::DATE AS L_ORDER_DT_CALL,
        L_ORDER_DT_STORE::DATE AS L_ORDER_DT_STORE,
        REGISTER_DT::NUMBER(18,0) AS REGISTER_DT,
        BIKEN_FLG::NUMBER(18,0) AS BIKEN_FLG,
        REGISTER_CARD_FLG::NUMBER(18,0) AS REGISTER_CARD_FLG,
        OTHER_ADV_FLG::NUMBER(18,0) AS OTHER_ADV_FLG,
        MAIN_STORE::VARCHAR(60) AS MAIN_STORE,
        FAMILYSALE_CLASS::NUMBER(18,0) AS FAMILYSALE_CLASS,
        MAIN_CHANNEL_BDDM::VARCHAR(60) AS MAIN_CHANNEL_BDDM,
        PROMO_STAGE::VARCHAR(18) AS PROMO_STAGE,
        NEXT_PROMO_STAGE_AMT::NUMBER(18,0) AS NEXT_PROMO_STAGE_AMT,
        NEXT_PROMO_STAGE_POINT::NUMBER(18,0) AS NEXT_PROMO_STAGE_POINT,
        POINT_TOBE_GRANTED::NUMBER(18,0) AS POINT_TOBE_GRANTED,
        STAGE::VARCHAR(18) AS STAGE,
        STAGE_MONTHLY::VARCHAR(18) AS STAGE_MONTHLY,
        TOTALPRC_THIS_YEAR::NUMBER(38,0) AS TOTALPRC_THIS_YEAR,
        EXPIRED_POINT_THIS_MONTH::NUMBER(38,0) AS EXPIRED_POINT_THIS_MONTH,
        EXPIRED_POINT_NEXT_MONTH::NUMBER(38,0) AS EXPIRED_POINT_NEXT_MONTH,
        OUTCALL_EXC_FLG::VARCHAR(1) AS OUTCALL_EXC_FLG,
        OUTCALL_HIST_FLG_3M::VARCHAR(1) AS OUTCALL_HIST_FLG_3M,
        SUBSCRIPTION_FLG::VARCHAR(1) AS SUBSCRIPTION_FLG,
        ECPROPENSITY::VARCHAR(60) AS ECPROPENSITY,
        CCPROPENSITY::VARCHAR(60) AS CCPROPENSITY,
        ACGELPROPENSITY::VARCHAR(60) AS ACGELPROPENSITY,
        VC100PROPENSITY::VARCHAR(60) AS VC100PROPENSITY,
        CLUSTER5_CD::NUMBER(18,0) AS CLUSTER5_CD,
        CLUSTER5_NM::VARCHAR(300) AS CLUSTER5_NM,
        ORDER_AMT_CALL_1Y_TERM_START::FLOAT AS ORDER_AMT_CALL_1Y_TERM_START,
        ORDER_AMT_WEB_1Y_TERM_START::FLOAT AS ORDER_AMT_WEB_1Y_TERM_START,
        ORDER_AMT_STORE_1Y_TERM_START::FLOAT AS ORDER_AMT_STORE_1Y_TERM_START,
        ORDER_CNT_CALL_THIS_YEAR::NUMBER(18,0) AS ORDER_CNT_CALL_THIS_YEAR,
        ORDER_CNT_WEB_THIS_YEAR::NUMBER(18,0) AS ORDER_CNT_WEB_THIS_YEAR,
        ORDER_CNT_STORE_THIS_YEAR::NUMBER(18,0) AS ORDER_CNT_STORE_THIS_YEAR,
        ORDER_SKU_CNT_1Y::NUMBER(18,0) AS ORDER_SKU_CNT_1Y,
        ORDER_SKU_CNT_1Y_TERM_START::NUMBER(18,0) AS ORDER_SKU_CNT_1Y_TERM_START,
        ORDER_CNT_CALL_EXC_SUB_1Y::NUMBER(18,0) AS ORDER_CNT_CALL_EXC_SUB_1Y,
        ORDER_CNT_WEB_EXC_SUB_1Y::NUMBER(18,0) AS ORDER_CNT_WEB_EXC_SUB_1Y,
        ORDER_CNT_STORE_EXC_SUB_1Y::NUMBER(18,0) AS ORDER_CNT_STORE_EXC_SUB_1Y
    from dm_user_attr
)
select * from final

