{{
    config(
        materialized='view'
    )
}}

--Final CTE
with final as 
  (SELECT hashkey,
       hash_row,
       dataset,
       customerid,
       salespersonid,
       visitid,
       questiontext,
       productid,
       kpi,
       scheduleddate,
       latestdate,
       fisc_yr,
       fisc_per,
       merchandiser_name,
       customername,
       country,
       state,
       parent_customer,
       retail_environment,
       channel,
       retailer,
       business_unit,
       eannumber,
       matl_num,
       prod_hier_l1,
       prod_hier_l2,
       prod_hier_l3,
       prod_hier_l4,
       prod_hier_l5,
       prod_hier_l6,
       prod_hier_l7,
       prod_hier_l8,
       prod_hier_l9,
       ques_type,
       y_n_flag,
       priority_store_flag,
       add_info,
       response,
       response_score,
       kpi_chnl_wt,
       channel_weightage,
       weight_msl,
       weight_oos,
       weight_soa,
       weight_sos,
       weight_promo,
       weight_planogram,
       weight_display,
       mkt_share,
       salience_val,
       actual_value,
       ref_value,
	   KPI_ACTUAL_WT_VAL,
	   KPI_REF_VAL,
	   KPI_REF_WT_VAL,
	   PHOTO_URL,
       STORE_GRADE
	   --gcph_category,
  --gcph_subcategory
FROM  {{ ref('EDW_PERFECT_STORE_KPI_DATA') }} 
union all
SELECT hashkey,
       hash_row,
       dataset,
       customerid,
       salespersonid,
       visitid,
       questiontext,
       productid,
       kpi,
       scheduleddate,
       latestdate,
       fisc_yr,
       fisc_per,
       merchandiser_name,
       customername,
       country,
       state,
       parent_customer,
       retail_environment,
       channel,
       retailer,
       business_unit,
       eannumber,
       matl_num,
       prod_hier_l1,
       prod_hier_l2,
       prod_hier_l3,
       prod_hier_l4,
       prod_hier_l5,
       prod_hier_l6,
       prod_hier_l7,
       prod_hier_l8,
       prod_hier_l9,
       ques_type,
       y_n_flag,
       priority_store_flag,
       add_info,
       response,
       response_score,
       kpi_chnl_wt,
       channel_weightage,
       weight_msl,
       weight_oos,
       weight_soa,
       weight_sos,
       weight_promo,
       weight_planogram,
       weight_display,
       mkt_share,
       salience_val,
       actual_value,
       ref_value,
	   KPI_ACTUAL_WT_VAL,
	   KPI_REF_VAL,
	   KPI_REF_WT_VAL,
	   PHOTO_URL,
       STORE_GRADE

  from  {{ ref('EDW_PERFECT_STORE_REBASE_WT_agg') }}
)

SELECT * 
  FROM final