with source as (
    select * from {{ source('bwa_access', 'bwa_weekly_forecast') }}
),
final as (
    select
        coalesce(calmonth,'') as calmonth,
        coalesce(calquart1,'') as calquart1,
        coalesce(calweek,'') as calweek,
        coalesce(calyear,'') as calyear,
        coalesce(fiscvarnt,'') as fiscvarnt,
        coalesce(fiscper,'') as fiscper,
        coalesce(fiscper3,'') as fiscper3,
        coalesce(salesorg,'') as salesorg,
        coalesce(comp_code,'') as co_cd,
        coalesce(distr_chan,'') as distr_chan,
        coalesce(mat_plant,'') as mat_plant,
        coalesce(version,'') as version,
        coalesce(vtype,'') as vtype,
        coalesce(bic_zjjfiscwe,'') as jnj_fiscal_week,
        coalesce(base_uom,'') as base_uom,
        coalesce(doc_currcy,'') as doc_currcy,
        coalesce(bic_zsnapdy,'') as snap_dt,
        coalesce(bic_zsnapwk,'') as snap_wk,
        coalesce(bic_zfisc_ywk,'') as jnj_fiscal_yr,
        coalesce(plant,'') as plant,
        coalesce(prodh6,'') as prod_mnr,
        coalesce(prodh1,'') as opr_grp,
        coalesce(prodh2,'') as fran_grp,
        coalesce(prodh3,'') as franchise,
        coalesce(prodh4,'') as prod_fran,
        coalesce(prodh5,'') as prod_mjr,
        coalesce(bic_zz_mvgr4,'') as b1_mega_brnd,
        coalesce(bic_zz_mvgr5,'') as b2_brnd,
        coalesce(bic_zz_mvgr1,'') as b3_base_prod,
        coalesce(bic_zz_mvgr2,'') as b4_variant,
        coalesce(bic_zz_mvgr3,'') as b5_put_up,
        coalesce(material,'') as material,
        coalesce(bic_zmercref,'') as mercia_reference,
        coalesce(mat_sales,'') as mat_sales,
        coalesce(bic_zsnapper1,'') as snap_per,
        coalesce(fiscyear,'') as fiscyear,
        iff(right(bic_zablcma,1)='-',concat('-',replace(bic_zablcma,'-','')),bic_zablcma) as ablcma,
        iff(right(bic_zbasefc,1)='-',concat('-',replace(bic_zbasefc,'-','')),bic_zbasefc) as base_fc,
        iff(right(bic_zcnblefct,1)='-',concat('-',replace(bic_zcnblefct,'-','')),bic_zcnblefct) as cnblefct,
        iff(right(bic_zconfstv,1)='-',concat('-',replace(bic_zconfstv,'-','')),bic_zconfstv) as tot_for_val,
        iff(right(bic_zcorhissh,1)='-',concat('-',replace(bic_zcorhissh,'-','')),bic_zcorhissh) as cor_dmd_hist,
        iff(right(bic_zcpfrfcst,1)='-',concat('-',replace(bic_zcpfrfcst,'-','')),bic_zcpfrfcst) as cpfr_fcst,
        iff(right(bic_zhisdep,1)='-',concat('-',replace(bic_zhisdep,'-','')),bic_zhisdep) as dpndnt_his,
        iff(right(bic_zhisinput,1)='-',concat('-',replace(bic_zhisinput,'-','')),bic_zhisinput) as dmd_his,
        iff(right(bic_zhisshfi,1)='-',concat('-',replace(bic_zhisshfi,'-','')),bic_zhisshfi) as his_ship,
        iff(right(bic_zmape001,1)='-',concat('-',replace(bic_zmape001,'-','')),bic_zmape001) as mape001,
        iff(right(bic_zmape002,1)='-',concat('-',replace(bic_zmape002,'-','')),bic_zmape002) as mape002,
        iff(right(bic_zmape003,1)='-',concat('-',replace(bic_zmape003,'-','')),bic_zmape003) as mape003,
        iff(right(bic_zmape004,1)='-',concat('-',replace(bic_zmape004,'-','')),bic_zmape004) as mape004,
        iff(right(bic_zmape005,1)='-',concat('-',replace(bic_zmape005,'-','')),bic_zmape005) as mape005,
        iff(right(bic_znonafcst,1)='-',concat('-',replace(bic_znonafcst,'-','')),bic_znonafcst) as non_af_fcst,
        iff(right(bic_zothmisi,1)='-',concat('-',replace(bic_zothmisi,'-','')),bic_zothmisi) as othmisi,
        iff(right(bic_zpcvoli,1)='-',concat('-',replace(bic_zpcvoli,'-','')),bic_zpcvoli) as price_chng,
        iff(right(bic_zprmtra,1)='-',concat('-',replace(bic_zprmtra,'-','')),bic_zprmtra) as promo,
        iff(right(bic_zprohbdf,1)='-',concat('-',replace(bic_zprohbdf,'-','')),bic_zprohbdf) as fin_prop_fct,
        iff(right(bic_zprotbdf,1)='-',concat('-',replace(bic_zprotbdf,'-','')),bic_zprotbdf) as fin_prop_fac_tbd,
        iff(right(bic_zprptbd,1)='-',concat('-',replace(bic_zprptbd,'-','')),bic_zprptbd) as prop_fact_tbd,
        iff(right(bic_zsafrfcst,1)='-',concat('-',replace(bic_zsafrfcst,'-','')),bic_zsafrfcst) as sam_free_fct,
        iff(right(bic_ztevents,1)='-',concat('-',replace(bic_ztevents,'-','')),bic_ztevents) as tot_mk_sls_events,
        iff(right(bic_ztotbenfc,1)='-',concat('-',replace(bic_ztotbenfc,'-','')),bic_ztotbenfc) as tot_forecast,
        iff(right(bic_ztotbsfc,1)='-',concat('-',replace(bic_ztotbsfc,'-','')),bic_ztotbsfc) as tot_bas_fct,
        iff(right(bic_ztotnetfc,1)='-',concat('-',replace(bic_ztotnetfc,'-','')),bic_ztotnetfc) as net_fct,
        iff(right(bic_ztrdinvc,1)='-',concat('-',replace(bic_ztrdinvc,'-','')),bic_ztrdinvc) as trd_invc,
        iff(right(bic_zunpbpt,1)='-',concat('-',replace(bic_zunpbpt,'-','')),bic_zunpbpt) as unit_prc_sku,
        iff(right(bic_z_aux02,1)='-',concat('-',replace(bic_z_aux02,'-','')),bic_z_aux02) as aux02,
        iff(right(bic_zadpdant,1)='-',concat('-',replace(bic_zadpdant,'-','')),bic_zadpdant) as prop_fact,
        iff(right(bic_zadpdantf,1)='-',concat('-',replace(bic_zadpdantf,'-','')),bic_zadpdantf) as fix_prop_fact,
        iff(right(bic_zhissofi,1)='-',concat('-',replace(bic_zhissofi,'-','')),bic_zhissofi) as his_sal_ord,
        iff(right(bic_zkapoch,1)='-',concat('-',replace(bic_zkapoch,'-','')),bic_zkapoch) as apo_cor_hist,
        iff(right(bic_zprddisc,1)='-',concat('-',replace(bic_zprddisc,'-','')),bic_zprddisc) as prd_disc,
        iff(right(bic_zkcdhy02,1)='-',concat('-',replace(bic_zkcdhy02,'-','')),bic_zkcdhy02) as final_stat_fc,
        iff(right(bic_zsncfcst,1)='-',concat('-',replace(bic_zsncfcst,'-','')),bic_zsncfcst) as sncfcst,
        iff(right(bic_ztotnoafc,1)='-',concat('-',replace(bic_ztotnoafc,'-','')),bic_ztotnoafc) as totnoafc,
        current_timestamp()::timestamp_ntz(9) as create_dt,
        trim(split(file_name,'/')[array_size(split(file_name,'/'))-1],'"') as file_name
    from source
    where _deleted_='F'
)
select * from final