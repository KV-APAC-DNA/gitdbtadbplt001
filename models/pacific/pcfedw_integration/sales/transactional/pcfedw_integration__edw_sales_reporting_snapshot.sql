with vw_sales_reporting as(
    select * from dev_dna_core.snappcfedw_integration.vw_sales_reporting
),
edw_time_dim as(
    select * from {{ source('pcfedw_integration', 'edw_time_dim') }} 
),
transformed as (
    select 
        current_date() as snap_shot_dt,
        snap_shot_mnth,
        snap_shot_year,
        pac_source_type,
        pac_subsource_type,
        jj_period,
        jj_wk,
        jj_mnth,
        jj_mnth_shrt,
        jj_mnth_long,
        jj_qrtr,
        jj_year,
        jj_mnth_tot,
        prcnt_elpsd,
        elpsd_jj_period,
        cust_no,
        cmp_id,
        channel_cd,
        channel_desc,
        ctry_key,
        country,
        state_cd,
        post_cd,
        cust_suburb,
        cust_nm,
        sales_office_cd,
        sales_office_desc,
        sales_grp_cd,
        sales_grp_desc,
        mercia_ref,
        pln_cnnl_cd,
        pln_chnl_desc,
        cust_curr_cd,
        matl_id,
        matl_desc,
        master_code,
        parent_matl_id,
        parent_matl_desc,
        mega_brnd_cd,
        mega_brnd_desc,
        brnd_cd,
        brnd_desc,
        base_prod_cd,
        base_prod_desc,
        variant_cd,
        variant_desc,
        fran_cd,
        fran_desc,
        grp_fran_cd,
        grp_fran_desc,
        matl_type_cd,
        matl_type_desc,
        prod_fran_cd,
        prod_fran_desc,
        prod_hier_cd,
        prod_hier_desc,
        prod_mjr_cd,
        prod_mjr_desc,
        prod_mnr_cd,
        prod_mnr_desc,
        mercia_plan,
        putup_cd,
        putup_desc,
        bar_cd,
        prft_ctr,
        divest_flag,
        key_measure,
        ciw_ctgry,
        ciw_accnt_grp,
        px_gl_trans_desc,
        px_measure,
        px_bucket,
        sap_accnt,
        sap_accnt_desc,
        local_curr_cd,
        to_ccy,
        exch_rate,
        base_measure,
        sales_qty,
        gts,
        gts_less_rtrn,
        eff_val,
        jgf_si_val,
        pmt_terms_val,
        datains_val,
        exp_adj_val,
        jgf_sd_val,
        nts_val,
        tot_ciw_val,
        posted_cogs,
        posted_con_free_goods_val,
        posted_gp,
        cogs,
        gp,
        futr_sls_qty,
        futr_gts,
        futr_ts,
        futr_nts,
        px_qty,
        px_gts,
        px_gts_less_rtrn,
        px_eff_val,
        px_jgf_si_val,
        px_pmt_terms_val,
        px_datains_val,
        px_exp_adj_val,
        px_jgf_sd_val,
        px_nts,
        px_ciw_tot,
        px_cogs,
        px_gp,
        projected_qty,
        projected_gts_less_rtrn,
        projected_eff_val,
        projected_jgf_si_val,
        projected_pmt_terms_val,
        projected_datains_val,
        projected_exp_adj_val,
        projected_jgf_sd_val,
        projected_ciw_tot,
        projected_nts,
        projected_cogs_current,
        projected_gp_current,
        projected_cogs_actual,
        projected_gp_actual,
        goal_qty,
        goal_gts,
        goal_eff_val,
        goal_jgf_si_val,
        goal_pmt_terms_val,
        goal_datains_val,
        goal_exp_adj_val,
        goal_jgf_sd_val,
        goal_ciw_tot,
        goal_nts,
        goal_cogs,
        goal_gp,
        bp_qty,
        bp_gts,
        bp_eff_val,
        bp_jgf_si_val,
        bp_pmt_terms_val,
        bp_datains_val,
        bp_exp_adj_val,
        bp_jgf_sd_val,
        bp_ciw_tot,
        bp_nts,
        bp_cogs,
        bp_gp,
        ju_qty,
        ju_gts,
        ju_eff_val,
        ju_jgf_si_val,
        ju_pmt_terms_val,
        ju_datains_val,
        ju_exp_adj_val,
        ju_jgf_sd_val,
        ju_ciw_tot,
        ju_nts,
        ju_cogs,
        ju_gp,
        nu_qty,
        nu_gts,
        nu_eff_val,
        nu_jgf_si_val,
        nu_pmt_terms_val,
        nu_datains_val,
        nu_exp_adj_val,
        nu_jgf_sd_val,
        nu_ciw_tot,
        nu_nts,
        nu_cogs,
        nu_gp,
        bme_trans,
        incr_gts,
        px_case_qty,
        px_tot_planspend,
        px_tot_paid,
        px_committed_spend,
        finance_cogs,
        gcph_franchise, 
        gcph_brand,  
        gcph_subbrand,    
        gcph_variant,     
        gcph_needstate,   
        gcph_category,    
        gcph_subcategory, 
        gcph_segment,     
        gcph_subsegment
    from vw_sales_reporting, 
(

    select 
        cal_date as cal_date,
        jj_mnth_id as snap_shot_mnth,
        jj_year as snap_shot_year,
        jj_year - 1 as snap_shot_prior_year
    from edw_time_dim 

)


where snap_shot_dt::date = cal_date::date
and jj_year in (snap_shot_year, snap_shot_prior_year)
)
select * from transformed