version: 2

sources:
  - name: phlsdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: snaposesdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_mds_ph_ps_weights
      tags: ["ph_mds_itg_refresh","ingestion"]
      tests:
          - test_null:
              select_columns: ["re_id", "kpi", "channel"]
              not_null_columns: ["kpi"]
              name: TRATBL_sdl_mds_ph_ps_weights__null_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_duplicate:
              select_columns: ["re_id", "kpi", "channel"]
              group_by_columns: ["re_id", "kpi", "channel","valid_from","valid_to"]
              name: TRATBL_sdl_mds_ph_ps_weights__duplicate_test
              config:
                store_failures: true
                schema: phlwks_integration
    - name: sdl_mds_ph_msl_hdr
      tags: ["ph_mds_itg_refresh","ingestion"]
      tests:
          - test_null:
              select_columns: ["code", "to_salescycle", "fr_salescycle"]
              not_null_columns: ["to_salescycle", "fr_salescycle"]
              name: TRATBL_sdl_mds_ph_msl_hdr__null_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_duplicate:
              select_columns: ["code", "to_salescycle", "fr_salescycle"]
              group_by_columns: ["code", "to_salescycle", "fr_salescycle"]
              name: TRATBL_sdl_mds_ph_msl_hdr__duplicate_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_format:
              select_columns: ["code", "to_salescycle", "fr_salescycle"]
              where_clause: "not regexp_like (trim(fr_salescycle),'[0-2][0-9][0-9][0-9][0-1][0-9]')"
              failure_reason: "'Invalid Format for From_salescycle :Expect format is YYYYMM'"
              name: TRATBL_sdl_mds_ph_msl_hdr__format_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_format:
              select_columns: ["code", "to_salescycle", "fr_salescycle"]
              where_clause: "not regexp_like (trim(to_salescycle),'[0-2][0-9][0-9][0-9][0-1][0-9]')"
              failure_reason: "'Invalid Format for To_salescycle :Expect format is YYYYMM'"
              name: TRATBL_sdl_mds_ph_msl_hdr__format_test2
              config:
                store_failures: true
                schema: phlwks_integration
    - name: sdl_mds_ph_msl_dtls
      tags: ["ph_mds_itg_refresh","ingestion"]
      tests:
          - test_null:
              select_columns: ["msl_hdr_code_code", "sku_code"]
              not_null_columns: ["msl_hdr_code_code", "sku_code"]
              name: TRATBL_sdl_mds_ph_msl_dtls__null_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_duplicate:
              select_columns: ["msl_hdr_code_code", "sku_code"]
              group_by_columns: ["msl_hdr_code_code", "sku_code"]
              name: TRATBL_sdl_mds_ph_msl_dtls__duplicate_test
              config:
                store_failures: true
                schema: phlwks_integration
    - name: sdl_mds_ph_ps_targets
      tags: ["ph_mds_itg_refresh","ingestion"]
      tests:
          - test_null:
              select_columns: ["kpi", "channel", "RE", "attribute_1", "attribute_2", "value"]
              not_null_columns: ["kpi"]
              name: TRATBL_sdl_mds_ph_ps_targets__null_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_duplicate:
              select_columns: ["kpi", "channel", "RE", "attribute_1", "attribute_2", "value"]
              group_by_columns: ["channel", "RE", "attribute_1", "attribute_2", "value"]
              name: TRATBL_sdl_mds_ph_ps_targets__duplicate_test
              config:
                store_failures: true
                schema: phlwks_integration
    - name: sdl_mds_ph_distributor_supervisors
      tags: ["ph_mds_itg_refresh", "ingestion"]
      tests:
          - test_null:
              select_columns: ["code"]
              not_null_columns: ["code"]
              name: TRATBL_sdl_mds_ph_distributor_supervisors__null_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_duplicate:
              select_columns: ["code"]
              group_by_columns: ["code"]
              name: TRATBL_sdl_mds_ph_distributor_supervisors__duplicate_test
              config:
                store_failures: true
                schema: phlwks_integration

    - name: sdl_mds_ph_ref_repbrand
      tags: ["ph_mds_itg_refresh","ingestion"]
      tests:
          - test_null:
              select_columns: ["code"]
              not_null_columns: ["code"]
              name: TRATBL_sdl_mds_ph_ref_repbrand__null_test
              config:
                store_failures: true
                schema: phlwks_integration
          - test_duplicate:
              select_columns: ["code"]
              group_by_columns: ["code"]
              name: TRATBL_sdl_mds_ph_ref_repbrand__duplicate_test
              config:
                store_failures: true
                schema: phlwks_integration

