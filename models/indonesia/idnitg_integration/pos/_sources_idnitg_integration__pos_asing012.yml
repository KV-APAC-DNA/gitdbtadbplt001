version: 2

sources:
  - name: idnsdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: snapidnsdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_id_pos_daily_idm_sellout
      tags: ["id_pos_daily_idm_sellout","ingestion"]
      tests:
        - test_null:
                select_columns: ["filename","pos_cust","account","kode_branch","branch_name","tgl","plu","descp","type","value","yearmonth"]
                name: TRATBL_sdl_id_pos_daily_idm_sellout__null_test
                config:
                  store_failures: true
                  schema: idnwks_integration
    - name: sdl_mds_id_lav_hero_list
      tags: ["id_mds_itg_load","ingestion"]
      tests:
          - test_null:
              select_columns: ["year","region","distributor_code","sap_code","target_growth","target_coverage"]
              not_null_columns: ["sap_code","distributor_code","year"]
              name: TRATBL_sdl_mds_id_lav_hero_list__null_test
              config:
                store_failures: true
                schema: idnwks_integration
          - test_format:
              select_columns: ["year","region","distributor_code","sap_code","target_growth","target_coverage"]
              where_clause: "Distributor_Code IN (SELECT DISTINCT REPLACE(Distributor_Code, '.0', '') AS Distributor_Code FROM {{ source('idnsdl_raw', 'sdl_mds_id_lav_hero_list') }} x MINUS SELECT DISTINCT b.dstrbtr_id FROM {{ source('idnsdl_raw', 'sdl_mds_id_lav_hero_list') }} a, {{ ref('idnedw_integration__edw_distributor_dim') }} b WHERE a.Distributor_Code = b.dstrbtr_id)"
              name: TRATBL_sdl_mds_id_lav_hero_list__lookup_test
              config:
                store_failures: true
                schema: idnwks_integration 
    - name: sdl_mds_id_lav_mcs_list
      tags: ["id_mds_itg_load","ingestion"]
    - name: sdl_mds_id_lav_npi_sku_list
      tags: ["id_mds_itg_load","ingestion"]
      tests:
          - test_null:
              select_columns: ["year","npi_sku_code","sku_npi","benchmark_sku_code","sku_benchmark"]
              not_null_columns: ["year","npi_sku_code","benchmark_sku_code",]
              name: TRATBL_sdl_mds_id_lav_npi_sku_list__null_test
              config:
                store_failures: true
                schema: idnwks_integration
    - name : sdl_mds_id_pos_cust_prod_mapping
      tags: ["id_mds_itg_load","ingestion"] 
      tests:
          - test_null__ff:
              not_null_columns: ["account","plu_sku_desc","jj_sap_code"]
              name: TRATBL_sdl_mds_id_pos_cust_prod_mapping__null_test
              config:
                store_failures: true
                schema: idnwks_integration
          - test_duplicate__ff:
              group_by_columns: ["account","plu_sku_desc","jj_sap_code"]
              name: TRATBL_sdl_mds_id_pos_cust_prod_mapping__duplicate_test
              config:
                store_failures: true
                schema: idnwks_integration
    - name: sdl_mds_id_lav_inventory_intransit
      tags: ["id_mds_itg_load","ingestion"] 
      tests:
          - test_null__ff:
              not_null_columns: ["document","material","'ship-to'"]
              name: TRATBL_sdl_mds_id_lav_inventory_intransit__null_test
              config:
                store_failures: true
                schema: idnwks_integration
          - test_duplicate__ff:
              group_by_columns: ["document","material","'ship-to'"]
              name: TRATBL_sdl_mds_id_lav_inventory_intransit__duplicate_test
              config:
                store_failures: true
                schema: idnwks_integration
          - test_lookup:
              select_columns: ["document","material","description",'"ship-to"',"name1"]
              failure_reason: "'SHIT-TO CODE VALIDITY CHECK FAILED'"
              column: ltrim(nvl("ship-to", '#'), '0')
              lookup_column: "ltrim(nvl (jj_sap_dstrbtr_id, '#'), '0')"
              lookup_table: "{{ ref('idnedw_integration__edw_distributor_dim') }}"
              name: TRATBL_sdl_mds_id_lav_inventory_intransit__test_lookup
              config:
                store_failures: true
                schema: idnwks_integration

  - name: idnedw_integration
    database: "{{ env_var('DBT_ENV_CORE_DB') }}"
    schema: idnedw_integration
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
      - name : edw_time_dim

