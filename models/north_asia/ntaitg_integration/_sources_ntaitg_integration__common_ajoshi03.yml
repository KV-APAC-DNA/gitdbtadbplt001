version: 2

sources:
  - name: ntasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: ntasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    
    tables:
    - name: sdl_mds_kr_tp_target
      tags: ["j_kr_tp_tracker_data_ingestion", "ingestion"]
      tests:
          - test_null:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              not_null_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              name: TRATBL_sdl_mds_kr_tp_target__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_duplicate:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              group_by_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              name: TRATBL_sdl_mds_kr_tp_target__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_format:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              where_clause: "not regexp_like (trim(year_code),'(20)[0-9]{2}')"
              failure_reason: "'Year Having Incorrect Format -- Expected: YYYY'"
              name: TRATBL_sdl_mds_kr_tp_target__format_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              column: "upper(trim(sales_group_code))"
              lookup_column: "upper(trim(sls_grp_cd))"
              lookup_table: "aspedw_integration.edw_customer_attr_flat_dim"                                 #update the reference
              lookup_filter: "upper(county) = 'KR' and trim(sls_grp_cd) is not null and trim(sls_grp_cd) <> ''"
              filter: "trim(sales_group_code) is not null and trim(sales_group_code) <> ''"
              failure_reason: "'MISSING SLS_GRP_CD COMPARED TO MASTER TABLE FOR : SALES_GROUP_CD'"
              name: TRATBL_sdl_mds_kr_tp_target__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_mds_kr_cost_of_goods 
      tags: ["j_kr_tp_tracker_data_ingestion", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["sap_code", "valid_from", "valid_to"]
              group_by_columns: ["sap_code", "valid_from", "valid_to"]
              name: TRATBL_sdl_mds_kr_cost_of_goods__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration

    - name: sdl_kr_coupang_productsalereport
      tags: ["KR_SFMC_naver_data", "ingestion"]
      tests:
          - test_null:
              select_columns: ["file_name", "transaction_date", "sku_id", "sku_people", "barcode"]
              not_null_columns: ["file_name", "transaction_date", "sku_id", "sku_people", "barcode"]
              name: TRATBL_sdl_kr_coupang_productsalereport__null_test
              config:
                store_failures: true
                schema: ntawks_integration

    - name: sdl_kr_bo_young_jong_hap_logistics_gt_sellout
      tags: ["gt_sellout_bo_young_jong_hap_logistics", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              name: TRATBL_sdl_kr_bo_young_jong_hap_logistics_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_ecom_dstr_sellout_stock         
      tags: ["kr_ecom_regional_inv_health", "ingestion"]
      tests:
          - test_null:
              select_columns: ["file_name", "data_src", "dstr_cd", "sap", "ean_code", "transaction_date"]
              not_null_columns: ["dstr_cd", "sap", "ean_code"]
              name: TRATBL_sdl_kr_ecom_dstr_sellout_stock__null_test
              config:
                store_failures: true
                schema: ntawks_integration    
          - test_lookup:
              select_columns: ["file_name", "data_src", "dstr_cd", "sap", "ean_code", "transaction_date"]
              column: "coalesce(sap,'NA')"
              lookup_column: "coalesce(ltrim(matl_num,0),'NA')"
              lookup_table: "aspedw_integration.edw_material_dim"                                   #update the reference
              filter: "trim(sap) <> '' and trim(sap) is not null"
              failure_reason: "'missing material compared with master for: ' || 'FILE_NAME' || '(OR)' || 'DSTR_CD' || '(OR)' || 'SAP' || '(OR)' || 'EAN_CODE'"
              name: TRATBL_sdl_kr_ecom_dstr_sellout_stock__lookup_test_sap
              config:
                store_failures: true
                schema: ntawks_integration      
          - test_lookup:
              select_columns: ["file_name", "data_src", "dstr_cd", "sap", "ean_code", "transaction_date"]
              column: "coalesce(dstr_cd,'NA')"
              lookup_column: "coalesce(ltrim(cust_num,0),'NA')"                               
              lookup_table: "aspedw_integration.edw_customer_base_dim"                                #update the reference
              filter: "trim(dstr_cd) <> '' and trim(dstr_cd) is not null"
              failure_reason: "'missing distributor compared with master for: ' || 'FILE_NAME' || '(OR)' || 'DSTR_CD' || '(OR)' || 'SAP' || '(OR)' || 'EAN_CODE'"
              name: TRATBL_sdl_kr_ecom_dstr_sellout_stock__lookup_test_dstr_cd
              config:
                store_failures: true
                schema: ntawks_integration    


    - name: sdl_kr_da_in_sang_sa_gt_sellout
      tags: ["gt_sellout_da_in_sang_sa", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              name: TRATBL_gt_sellout_da_in_sang_sa__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_mds_kr_retailer_price_master
      tags: ["gt_sellout_daiso_price_master", "gt_sellout_daiso", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["ean"]
              group_by_columns: ["ean"]
              name: TRATBL_sdl_mds_kr_retailer_price_master__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_null:
              select_columns: ["ean", "unit_price"]
              not_null_columns: ["ean", "unit_price"]
              name: TRATBL_sdl_mds_kr_retailer_price_master__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_dongbu_lsd_gt_sellout
      tags: ["gt_sellout_dongbu_lsd", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_dongbu_lsd_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_du_bae_ro_yu_tong_gt_sellout
      tags: ["gt_sellout_du_bae_ro_yu_tong", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_du_bae_ro_yu_tong_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_mds_kr_sub_customer_master
      tags: ["gt_sellout_food_ws_cust_dim", "gt_sellout_nacf_cust_dim", "gt_sellout_otc", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["name", "code", "sap_customer_code"]
              group_by_columns: ["name", "code", "sap_customer_code"]
              name: TRATBL_sdl_mds_kr_sub_customer_master__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_null:
              select_columns: ["name", "code", "sap_customer_code"]
              not_null_columns: ["name", "code", "sap_customer_code"]
              name: TRATBL_sdl_mds_kr_sub_customer_master__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_hyundai_gt_sellout
      tags: ["gt_sellout_hyundai", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_hyundai_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              column: "cust_cd,sub_customer_name"
              lookup_column: "trim(customer_code) customer_code, trim(sub_customer_name) sub_customer_name"
              lookup_table: "ntaitg_integration.itg_kr_gt_dpt_daiso"                                                                      #update the reference
              failure_reason: "'missing customer information data compared with master file: ims_txn_dt, cust_cd, sub_customer_name'"
              name: TRATBL_sdl_kr_hyundai_gt_sellout__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration




    - name: sdl_kr_il_dong_hu_di_s_deok_seong_sang_sa_gt_sellout
      tags: ["gt_sellout_il_dong_hu_di_s_deok_seong_sang_sa", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_il_dong_hu_di_s_deok_seong_sang_sa_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_ju_hj_life_gt_sellout
      tags: ["gt_sellout_ju_hj_life", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_ju_hj_life_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_jungseok_gt_sellout
      tags: ["gt_sellout_jungseok", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_jungseok_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_lotte_ak_gt_sellout
      tags: ["gt_sellout_lotte_ak", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_lotte_ak_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              column: "cust_cd,sub_customer_name"
              lookup_column: "trim(customer_code) customer_code, trim(sub_customer_name) sub_customer_name"
              lookup_table: "ntaitg_integration.itg_kr_gt_dpt_daiso"                                                                      #update the reference
              failure_reason: "'missing customer information data compared with master file: ims_txn_dt, cust_cd, sub_customer_name'"
              name: TRATBL_sdl_kr_lotte_ak_gt_sellout__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration



