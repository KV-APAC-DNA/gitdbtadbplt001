version: 2

sources:
  - name: ntasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: ntasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    
    tables:
    - name: sdl_mds_kr_tp_target
      tags: ["j_kr_tp_tracker_data_ingestion", "ingestion"]
      tests:
          - test_null:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              not_null_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              name: TRATBL_sdl_mds_kr_tp_target__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_duplicate:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              group_by_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              name: TRATBL_sdl_mds_kr_tp_target__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_format:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              where_clause: "not regexp_like (trim(year_code),'(20)[0-9]{2}')"
              failure_reason: "'Year Having Incorrect Format -- Expected: YYYY'"
              name: TRATBL_sdl_mds_kr_tp_target__format_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["year_code", "channel_code", "store_type_code", "sales_group_code", "target_type_code", "brand_name_code", "target_category_name"]
              column: "upper(trim(sales_group_code))"
              lookup_column: "upper(trim(sls_grp_cd))"
              lookup_table: "aspedw_integration.edw_customer_attr_flat_dim"                                 #update the reference
              lookup_filter: "upper(county) = 'KR' and trim(sls_grp_cd) is not null and trim(sls_grp_cd) <> ''"
              filter: "trim(sales_group_code) is not null and trim(sales_group_code) <> ''"
              failure_reason: "'MISSING SLS_GRP_CD COMPARED TO MASTER TABLE FOR : SALES_GROUP_CD'"
              name: TRATBL_sdl_mds_kr_tp_target__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_mds_kr_cost_of_goods 
      tags: ["j_kr_tp_tracker_data_ingestion", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["sap_code", "valid_from", "valid_to"]
              group_by_columns: ["sap_code", "valid_from", "valid_to"]
              name: TRATBL_sdl_mds_kr_cost_of_goods__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration

    - name: sdl_kr_coupang_productsalereport
      tags: ["KR_SFMC_naver_data", "ingestion"]
      tests:
          - test_null:
              select_columns: ["file_name", "transaction_date", "sku_id", "sku_people", "barcode"]
              not_null_columns: ["file_name", "transaction_date", "sku_id", "sku_people", "barcode"]
              name: TRATBL_sdl_kr_coupang_productsalereport__null_test
              config:
                store_failures: true
                schema: ntawks_integration

    - name: sdl_kr_bo_young_jong_hap_logistics_gt_sellout
      tags: ["gt_sellout_bo_young_jong_hap_logistics", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              name: TRATBL_sdl_kr_bo_young_jong_hap_logistics_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_ecom_dstr_sellout_stock         
      tags: ["kr_ecom_regional_inv_health", "ingestion"]
      tests:
          - test_null:
              select_columns: ["file_name", "data_src", "dstr_cd", "sap", "ean_code", "transaction_date"]
              not_null_columns: ["dstr_cd", "sap", "ean_code"]
              name: TRATBL_sdl_kr_ecom_dstr_sellout_stock__null_test
              config:
                store_failures: true
                schema: ntawks_integration    
          - test_lookup:
              select_columns: ["file_name", "data_src", "dstr_cd", "sap", "ean_code", "transaction_date"]
              column: "coalesce(sap,'NA')"
              lookup_column: "coalesce(ltrim(matl_num,0),'NA')"
              lookup_table: "aspedw_integration.edw_material_dim"                                   #update the reference
              filter: "trim(sap) <> '' and trim(sap) is not null"
              failure_reason: "'missing material compared with master for: ' || 'FILE_NAME' || '(OR)' || 'DSTR_CD' || '(OR)' || 'SAP' || '(OR)' || 'EAN_CODE'"
              name: TRATBL_sdl_kr_ecom_dstr_sellout_stock__lookup_test_sap
              config:
                store_failures: true
                schema: ntawks_integration      
          - test_lookup:
              select_columns: ["file_name", "data_src", "dstr_cd", "sap", "ean_code", "transaction_date"]
              column: "coalesce(dstr_cd,'NA')"
              lookup_column: "coalesce(ltrim(cust_num,0),'NA')"                               
              lookup_table: "aspedw_integration.edw_customer_base_dim"                                #update the reference
              filter: "trim(dstr_cd) <> '' and trim(dstr_cd) is not null"
              failure_reason: "'missing distributor compared with master for: ' || 'FILE_NAME' || '(OR)' || 'DSTR_CD' || '(OR)' || 'SAP' || '(OR)' || 'EAN_CODE'"
              name: TRATBL_sdl_kr_ecom_dstr_sellout_stock__lookup_test_dstr_cd
              config:
                store_failures: true
                schema: ntawks_integration    


    - name: sdl_kr_da_in_sang_sa_gt_sellout
      tags: ["gt_sellout_da_in_sang_sa", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              name: TRATBL_gt_sellout_da_in_sang_sa__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_mds_kr_retailer_price_master
      tags: ["gt_sellout_daiso_price_master", "gt_sellout_daiso", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["ean"]
              group_by_columns: ["ean"]
              name: TRATBL_sdl_mds_kr_retailer_price_master__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_null:
              select_columns: ["ean", "unit_price"]
              not_null_columns: ["ean", "unit_price"]
              name: TRATBL_sdl_mds_kr_retailer_price_master__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_dongbu_lsd_gt_sellout
      tags: ["gt_sellout_dongbu_lsd", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_dongbu_lsd_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_du_bae_ro_yu_tong_gt_sellout
      tags: ["gt_sellout_du_bae_ro_yu_tong", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_du_bae_ro_yu_tong_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_mds_kr_sub_customer_master
      tags: ["gt_sellout_food_ws_cust_dim", "gt_sellout_nacf_cust_dim", "gt_sellout_otc", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["name", "code", "sap_customer_code"]
              group_by_columns: ["name", "code", "sap_customer_code"]
              name: TRATBL_sdl_mds_kr_sub_customer_master__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_null:
              select_columns: ["name", "code", "sap_customer_code"]
              not_null_columns: ["name", "code", "sap_customer_code"]
              name: TRATBL_sdl_mds_kr_sub_customer_master__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_hyundai_gt_sellout
      tags: ["gt_sellout_hyundai", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_hyundai_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              column: "cust_cd,sub_customer_name"
              lookup_column: "trim(customer_code) customer_code, trim(sub_customer_name) sub_customer_name"
              lookup_table: "ntaitg_integration.itg_kr_gt_dpt_daiso"                                                                      #update the reference
              failure_reason: "'missing customer information data compared with master file: ims_txn_dt, cust_cd, sub_customer_name'"
              name: TRATBL_sdl_kr_hyundai_gt_sellout__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration




    - name: sdl_kr_il_dong_hu_di_s_deok_seong_sang_sa_gt_sellout
      tags: ["gt_sellout_il_dong_hu_di_s_deok_seong_sang_sa", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_il_dong_hu_di_s_deok_seong_sang_sa_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_ju_hj_life_gt_sellout
      tags: ["gt_sellout_ju_hj_life", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_ju_hj_life_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_jungseok_gt_sellout
      tags: ["gt_sellout_jungseok", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_jungseok_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_lotte_ak_gt_sellout
      tags: ["gt_sellout_lotte_ak", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_lotte_ak_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              column: "cust_cd,sub_customer_name"
              lookup_column: "trim(customer_code) customer_code, trim(sub_customer_name) sub_customer_name"
              lookup_table: "ntaitg_integration.itg_kr_gt_dpt_daiso"                                                                      #update the reference
              failure_reason: "'missing customer information data compared with master file: ims_txn_dt, cust_cd, sub_customer_name'"
              name: TRATBL_sdl_kr_lotte_ak_gt_sellout__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration





    - name: sdl_kr_lotte_logistics_yang_ju_gt_sellout
      tags: ["gt_sellout_lotte_logistics_yang_ju", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_lotte_logistics_yang_ju_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_nacf_gt_sellout
      tags: ["gt_sellout_nacf", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "customer_code"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_nacf_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "customer_code"]
              column: "customer_code"
              lookup_column: " coalesce(nacf_customer_code,'NULL') customer_code"
              lookup_table: "ntaitg_integration.itg_kr_gt_nacf_cust_dim"                                                                      #update the reference
              failure_reason: "'missing customer code compared with master file: customer_code'"
              name: TRATBL_sdl_kr_nacf_gt_selloutt__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_nh_gt_sellout
      tags: ["gt_sellout_nh", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "customer_code"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_nh_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "customer_code"]
              column: "customer_code"
              lookup_column: "coalesce(ltrim(cust_num,0),'NULL') customer_code"
              lookup_table: "aspedw_integration.edw_customer_base_dim"                                                                      #update the reference
              failure_reason: "missing customer code compared with master file: customer_code'"
              name: TRATBL_sdl_kr_nh_gt_sellout__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration

    

    - name: sdl_kr_nu_ri_zon_gt_sellout
      tags: ["gt_sellout_nu_ri_zon", "ingestion"]
      tests:
          - test_null:
              select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
              not_null_columns: ["ean"]
              name: TRATBL_sdl_kr_nu_ri_zon_gt_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_ecommerce_ebay_sellout
      tags: ["j_kr_ecommerce_ebay_etl_framework", "ingestion"]
      tests:
          - test_null:
              select_columns: ["transaction_date", "cust_nm", "ean_num", "brand", "prod_desc"]
              not_null_columns: ["ean_num", "transaction_date"]
              name: TRATBL_sdl_kr_ecommerce_ebay_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["transaction_date", "cust_nm", "ean_num", "brand", "prod_desc"]
              column: "ean_num"
              lookup_column: "ltrim(ean,'0')"
              lookup_table: "aspedw_integration.edw_product_attr_dim"                                                                      #update the reference
              lookup_filter: "cntry = 'KR'"
              failure_reason: "'MISSING EAN NUMBER IN DIMENSION TABLE'"
              name: TRATBL_sdl_kr_ecommerce_ebay_sellout__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_ecommerce_trexi_sellout
      tags: ["j_kr_ecommerce_ebay_etl_framework", "ingestion"]
      tests:
          - test_null:
              select_columns: ["transaction_date", "cust_nm", "ean_num", "brand", "prod_desc"]
              not_null_columns: ["ean_num", "transaction_date", "cust_nm"]
              name: TRATBL_sdl_kr_ecommerce_trexi_sellout__null_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["transaction_date", "cust_nm", "ean_num", "brand", "prod_desc"]
              column: "ean_num"
              lookup_column: "ltrim(ean,'0')"
              lookup_table: "aspedw_integration.edw_product_attr_dim"                                                                      #update the reference
              lookup_filter: "cntry = 'KR'"
              failure_reason: "'MISSING EAN NUMBER IN DIMENSION TABLE'"
              name: TRATBL_sdl_kr_ecommerce_trexi_sellout__lookup_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_coupang_brand_ranking
      tags: ["kr_coupang_premium_brandranking", "ingestion"]
      tests:
          - test_null:
              select_columns: ["category_depth1", "category_depth2", "category_depth3", "ranking", "brand"]
              not_null_columns: ["category_depth1", "category_depth2", "category_depth3", "ranking", "brand"]
              name: TRATBL_sdl_kr_coupang_brand_ranking__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: sdl_kr_coupang_product_master
      tags: ["kr_coupang_premium_productranking", "ingestion"]
      tests:
          - test_null:
              select_columns: ["category_depth1", "category_depth2", "category_depth3", "all_brand", "coupang_sku_id", "coupang_sku_name", "ranking", "jnj_product_flag"]
              not_null_columns: ["category_depth1", "category_depth2", "category_depth3", "all_brand", "coupang_sku_id", "coupang_sku_name", "ranking", "jnj_product_flag"]   
              name: TRATBL_sdl_kr_coupang_product_master__null_test
              config:
                store_failures: true
                schema: ntawks_integration

    - name: sdl_kr_coupang_product_summary_weekly
      tags: ["kr_coupang_premium_productranking", "ingestion"]
      tests:
          - test_null:
              select_columns: ["category_depth1", "category_depth2", "category_depth3", "all_brand", "coupang_sku_id", "coupang_sku_name", "ranking", "jnj_product_flag"]
              not_null_columns: ["category_depth1", "category_depth2", "category_depth3", "all_brand", "coupang_sku_id", "coupang_sku_name", "ranking", "jnj_product_flag"]   
              name: TRATBL_sdl_kr_coupang_product_summary_weekly__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_coupang_product_summary_monthly
      tags: ["kr_coupang_premium_productranking", "ingestion"]
      tests:
          - test_null:
              select_columns: ["category_depth1", "category_depth2", "category_depth3", "all_brand", "coupang_sku_id", "coupang_sku_name", "ranking", "jnj_product_flag"]
              not_null_columns: ["category_depth1", "category_depth2", "category_depth3", "all_brand", "coupang_sku_id", "coupang_sku_name", "ranking", "jnj_product_flag"]   
              name: TRATBL_sdl_kr_coupang_product_summary_monthly__null_test
              config:
                store_failures: true
                schema: ntawks_integration


    - name: sdl_kr_coupang_search_keyword_by_category
      tags: ["kr_coupang_premium_search_keyword_by_category", "ingestion"]
      tests:
          - test_null:
              select_columns: ["by_search_keyword", "by_product_ranking", "category_depth1", "category_depth2", "category_depth3", "ranking", "search_keyword", "product_ranking", "product_name", "jnj_product_flag"]
              not_null_columns: ["by_search_keyword", "by_product_ranking", "category_depth1", "category_depth2", "category_depth3", "ranking", "search_keyword", "product_ranking", "product_name", "jnj_product_flag"]   
              name: TRATBL_sdl_kr_coupang_search_keyword_by_category__null_test
              config:
                store_failures: true
                schema: ntawks_integration





    - name: sdl_kr_coupang_search_keyword_by_product
      tags: ["kr_coupang_premium_search_keyword_by_product", "ingestion"]
      tests:
          - test_null:
              select_columns: ["category_depth1", "category_depth2", "category_depth3", "product_name", "ranking", "search_keyword"]
              not_null_columns: [ "category_depth1", "category_depth2", "category_depth3", "product_name", "ranking", "search_keyword"]   
              name: TRATBL_sdl_kr_coupang_search_keyword_by_product__null_test
              config:
                store_failures: true
                schema: 
                  


    - name: sdl_mds_kr_sales_store_master
      tags: ["mds_sdl_itg_load", "gt_sellout_daiso", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["code", "sales_grp_cd", "cust_store_cd", "channel", "store_type", "sold_to", "ctry_cd"]
              group_by_columns: ["code"]
              name: TRATBL_sdl_mds_kr_sales_store_master__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_null:
              select_columns: ["code", "sales_grp_cd", "cust_store_cd", "channel", "store_type", "sold_to", "ctry_cd"]
              not_null_columns: ["code", "sales_grp_cd", "cust_store_cd"]
              name: TRATBL_sdl_mds_kr_sales_store_master__null_test
              config:
                store_failures: true
                schema: ntawks_integration



    - name: wks_kr_sfmc_naver_data_additional               #check this module
      tags: ["mds_sdl_itg_load", "gt_sellout_daiso", "ingestion"]
      tests:
          - test_duplicate:
              select_columns: ["naver_id,attribute_name,attribute_value,file_name"]
              group_by_columns: ["naver_id,attribute_name,attribute_value,file_name"]
              name: TRATBL_wks_kr_sfmc_naver_data_additional__duplicate_test
              config:
                store_failures: true
                schema: ntawks_integration
          - test_null:
              select_columns: ["naver_id,attribute_name,attribute_value,file_name"]
              not_null_columns: ["naver_id"]
              name: TRATBL_wks_kr_sfmc_naver_data_additional__null_test
              config:
                store_failures: true
                schema: ntawks_integration




    - name: sdl_mds_kr_target
      tags: ["j_kr_nts_target_load", "ingestion"]
      tests:
          - test_lookup:
              select_columns: ["year_code", "sales_office_code_code", "sales_group_code_code", "product_h2_code", "product_h4_code"]
              column: "(upper(trim(sales_office_code_code)),upper(trim(sales_group_code_code)))"
              lookup_column: "upper(trim(sls_ofc)), upper(trim(sls_grp_cd))"
              lookup_table: "aspedw_integration.edw_customer_attr_flat_dim"                                                                      #update the reference
              lookup_filter: "county = 'KR' and (trim(sls_ofc) <> '' and sls_ofc is not null) and (trim(sls_grp_cd) <> '' and sls_grp_cd is not null)"
              failure_reason: "'MISSING SLS_OFC_CD,SLS_GRP_CD IN MASTER TABLE'"
              name: TRATBL_sdl_mds_kr_target__lookup_test_salesofficecode
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup:
              select_columns: ["year_code", "sales_office_code_code", "sales_group_code_code", "product_h2_code", "product_h4_code"]
              column: "(upper(trim(product_h2_code)),upper(trim(product_h4_code)))"
              lookup_column: "upper(trim(prod_hier_l2)), upper(trim(prod_hier_l4))"
              lookup_table: "aspedw_integration.edw_product_attr_dim"                                                                      #update the reference
              lookup_filter: "cntry = 'KR' and (trim(prod_hier_l2) <> '' and prod_hier_l2 is not null) and (trim(prod_hier_l4) <> '' and prod_hier_l4 is not null)"
              failure_reason: "'MISSING PRODUCT_HIER2,PRODUCT_HIER4 IN MASTER TABLE'"
              name: TRATBL_sdl_mds_kr_target__lookup_test_producth2code
              config:
                store_failures: true
                schema: ntawks_integration


          