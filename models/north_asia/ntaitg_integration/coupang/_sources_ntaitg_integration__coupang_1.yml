version: 2

sources:
  - name: ntasdl_raw
    database: "{{ env_var('DBT_ENV_CORE_DB') }}"
    schema: sshukl02_workspace
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_mds_kr_sales_store_master_1
      tests:
        - test_duplicate_file_name:
            select_columns: ["code", "sales_grp_cd", "cust_store_cd", "channel", "store_type", "sold_to", "ctry_cd"]
            group_by_columns: ["code", "sales_grp_cd", "cust_store_cd", "channel", "store_type", "sold_to", "ctry_cd"]
            name: TRATBL_sdl_mds_kr_sales_store_master__duplicate_test_filename
            config:
              store_failures: true
              schema: ntawks_integration
    - name: sdl_kr_coupang_product_ranking_daily_1
      tags: ["kr_coupang_premium_ing","ingestion"]
      tests:
      - test_date_format_odd_eve_leap_filename:
          model_nm: "{{ source('ntasdl_raw', 'sdl_kr_coupang_product_ranking_daily') }} "
          date_column: "product_ranking_date"
          filter: "(odd_mon.product_ranking_date) = (even_mon.product_ranking_date) and (even_mon.product_ranking_date) = (feb.product_ranking_date) and (odd_mon.result) = (even_mon.result) and (even_mon.result) = (feb.result)"
          failure_reason: "'product_ranking_date HAVING INCORRECT DATE-FORMAT. EXPECTED: MM/DD/YY'"
          select_columns: ["product_ranking_date","category_depth1","category_depth2","category_depth3","coupang_sku_id","coupang_sku_name","ranking"]
          name: TRATBL_sdl_kr_coupang_product_ranking_daily__test_date_format_odd_eve_leap_filename
          config:
            store_failures: true
            schema: ntawks_integration