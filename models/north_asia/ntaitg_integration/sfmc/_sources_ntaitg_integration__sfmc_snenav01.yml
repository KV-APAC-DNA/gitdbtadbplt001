version: 2

sources:
  - name: ntasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: snapntasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_tw_sfmc_redemption_data
      tags: ["nta_sfmc_files","ingestion"]
    - name: sdl_tw_sfmc_children_data
      tags: ["nta_crm_files","ingestion"]
      tests:
          - test_null__ff:
              not_null_columns: ["parent_key","child_number"]
              name: TRATBL_sdl_tw_sfmc_children_data__test_null__ff
              config:
                store_failures: true
                schema: ntawks_integration
          - test_duplicate__ff:
              group_by_columns: ["parent_key","child_number","file_name"]
              name: TRATBL_sdl_tw_sfmc_children_data__test_duplicate__ff
              config:
                store_failures: true
                schema: ntawks_integration
          - test_lookup__ff:
              failure_reason: "SUBSCRIBER_KEY NOT PRESENT IN COMSUMER MASTER LOOK UP TABLE :"
              column: "upper(nvl(parent_key, ''))"
              lookup_column: "upper(nvl(subscriber_key, ''))"
              lookup_table: "{{ ref('aspitg_integration__itg_sfmc_consumer_master') }} "
              name: TRATBL_sdl_tw_sfmc_children_data__test_lookup__ff
              config:
                store_failures: true
                schema: ntawks_integration