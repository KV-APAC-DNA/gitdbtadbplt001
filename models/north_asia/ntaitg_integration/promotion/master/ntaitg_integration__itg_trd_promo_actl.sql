{{
    config(
        materialized="incremental",
        incremental_strategy="merge",
        unique_key=["prft_ctr","cust_channel","cust_hdqtr_cd","ctry_cd","yr"],
        merge_exclude_columns=["crt_dttm"]
)}}
with source as (
    select * from {{ source('ntasdl_raw','sdl_na_trade_promotion_actual') }}
),
final as (
    select distinct 
        profit_center::varchar(100) as prft_ctr,
        profit_center_desc::varchar(200) as prft_ctr_desc,
        customer_channel::varchar(100) as cust_channel,
        customer_headquarter_code::varchar(200) as cust_hdqtr_cd,
        country_code::varchar(20) as ctry_cd,
        currency_code::varchar(3) as crncy_cd,
        year::varchar(4) as yr,
        jan_under_processing::number(16,2) as jan_und_prcs,
        jan_approved_but_payment_not_yet::number(16,2) as jan_aprv_no_pmt,
        jan_payment::number(16,2) as jan_pmt,
        jan_actual_trade_promotion::number(16,2) as jan_actl_trd_promo,
        feb_under_processing::number(16,2) as feb_und_prcs,
        feb_approved_but_payment_not_yet::number(16,2) as feb_aprv_no_pmt,
        feb_payment::number(16,2) as feb_pmt,
        feb_actual_trade_promotion::number(16,2) as feb_actl_trd_promo,
        mar_under_processing::number(16,2) as mar_und_prcs,
        mar_approved_but_payment_not_yet::number(16,2) as mar_aprv_no_pmt,
        mar_payment::number(16,2) as mar_pmt,
        mar_actual_trade_promotion::number(16,2) as mar_actl_trd_promo,
        apr_under_processing::number(16,2) as apr_und_prcs,
        apr_approved_but_payment_not_yet::number(16,2) as apr_aprv_no_pmt,
        apr_payment::number(16,2) as apr_pmt,
        apr_actual_trade_promotion::number(16,2) as apr_actl_trd_promo,
        may_under_processing::number(16,2) as may_und_prcs,
        may_approved_but_payment_not_yet::number(16,2) as may_aprv_no_pmt,
        may_payment::number(16,2) as may_pmt,
        may_actual_trade_promotion::number(16,2) as may_actl_trd_promo,
        jun_under_processing::number(16,2) as jun_und_prcs,
        jun_approved_but_payment_not_yet::number(16,2) as jun_aprv_no_pmt,
        jun_payment::number(16,2) as jun_pmt,
        jun_actual_trade_promotion::number(16,2) as jun_actl_trd_promo,
        jul_under_processing::number(16,2) as jul_und_prcs,
        jul_approved_but_payment_not_yet::number(16,2) as jul_aprv_no_pmt,
        jul_payment::number(16,2) as jul_pmt,
        jul_actual_trade_promotion::number(16,2) as jul_actl_trd_promo,
        aug_under_processing::number(16,2) as aug_und_prcs,
        aug_approved_but_payment_not_yet::number(16,2) as aug_aprv_no_pmt,
        aug_payment::number(16,2) as aug_pmt,
        aug_actual_trade_promotion::number(16,2) as aug_actl_trd_promo,
        sep_under_processing::number(16,2) as sep_und_prcs,
        sep_approved_but_payment_not_yet::number(16,2) as sep_aprv_no_pmt,
        sep_payment::number(16,2) as sep_pmt,
        sep_actual_trade_promotion::number(16,2) as sep_actl_trd_promo,
        oct_under_processing::number(16,2) as oct_und_prcs,
        oct_approved_but_payment_not_yet::number(16,2) as oct_aprv_no_pmt,
        oct_payment::number(16,2) as oct_pmt,
        oct_actual_trade_promotion::number(16,2) as oct_actl_trd_promo,
        nov_under_processing::number(16,2) as nov_und_prcs,
        nov_approved_but_payment_not_yet::number(16,2) as nov_aprv_no_pmt,
        nov_payment::number(16,2) as nov_pmt,
        nov_actual_trade_promotion::number(16,2) as nov_actl_trd_promo,
        dec_under_processing::number(16,2) as dec_und_prcs,
        dec_approved_but_payment_not_yet::number(16,2) as dec_aprv_no_pmt,
        dec_payment::number(16,2) as dec_pmt,
        dec_actual_trade_promotion::number(16,2) as dec_actl_trd_promo,
        convert_timezone('UTC', current_timestamp())::timestamp_ntz(9) as crt_dttm,
        convert_timezone('UTC', current_timestamp())::timestamp_ntz(9) as updt_dttm
    from source
)
select * from final