version: 2

sources:
  - name: ntasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: snapntasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
    - name: sdl_kr_price_tracker
      tags: ["",""]
    - name: sdl_mds_kr_product_ean_mapping
      tags: ["kr_mds_refresh","ingestion"]

    - name: sdl_kr_jnj_price_guide
      tags: ["j_kr_price_master_data_ingestion","ingestion"]
    - name: sdl_kr_coupang_daily_brand_reviews
    - name: sdl_mds_kr_sub_customer_master
      tags: ["gt_sellout_dept_daiso_cust_dim","gt_sellout_otc","ingestion"]
      tests:
      - test_null:
          select_columns: ["name","code","sap_customer_code"]
          not_null_columns: ["code","sap_customer_code"]
          name: TRATBL_sdl_mds_kr_sub_customer_master__null_test
          filter: " upper(trim(retailer_code))='DEPT & DAISO' "
          config:
            store_failures: true
            schema: ntawks_integration
      - test_duplicate:
          select_columns: ["name","code","sap_customer_code"]
          group_by_columns: ["name","code","sap_customer_code"]
          filter: " upper(trim(retailer_code))='DEPT & DAISO'"
          name: TRATBL_sdl_mds_kr_sub_customer_master__duplicate_test
          config:
            store_failures: true
            schema: ntawks_integration
    - name: sdl_mds_kr_brand_campaign_promotion
      tags: ["j_kr_ecomm_offtake_product_master_load","ingestion"]
      tests:
      - test_null:
          select_columns: ["code","brand_code"]
          not_null_columns: ["code","brand_code"]
          name: TRATBL_sdl_mds_kr_brand_campaign_promotion__null_test
          config:
            store_failures: true
            schema: ntawks_integration
      - test_duplicate:
          select_columns: ["code","brand_code"]
          group_by_columns: ["code","brand_code"]
          name: TRATBL_sdl_mds_kr_brand_campaign_promotion__duplicate_test
          config:
            store_failures: true
            schema: ntawks_integration
    - name: sdl_mds_kr_naver_product_master
      tags: ["j_kr_ecomm_offtake_product_master_load","ingestion"]
      tests:
      - test_null:
          select_columns: ["code","category_l_code","category_m_code","category_s_code","brands_name"]
          not_null_columns: ["code","category_l_code","category_m_code","category_s_code","brands_name"]
          name: TRATBL_sdl_mds_kr_naver_product_master__null_test
          config:
            store_failures: true
            schema: ntawks_integration
      - test_duplicate:
          select_columns: ["code","category_l_code","category_m_code","category_s_code","brands_name"]
          group_by_columns: ["code","category_l_code","category_m_code","category_s_code","brands_name"]
          name: TRATBL_sdl_mds_kr_naver_product_master__duplicate_test
          config:
            store_failures: true
            schema: ntawks_integration
    - name: sdl_mds_kr_keyword_classifications
      tags: ["j_kr_ecomm_offtake_product_master_load","ingestion"]
      tests:
      - test_null:
          select_columns: ["keyword","keyword_group"]
          not_null_columns: ["keyword","keyword_group"]
          name: TRATBL_sdl_mds_kr_keyword_classifications__null_test
          config:
            store_failures: true
            schema: ntawks_integration
      - test_duplicate:
          select_columns: ["keyword","keyword_group"]
          group_by_columns: ["keyword","keyword_group"]
          name: TRATBL_sdl_mds_kr_keyword_classifications__duplicate_test
          config:
            store_failures: true
            schema: ntawks_integration
    - name: sdl_mds_kr_product_hierarchy
      tags: ["kr_master_mds_sdl_itg_load","ingestion"]
    - name: sdl_mds_hk_product_hierarchy
      tags: ["kr_master_mds_sdl_itg_load","ingestion"]
    - name: sdl_kr_gt_daiso_price
      tags: ["gt_sellout_daiso","ingestion"]
    - name: sdl_mds_kr_retailer_price_master
      tags: ["gt_sellout_daiso_price_master", "gt_sellout_daiso", "ingestion"]
      tests:
        - test_duplicate:
            select_columns: ["ean"]
            group_by_columns: ["ean"]
            name: TRATBL_sdl_mds_kr_retailer_price_master__duplicate_test
            config:
              store_failures: true
              schema: ntawks_integration
        - test_null:
            select_columns: ["ean", "unit_price"]
            not_null_columns: ["ean", "unit_price"]
            name: TRATBL_sdl_mds_kr_retailer_price_master__null_test
            config:
              store_failures: true
              schema: ntawks_integration
    - name: sdl_kr_nh_gt_sellout
      tags: ["gt_sellout_nh", "ingestion"]
      tests:
        - test_null:
            select_columns: ["ims_txn_dt", "dstr_nm", "ean", "customer_code"]
            not_null_columns: ["ean"]
            name: TRATBL_sdl_kr_nh_gt_sellout__null_test
            config:
              store_failures: true
              schema: ntawks_integration
        - test_lookup:
            select_columns: ["ims_txn_dt", "dstr_nm", "ean", "customer_code"]
            column: "customer_code"
            lookup_column: "coalesce(ltrim(cust_num,0),'NULL') customer_code"
            lookup_table: "aspedw_integration.edw_customer_base_dim"                                                                      #update the reference
            failure_reason: "missing customer code compared with master file: customer_code'"
            name: TRATBL_sdl_kr_nh_gt_sellout__lookup_test
            config:
              store_failures: true
              schema: ntawks_integration
    - name: sdl_kr_nu_ri_zon_gt_sellout
      tags: ["gt_sellout_nu_ri_zon", "ingestion"]
      tests:
        - test_null:
            select_columns: ["ims_txn_dt", "dstr_nm", "ean", "cust_cd", "sub_customer_name"]
            not_null_columns: ["ean"]
            name: TRATBL_sdl_kr_nu_ri_zon_gt_sellout__null_test
            config:
              store_failures: true
              schema: ntawks_integration