version: 2

sources:
  - name: ntasdl_raw
    database: "{{ env_var('DBT_ENV_LOAD_DB') }}"
    schema: ntasdl_raw
    quoting:
      database: false
      schema: false
      identifier: false
    tables:
      - name: sdl_mds_tw_ims_dstr_prod_price_map
        tags: ["na_ims_inv_mds_sdl_itg_load","ingestion"]
        tests:
        - test_duplicate:
            select_columns: ["dstr_code", "ean_code", "dstr_product_code", "promotion_start_date", "promotion_end_date"]
            group_by_columns: ["dstr_code", "ean_code", "dstr_product_code", "promotion_start_date", "promotion_end_date"]
            name: TRATBL_sdl_mds_tw_ims_dstr_prod_price_map__duplicate_test
            config:
              store_failures: true
              schema: ntawks_integration
        - test_null:
            select_columns: ["code", "dstr_code", "ean_code", "dstr_product_code", "promotion_start_date", "promotion_end_date"]
            not_null_columns: ["code", "ean_code", "promotion_start_date", "promotion_end_date"]
            name: TRATBL_sdl_mds_tw_ims_dstr_prod_price_map__null_test
            config:
              store_failures: true
              schema: ntawks_integration


      - name: sdl_mds_hk_wingkeung_gt_msl_items
        tags: ["na_ims_inv_mds_sdl_itg_load","ingestion"]
        tests:
        - test_duplicate:
            select_columns: ["wk_code", "sap_code", "strt_yr_mnth", "end_yr_month", "code"]
            group_by_columns: ["wk_code", "sap_code", "strt_yr_mnth"]
            name: TRATBL_sdl_mds_hk_wingkeung_gt_msl_items__duplicate_test_1
            config:
              store_failures: true
              schema: ntawks_integration
        - test_null:
            select_columns: ["wk_code", "sap_code", "strt_yr_mnth", "end_yr_month", "code"]
            not_null_columns: ["code"]
            name: TRATBL_sdl_mds_hk_wingkeung_gt_msl_items__null_test
            config:
              store_failures: true
              schema: ntawks_integration        
        - test_duplicate:
            select_columns: ["wk_code", "sap_code", "strt_yr_mnth", "end_yr_month", "code"]
            group_by_columns: ["code"]
            name: TRATBL_sdl_mds_hk_wingkeung_gt_msl_items__duplicate_test_2
            config:
              store_failures: true
              schema: ntawks_integration 